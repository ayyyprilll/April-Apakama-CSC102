'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1495:function(D,L,c){c.r(L);c.d(L,"RtcUtils",function(){return k});D=c(0);var l=c(8),e=c(1525),a=c(34);class k{static y4e(x,y=e.RealtimeChannel.RJf){let m;try{m=a.c(x)}catch(u){throw x=String.format("Failed to JSON-serialize payload : {0}",u),l.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(m.length>y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,y),l.ULS.sendTraceTag(18637074,
500,10,x),Error.argument("payload",x);return m}static deserialize(x,y,m){if(!x)return null;if(Object.getType(x)!==String){var u=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",y,Object.getType(x).getName(),m);l.ULS.sendTraceTag(18637075,500,10,u);return null}u=null;try{u=a.a(x)}catch(z){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",y,z,m),l.ULS.sendTraceTag(18637077,
500,10,x)}return u}static hdc(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return a.c(x)}catch(y){return x.toString()}}static Arl(x){let y,m,u;y=0;u=m=null;if(!x)return{uki:y,wki:m,exception:u};try{const z=x.source;z&&Object.getType(z)===String&&(u=z);const v=x.context;v&&(x=v,y=x.status?x.status:0,m=x.statusText?x.statusText:null)}catch(z){}return{uki:y,wki:m,exception:u}}}Object(D.a)(k,"RtcUtils",null,[])},1515:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(46),a=c(72),k;(function(u){u[u.SendNotification=
0]="SendNotification";u[u.SendPersistentState=1]="SendPersistentState";u[u.FindSession=2]="FindSession";u[u.Last=3]="Last"})(k||(k={}));Object(D.b)("ApiType",k);var x;(function(u){u[u.AttemptCount=0]="AttemptCount";u[u.SuccessCount=1]="SuccessCount";u[u.DropCount=2]="DropCount";u[u.FailedCount=3]="FailedCount";u[u.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";u[u.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";u[u.ThrottledCount=6]="ThrottledCount";u[u.Last=7]="Last"})(x||(x=
{}));Object(D.b)("EventCountType",x);var y=c(1611);c.d(L,"FrequentLoggingMetrics",function(){return m});class m{constructor(u){this.JDh=this.yWh=null;this.UGi=this.oZh=0;this.Et=null;this.b2g=this.vHe=0;this.Of=u;this.rrm();this.mye=this.VRg=this.eIe=!1;this.yvc=0}get Sql(){return this.mye}Ouo(u){this.b2g=u;window.setInterval(Object(e.a)(this,this.gIf,"logMetricsBatchAndReset"),u);this.vHe=(new Date).getTime()}pO(u,z){this.Ajo(u)&&!this.VRg||this.Sql||!window.navigator.onLine||this.Of.DPa||(this.Et[u][z]++,
this.eIe=!0)}rrm(){this.Et=Array(3);for(let u=0;3>u;u++){this.Et[u]=Array(7);for(let z=0;7>z;z++)this.Et[u][z]=0}}RGk(){const u={};for(let z=0;3>z;z++)for(let v=0;7>v;v++)this.DMm(z,v)&&(u[k[z]+x[v]]=this.Et[z][v]);u.FSDomain=this.yWh;u.ConnectionDomain=this.JDh;u.FSRetryInterval=this.oZh;u.MaxPayloadSize=this.UGi;u.LogNumber=this.yvc;1===this.yvc&&(u.FSLatencies=y.a.instance.VOl(),u.ConLatencies=y.a.instance.BJl());return u}DMm(u,z){return 2===u&&3!==z&&0!==z?!1:!0}Ajo(u){return 2===u?!1:!0}gIf(){if(this.eIe){this.yvc++;
if((new Date).getTime()-this.vHe<5E3+this.b2g){var u=a.a.toJSON(this.RGk());l.ULS.sendTraceTag(50644352,500,15,u)}this.vHe=(new Date).getTime();for(u=0;3>u;u++)for(let z=0;7>z;z++)this.Et[u][z]=0;this.eIe=!1}}k4m(){this.VRg=!0}static get instance(){return m._instance}static create(u){m.instance||(m._instance=new m(u));return m.instance}}m._instance=null;Object(D.a)(m,"FrequentLoggingMetrics",null,[897])},1525:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(46),a=c(438),k=c(880),x=c(80),y=c(2);class m{constructor(fa,
Ca){this.status=fa;this.pbc=Ca}}Object(D.a)(m,"UserStatusInfo",null,[]);var u=c(45),z=c(1611);class v{constructor(fa,Ca){this.data=fa;this.timeStamp=Ca}}Object(D.a)(v,"PresenceData",null,[]);class E{constructor(fa){this.eBa=!1;this.dxb=0;this.jue=!1;this.setTimeout=E.Yaf;this.clearTimeout=E.Raf;this.B1m=Object(e.a)(this,this.o0m,"logRtcConnectingUsageStatement");this.ow=fa}agn(){this.eBa||(this.dxb=this.setTimeout(()=>{this.eBa=!1;this.jEi()},8E3),this.eBa=!0,this.jue=!1)}Ugn(){this.GZ()}Knn(){this.jEi()}jEi(){this.GZ();
this.jue||(this.jue=!0,this.B1m())}o0m(){l.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.ow)}GZ(){this.eBa&&this.clearTimeout(this.dxb);this.dxb=0;this.eBa=!1}static Yaf(fa,Ca){return window.setTimeout(fa,Ca)}static Raf(fa){window.clearTimeout(fa)}}Object(D.a)(E,"ConnectedUsageKpiLogger",null,[916]);class F{constructor(){this.d1i=this.n0f;this.g1i=this.q0f;this.f1i=this.p0f;this.k1i=this.s0f;this.j1i=this.r0f;this.D0f=this.E0f;this.a2c=this.B0f;this.wLb=
this.z0f;this.xLb=this.A0f;this.e1i=this.o0f;this.HQa=this.PNf;this.Bkb=this.QNf}n0f(){}q0f(){}p0f(){}s0f(){}r0f(){}B0f(){}A0f(){}z0f(){}E0f(){}o0f(){}PNf(){}QNf(){}}Object(D.a)(F,"NoopRealtimeChannelMetrics",null,[908,183]);class J{}J.r$c="presenceUpdated";J.updateNotification="updateNotification";J.$Vi="persistentStateCleared";J.updatePersistentState="persistentStateUpdated";Object(D.a)(J,"RtcClientMethodNames",null,[]);class K{}K.bmm="realtimeChannelHub";K.r$c="UpdatePresence";K.LO="SendUpdateNotification";
K.emf="GetCompletePersistentStateWithMetadata";K.updatePersistentState="UpdatePersistentState";K.ipb="UpdateClientInfo";Object(D.a)(K,"RtcHubMethodNames",null,[]);class H{constructor(fa){this.Jv=fa}iQn(fa){this.Jv.on(J.r$c,fa)}bRn(fa){this.Jv.on(J.updateNotification,fa)}hQn(fa){this.Jv.on(J.updatePersistentState,fa)}gQn(fa){this.Jv.on(J.$Vi,fa)}yKo(fa){this.Jv.off(J.r$c,fa)}IKo(fa){this.Jv.off(J.updateNotification,fa)}xKo(fa){this.Jv.off(J.updatePersistentState,fa)}wKo(fa){this.Jv.off(J.$Vi,fa)}r$c(fa){return this.Jv.invoke(K.r$c,
fa)}ipb(fa){return this.Jv.invoke(K.ipb,fa)}LO(fa,Ca){return this.Jv.invoke(K.LO,fa,Ca)}emf(fa){return this.Jv.invoke(K.emf,fa)}updatePersistentState(fa,Ca){return this.Jv.invoke(K.updatePersistentState,fa,Ca)}}Object(D.a)(H,"RealtimeChannelProxy",null,[913,914,915]);class P{constructor(){this.Gre=this.WIg=!1;this.Ere=0;this.xte=this.YPe=this.XPe=this.Hqe=!1;this.Nye=0;this.mah=!1;this.lah=this.kah=0;this.tOe=!1;this.AOe=this.yOe=this.COe=this.uOe=0;this.zOe=!1}get $Bk(){return this.Gre}get ZBk(){return this.Ere}get Buk(){return this.Hqe}get flo(){return this.XPe}get glo(){return this.YPe}get jSk(){return this.xte}get RKd(){return this.Nye}get E2n(){return this.mah}get v$i(){return this.kah}get D2n(){return this.lah}get z2n(){return this.tOe}get A2n(){return this.uOe}get B$i(){return this.COe}get w$i(){return this.yOe}get y$i(){return this.AOe}get x$i(){return this.zOe}static createInstance(fa){const {RealtimeChannel:Ca}=
c(1525);return fa?Object.assign(new P,{WIg:fa.$("AwayStatusManagerIsEnabled"),Gre:fa.$("AwayStatusOneMinuteTimeoutIsEnabled"),Ere:fa.pc("AwayCoauthorThresholdMs",9E5),Hqe:fa.$("RtcAllowCrossDomainAccessEnabled"),XPe:fa.$("ShouldLogOnContentNotification"),YPe:fa.$("ShouldLogOnHostSubscriptionNotification"),xte:fa.$("RtcClientMetricsEnabled"),Nye:fa.pc("RtcFindSessionRequestTimeoutInMS",6E4),mah:fa.$("RtcJsClientFrequentlyLogsMetrics"),kah:fa.pc("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),
lah:fa.pc("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),tOe:fa.$("RtcClientMessageTelemetryEnabled"),uOe:fa.pc("RtcClientMessageTelemetrySampleSize",5),COe:fa.pc("RtcSendTelemetryMessageIntervalInMS",3E5),yOe:fa.pc("RtcLogClientMessageMetricsTimeOutInMs",2E4),AOe:fa.pc("RtcMaxPayloadSizeInCharactersOverride",Ca.RJf),zOe:fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new P,{WIg:!1,Gre:!1,Ere:9E5,Hqe:!1,XPe:!1,YPe:!0,xte:!1,Nye:9E4,tOe:!1,
uOe:5,COe:3E5,yOe:2E4,AOe:Ca.RJf,zOe:!1})}}Object(D.a)(P,"RealtimeChannelSettings",null,[912]);var N=c(1740),M=c(82),I=c(162);class T{constructor(fa){this.WAc=null;this.jSa=0;this.RBb=!1;this.Cm=fa;this.Cm.$sa(Object(e.a)(this,this.fha,"onConnectionStateChanged"))}fha(fa,Ca){this.jSa=Ca.newState}qon(){l.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Cm.sae()}Opm(fa){this.WAc.init(fa)}}Object(D.a)(T,"ARtcMessageHandler",null,[]);var U=c(1146);class W{constructor(){this.Presence=
null;this.TimeStamp=0}}Object(D.a)(W,"PresenceDataEntryForClients",null,[]);var V=c(72);class Y{constructor(fa,Ca=""){this.zbk=fa;this.Vra=Ca}send(){return this.zbk()}get messageId(){return this.Vra}}Object(D.a)(Y,"MessageHandler",null,[924]);var da=c(1642);class ba extends Sys.EventArgs{constructor(fa,Ca,Ta,eb){super();this.H3f=fa;this.reconnectDelay=Ca;this.reason=Ta;this.U6f=eb}}Object(D.a)(ba,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ja=c(1696);class sa{constructor(){this.nRe=this.Bi=
null}get ri(){return this.Bi?this.nRe?this.nRe.getTime()-this.Bi.getTime():(new Date).getTime()-this.Bi.getTime():0}start(){this.Bi=new Date}stop(){this.nRe=new Date}}Object(D.a)(sa,"SimpleStopwatch",null,[]);var ta=c(1698),ra;(function(fa){fa[fa.contentUpdate=0]="contentUpdate";fa[fa.editorsTableUpdate=1]="editorsTableUpdate";fa[fa.fileNameUpdate=2]="fileNameUpdate";fa[fa.wetContentUpdate=3]="wetContentUpdate";fa[fa.persistedContentUpdate=4]="persistedContentUpdate";fa[fa.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";fa[fa.replicationTelemetry=6]="replicationTelemetry";fa[fa.lockUpdate=7]="lockUpdate";fa[fa.collabServiceContentUpdate=8]="collabServiceContentUpdate";fa[fa.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";fa[fa.saveTargetUpdate=10]="saveTargetUpdate";fa[fa.uploadToOcsUpdate=11]="uploadToOcsUpdate";fa[fa.labelUpdate=12]="labelUpdate";fa[fa.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";fa[fa.subscribeOrExtend=14]="subscribeOrExtend";
fa[fa.elapsedBootTelemetry=15]="elapsedBootTelemetry";fa[fa.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";fa[fa.clientToClientResponseMessage=17]="clientToClientResponseMessage";fa[fa.verifyNotificationPipeline=18]="verifyNotificationPipeline";fa[fa.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";fa[fa.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";fa[fa.last=21]="last"})(ra||(ra={}));Object(D.b)("UpdateNotificationType",ra);var ma=c(1697),Ba=c(818),Pa=c(819);
class Da extends T{constructor(fa,Ca,Ta,eb,jb,ob,Ya,Xa,Sa,ab){super(Ya);this.Jv=null;this.T1g=!1;this.Vra=0;this.yLe=new I.a;this.n3j=Da.eKl();this.GKe=y.AFrameworkApplication.K.kb("OwningFeatureCrewForRtcNotificationKpis");this.Rd=fa;this.z4g=this.y4g=0;this.WAc=Ca;this.WAc.Ayd(Object(e.a)(this,this.qon,"onTooManyUndeliveredMessages"));this._clientId=Ta;this.g$j=jb;this.Cm.Yrk(Object(e.a)(this,this.Pln,"onRefreshProxyRequired"));this.Cm.Wrk(Object(e.a)(this,this.Nln,"onRefreshAllPersistentStateRequest"));
this.Cm.fsk(Object(e.a)(this,this.LO,"sendUpdateNotification"));this.Cm.Zpk(Object(e.a)(this,this.gjn,"onInternalPresenceUpdated"));this.Cm.$pk(Object(e.a)(this,this.hjn,"onInternalUpdateNotificationReceived"));this.Cm.Ypk(Object(e.a)(this,this.fjn,"onInternalPersistentStateUpdated"));this.Cm.Xpk(Object(e.a)(this,this.ejn,"onInternalPersistentStateCleared"));this.Cm.dsk(Object(e.a)(this,this.lhc,"sendPersistentState"));this.Cm.tsk(Object(e.a)(this,this.ipb,"updateClientInfo"));this.ge=ob;this.ow=
eb;this.Et=Xa;this.DV=Sa;this.Vvc=ab;this.Oqa=Object(M.a)(String,y.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Pln(fa,Ca){this.Jv=this.g$j(Ca.hubConnection);this.WAc.reset();this.Jv.iQn(Object(e.a)(this,this.X3,"onPresenceUpdated"));this.Jv.hQn(Object(e.a)(this,this.ZQa,"onPersistentStateUpdated"));this.Jv.gQn(Object(e.a)(this,this.Hdc,"onPersistentStateCleared"));this.Jv.bRn(Object(e.a)(this,this.S_,"onUpdateNotificationReceived"))}fha(fa,Ca){this.jSa=Ca.newState;2===Ca.newState&&
this.N7n()}N7n(){for(let fa of this.yLe)this.LO(null,new ja.a(fa.key,fa.value,!1,new a.a));this.yLe=new I.a}Nln(fa,Ca){Ca.d5e();for(fa=0;3>fa;++fa)this.r7n(fa,Ca)}r7n(fa,Ca){try{this.Jv.emf(fa).done(Ta=>{Ca.Slc(Ca.c7e,"GetCompletePresenceSuccess")&&(Ca.KXk.Knn(),l.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.ow),this.Cm.zHn(),this.$kn(fa,Ta),this.Cm.PGn(Ta),Ca.$Th.ob(fa)&&this.Cm.d0i(fa,Ca.$Th.J(fa),new a.a))}).fail(Ta=>{const {RtcUtils:eb}=c(1495);
Ca.Slc(Ca.c7e,"GetCompletePresenceFail")&&(l.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",eb.hdc(Ta),this.ow),this.Cm.sae())}).always(()=>{Ca.jz&&Ca.jz.stop()})}catch(Ta){l.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",Ca.c7e,Ta.message)}}lhc(fa,Ca){var {RtcUtils:Ta}=c(1495);fa=Ca.presence;let eb;const jb=
Ca.B6a;this.DV.pO(1,0);try{eb=Ta.y4e(fa,this.Vvc)}catch(Ya){this.DV.pO(1,3);l.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Ya.message);jb.setException(Ya);return}Ta=new x.a;Ta.Z(this._clientId,Object.assign(new W,{Presence:fa,TimeStamp:(new Date).getTime()}));this.Cm.k0i(Ca.type,Ta);if(2!==this.jSa)this.Et.wLb(),this.DV.pO(1,2),jb.xg(null);else{var ob=this.Vra.toString();++this.Vra;fa=new Y(()=>this.P7n(Ca.type,eb,ob),ob);fa=this.Asj(0,
Ca.type).add(fa);fa.H5d(Ya=>{2===Ya&&this.DV.pO(1,6);jb.xg(null)});fa.G5d(()=>{})}}P7n(fa,Ca,Ta){let eb=null;const jb=new sa,ob=new da.a;l.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.ow);if(2!==this.jSa)return this.Et.wLb(),this.DV.pO(1,2),l.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.ow),ob.EJf(),ob;this.ge&&20>this.y4g&&(eb=this.ge.eg("WebServiceCall","Send Presence Message"),this.y4g++);jb.start();ob.$Wc(1);try{this.Jv.updatePersistentState(fa,
Ca).done(()=>{this.Et.a2c();this.DV.pO(1,1);l.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Ta,this.ow);ob.jkb(1);jb&&(jb.stop(),jb.ri>this.Rd.v$i?this.DV.pO(1,4):this.DV.pO(1,5))}).fail(Ya=>{const {RtcUtils:Xa}=c(1495);this.RBb||(this.Et.wLb(),this.DV.pO(1,3),l.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Ta,Xa.hdc(Ya),this.ow));ob.jkb(2)}).always(()=>{eb&&eb.stop()})}catch(Ya){l.ULS.sendTraceTag(593072906,
500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",Ya.message),this.DV.pO(1,3),ob.jkb(2)}return ob}ipb(fa,Ca){({RtcUtils:fa}=c(1495));const Ta=Ca.iSk,eb=Ca.B6a;let jb;try{jb=fa.y4e(Ta,this.Vvc)}catch(ob){l.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",ob.message);eb.setException(ob);return}try{this.Jv.ipb(jb).done(()=>{l.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(ob=>{const {RtcUtils:Ya}=
c(1495);this.RBb||l.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Ya.hdc(ob));eb.xg(null)})}catch(ob){l.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",ob.message),eb.xg(null)}}LO(fa,Ca){({RtcUtils:fa}=c(1495));const Ta=Ca.type,eb=Ca.dL,jb=Ca.bdl,ob=Ca.B6a;let Ya;this.DV.pO(0,0);try{Ya=fa.y4e(eb,this.Vvc)}catch(Sa){this.DV.pO(0,3);l.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
Sa.message);ob.setException(Sa);return}if(2!==this.jSa)jb?this.yLe.Z(Ta,eb):(this.Et.wLb(),this.DV.pO(0,2)),ob.xg(null);else{var Xa=this.Vra.toString();++this.Vra;Ca=new Y(()=>this.E8n(Ta,Ya,Xa),Xa);Ca=this.Asj(1,Ta).add(Ca);Ca.H5d(Sa=>{2===Sa&&this.DV.pO(0,6);ob.xg(null)});Ca.G5d(()=>{})}}E8n(fa,Ca,Ta){let eb=null;const jb=new sa,ob=new da.a;l.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.ow);if(2!==this.jSa)return this.Et.wLb(),this.DV.pO(0,2),l.ULS.sendTraceTag(7934172,
500,15,"Connection is lost - unable to send the message for [{0}]",this.ow),ob.EJf(),ob;this.ge&&3===fa&&20>this.z4g&&(eb=this.ge.eg("WebServiceCall","Send WetContent Update"),this.z4g++);jb.start();ob.$Wc(1);this.Jv.LO(fa,Ca).done(()=>{this.Et.a2c();this.DV.pO(0,1);l.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",Ta,this.ow);ob.jkb(1);jb&&(jb.stop(),jb.ri>this.Rd.v$i?this.DV.pO(0,4):this.DV.pO(0,5))}).fail(Ya=>{const {RtcUtils:Xa}=c(1495);this.RBb||
(this.Et.wLb(),this.DV.pO(0,3),l.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Ta,Xa.hdc(Ya),this.ow));ob.jkb(2)}).always(()=>{eb&&eb.stop()});return ob}Jia(){this.Jv.yKo(Object(e.a)(this,this.X3,"onPresenceUpdated"));this.Jv.xKo(Object(e.a)(this,this.ZQa,"onPersistentStateUpdated"));this.Jv.wKo(Object(e.a)(this,this.Hdc,"onPersistentStateCleared"));this.Jv.IKo(Object(e.a)(this,this.S_,"onUpdateNotificationReceived"))}gjn(fa,Ca){this.X3(Ca.rqa,
Ca.wHd)}X3(fa){this.Et.xLb();this.ZQa(0,fa)}fjn(fa,Ca){this.ZQa(Ca.type,Ca.rqa)}$kn(fa,Ca){const Ta={};for(let eb in Ca)Ta[eb]=Ca[eb].Presence;this.MPi(fa,Ta,Ca)}ZQa(fa,Ca){this.Et.xLb();this.MPi(fa,Ca)}MPi(fa,Ca,Ta=null){var {RtcUtils:eb}=c(1495);if(l.ULS.o9(500,100))for(var jb in Ca);delete Ca[this._clientId];if(!V.a.isEmpty(Ca)){for(var ob in Ca)jb=ob,Ca[jb]=eb.deserialize(Ca[ob],"Presence",jb,!1,this.Vvc);eb=new x.a;ob=(new Date).getTime();for(let Ya in Ca){jb=Ca[Ya];let Xa=Ya,Sa;Ta?(Sa=Ta[Xa],
Sa.Presence=jb):Sa=Object.assign(new W,{Presence:jb,TimeStamp:ob});eb.Z(Xa,Sa)}this.Cm.k0i(fa,eb);switch(fa){case 0:this.T1g||(l.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.ow),this.T1g=!0,y.AFrameworkApplication.Sg&&y.AFrameworkApplication.Sg.d4m());this.Cm.X_i(Ca,[]);break;default:this.Cm.qHn(fa,Ca)}}}ejn(fa,Ca){this.Hdc(Ca.LCd)}Hdc(fa){this.Et.xLb();if(l.ULS.o9(500,100))for(let Ca=0;Ca<fa.length;++Ca);fa.length&&(this.Cm.PHn(fa),this.Cm.pHn(fa),this.Cm.X_i({},
fa))}hjn(fa,Ca){this.S_(Ca.type,Ca.dL)}S_(fa,Ca=null){this.Rd.flo&&0===fa&&l.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===fa&&this.GKe&&0<this.GKe.length){var Ta=Object.assign(new ma.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.GKe,vetoPillar:"RealTimeCoauth"});(Ta=U.a.getInstance(Ta))&&Ta.logKpiUsage(this.n3j)}this.Rd.glo&&13===fa&&l.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",
Ca||"<none>"));this.Et.xLb();5===fa?(Ca=(fa=this.dun(Ca))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",fa.reason,fa.reconnectDelay):"Received client reconnection request from the server without params.",l.ULS.sendTraceTag(18637071,500,50,Ca),this.Cm.sae(fa)):(Ca=c(1495).RtcUtils.deserialize(Ca,String.format("UpdateNotification-{0}",ra[fa]),null,!1,this.Vvc),this.Cm.OHn(fa,Ca))}dun(fa){try{if(!fa||""===fa)return null;const Ca=JSON.parse(fa);
return new ba(Ca[ta.a.F5f],Ca[ta.a.y2n],Ca[ta.a.C2n],Ca[ta.a.U6f])}catch(Ca){return l.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",Ca.message),null}}Asj(fa,Ca){return this.WAc.Y8l(this.Z8l(fa,Ca))}Z8l(fa,Ca){return fa+","+Ca}static eKl(){var fa=new Map;fa.set("SkipAria","True");fa=Object.assign(new Ba.a,{extendedProperties:fa});return Object.assign(new Pa.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:fa,blockFutureEmissionDurationInMs:3E5})}}
Object(D.a)(Da,"RtcMessageHandler",T,[]);class Ha{eIh(fa,Ca=""){const {MaxOutstandingThrottler:Ta}=c(1693);return Ta.createInstance(fa,Ca)}f5k(fa,Ca=""){const {MaxRateThrottler:Ta}=c(1695);return Ta.createInstance(fa,Ca)}}Object(D.a)(Ha,"ThrottlerFactory",null,[910]);var oa=c(67),wa=c(1699);class ia{constructor(fa){this.Rd=null;this.xh=!1;this.ra=new oa.a;this.PHe=new x.a;this.NHe=new x.a;this.PSe=fa;this.dUb=this.PSe.eIh(Ca=>Ca.send(),"GlobalMaxOustandingThrottler");this.dUb.Ayd(()=>{this.ra.raiseEvent("TMUDM")})}init(fa){this.xh||
(this.Rd=fa,this.dUb.init(this.Rd.Mob,this.Rd.ncm),this.xh=!0)}Y8l(fa){var {MaxRateThrottler:Ca}=c(1695),{MaxOutstandingThrottler:Ta}=c(1693);this.xh||this.init(new wa.a(Ca.sLh,Ta.SLh,Ta.DLh,ia.J5m));({value:Ca}=this.PHe.Ec(fa)).returnValue||(({value:Ca}=this.NHe.Ec(fa)).returnValue||(Ca="MaxOutstandingThrottler-"+fa,Ca=this.PSe.eIh(Object(e.a)(this.dUb,this.dUb.add,"add"),Ca),Ca.init(this.Rd.Mob,this.Rd.I5m),Ca.Ayd(()=>{this.ra.raiseEvent("TMUDM")}),this.NHe.add(fa,Ca)),Ta="MaxRateThrottler-"+fa,
Ca=this.PSe.f5k(Object(e.a)(Ca,Ca.add,"add"),Ta),Ca.init(this.Rd.I7m),this.PHe.add(fa,Ca));return Ca}reset(){for(let fa of this.PHe)fa.value.C0f();for(let fa of this.NHe)fa.value.C0f(),fa.value.reset();this.dUb.C0f();this.dUb.reset()}Ayd(fa){this.ra.addHandler("TMUDM",fa)}}ia.J5m=1E3;Object(D.a)(ia,"ThrottlerManager",null,[909]);var ca;(function(fa){fa[fa.unspecified=0]="unspecified";fa[fa.word=1]="word";fa[fa.excel=2]="excel";fa[fa.powerPoint=3]="powerPoint";fa[fa.test=4]="test";fa[fa.wacFrontEnd=
5]="wacFrontEnd";fa[fa.oneNote=6]="oneNote";fa[fa.visio=7]="visio";fa[fa.officeMobile=8]="officeMobile";fa[fa.cosmosDBChangefeed=9]="cosmosDBChangefeed";fa[fa.last=10]="last"})(ca||(ca={}));Object(D.b)("RtcClientAppName",ca);const pa=(fa,Ca,Ta,eb,jb,ob,Ya,Xa,Sa=null,ab=null,Hb=null,pb=null)=>{const Mb=P.createInstance(y.AFrameworkApplication.K),Qb=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",Aa=Ma(fa,Ca,Ya,Qb),bb=Mb.jSk?c(1855).RealtimeChannelMetrics.createInstance(Aa):
new F;var nb=c(1515).FrequentLoggingMetrics.create(jb);Mb.E2n&&nb.Ouo(Mb.D2n);var Va="";Va=Sa&&""!==Sa?Sa:"/rtc2/";nb.yWh=u.a.YZ(Va);const Ab=Va+"signalr";Sa=Va+"findsession";const Zb=K.bmm;Va=new Ha;Hb=Hb||N.a.getInstance();l.ULS.shipAssertTag(556867617,500,Mb.y$i<=c(1525).RealtimeChannel.VGi,"Client attempting to override max payload size beyond absolute limit");const Kb=Math.min(Mb.y$i,c(1525).RealtimeChannel.VGi);nb.UGi=Kb;nb=new Da(Mb,new ia(Va),fa,Aa,dc=>new H(dc.createHubProxy(Zb)),Xa,Hb,bb,
nb,Kb);ab||(ab=c(1744).FindSessionStrategy.createInstance(Ca,jb,Sa,Xa,Qb,Ya,fa,Aa,Hb,ob,eb,pb));ab.RKd=Mb.RKd;Ca=new E(Aa);Ta=Ta?Ta.split(","):null;fa=new (c(1525).RealtimeChannel)(fa,Ta,Aa,Xa,()=>$.hubConnection(Ab),ab,nb,Ca,Hb,bb,Mb,jb);fa.init();return fa},Ma=(fa,Ca,Ta)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",fa,ya(ca[Ta]),ya("browser"),Ca),ya=fa=>fa?fa.charAt(0).toLocaleUpperCase()+fa.substring(1,fa.length):fa;c.d(L,"RealtimeChannel",function(){return Oa});class Oa{constructor(fa,
Ca,Ta,eb,jb,ob,Ya,Xa,Sa,ab,Hb,pb){this.lRe=!1;this.u5=null;this.W1=new x.a;this.jpc=1;this.ida=null;this.Xl=!1;this.QFe=(new Date(0)).getTime();this.Sch=0;this._clientId=fa;this.Hvd=Ca;this.P9=0;this.ge=eb;this.iue=Xa;this.$ak=Ya;this.RNj=Sa;this.eTj=jb;this.t8a=ob;this.ow=Ta;this.Et=ab;this.Rd=Hb;this.Of=pb;this.cdk=1>100*Math.random()}get sQa(){return this.t8a.sQa}set sQa(fa){this.t8a.sQa=fa}get Lmb(){return this.$ak}get Cm(){return this.RNj}init(){this.Cm.Xrk(Object(e.a)(this,this.vHd,"disconnectAndCreateNewConnection"));
this.Cm.wsk(Object(e.a)(this,this.Lon,"onUpdatePersistentStateRequestReceivedInternal"));this.Cm.vsk(Object(e.a)(this,this.Kon,"onUpdatePersistentStateClearedRequestReceived"));this.Of.d_b(this.Et);y.AFrameworkApplication.uJ(()=>{const {FrequentLoggingMetrics:fa}=c(1515);this.Et.D0f();fa.instance&&fa.instance.gIf()});this.wIh();this.kgl();this.Cm.hsk(Object(e.a)(this,this.HMo,"updateConnectionQueryString"))}kgl(){try{const Ta=$.signalR;if(!Ta)throw Error.invalidOperation("Failed to retrieve Signalr object");
const eb=Ta.version;if(!eb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===eb){var fa=Ta.transports;if(!fa)throw Error.invalidOperation("Failed to retrieve transports object");var Ca=fa.longPolling;if(!Ca)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!Ca.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");Ca.supportsKeepAlive=this.B7k()}}catch(Ta){l.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Ta.message)}}B7k(){return()=>!1}wIh(){const fa=++this.jpc;this.QFe=(new Date(0)).getTime();this.ida=this.eTj();this.Cm.wHn(this.ida);this.ida.stateChanged(Ca=>{this.egn(Ca,fa)});this.ida.connectionSlow(Object(e.a)(this,this.Cnn,"onSlowConnection"));this.ida.error(Object(e.a)(this,this.unn,"onSignalRError"));this.ida.log=Object(e.a)(this,this.vnn,"onSignalRLog")}Slc(fa,Ca){return fa!==this.jpc?(l.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
Ca),!1):!0}connect(){2!==this.P9&&1!==this.P9&&(l.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.ow),this.iue.agn(),z.a.instance.Puo(),this.fha(1,this.P9),this.zoj())}zoj(){const fa=this.jpc;this.lRe=!1;this.Et.d1i();this.t8a.Q3l(Object(e.a)(this,this.IXk,"connectSignalrConnection"),Object(e.a)(this,this.SNi,"onFailureToConnect"),Object(e.a)(this.Lmb,this.Lmb.Opm,"initThrottlerManager"),Object(e.a)(this,this.Slc,"verifyConnectionToken"),fa)}SNi(fa=null){this.Et.f1i();
let Ca=null;!fa||"documentsessiondeleted"!==(Ca=fa.toLowerCase())&&"documentsessionexpired"!==Ca?this.vHd():(l.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.ow,fa),this.disconnect())}vHd(fa,Ca=null){l.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.u5);fa=(fa=2===this.P9||1===this.P9)&&!this.Lmb.RBb;let Ta=!0,eb=0;Ca&&Object.getType(Ca)!==Object.getType(Sys.EventArgs.Empty)&&
Ca.H3f&&""!==Ca.H3f&&(fa=!0,this.t8a.ufo(Ca.H3f),Ta=Ca.U6f,eb=Ca.reconnectDelay);fa&&this.fha(1,this.P9);++this.jpc;this.Lmb.Jia();this.awo(Ta);this.t8a.Jhl();this.wIh();fa&&window.setTimeout(Object(e.a)(this,this.zoj,"startConnecting"),Math.min(eb,3E4))}HMo(){let fa=null;const Ca=({correlationId:fa}=this.t8a.M4h()).returnValue;this.ida.qs=Ca;l.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.ow,fa)}IXk(fa){const {FrequentLoggingMetrics:Ca}=
c(1515);this.QFe=(new Date).getTime();let Ta=null;this.ida.qs=({correlationId:Ta}=this.t8a.M4h()).returnValue;this.Rd.Buk&&(this.ida.url=fa,Ca.instance&&(Ca.instance.JDh=u.a.YZ(fa)));let eb=null;this.ge&&(eb=this.ge.eg("WebServiceCall","ConnectToServer"));l.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.ow);fa={};this.Hvd&&(fa.transport=1===this.Hvd.length?this.Hvd[0]:this.Hvd);fa.pingInterval=null;z.a.instance.$1c(1,0);fa.waitForPageLoad=!1;this.ida.start(fa,null).done(jb=>
{this.Et.g1i();z.a.instance.$1c(1,1,!0);l.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",jb.id,Ta)}).fail(jb=>{l.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.t8a.MW,Ta,this.ow);this.SNi();this.Et.e1i(jb);z.a.instance.$1c(1,1,!1);this.Cm.a0i(0,{["CorrelationId"]:Ta,["ErrorDetails"]:jb,["ConnectionState"]:k.a[this.P9]})}).always(()=>{const {FrequentLoggingMetrics:jb}=
c(1515);eb&&eb.stop();jb.instance&&(jb.instance.mye=!1)})}disconnect(){const {FrequentLoggingMetrics:fa}=c(1515);0===this.P9?l.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.ow):(this.Et.j1i(),fa.instance&&(fa.instance.mye=!0),l.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.ow),this.Lmb.RBb=!0,this.iue.Ugn(),this.fha(0,this.P9),this.vHd(),this.Lmb.RBb=!1)}awo(fa){const Ca=this.GKk(),Ta=this.ida,eb=this.u5,
jb=()=>{if(this.lRe)l.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.lRe=!0,Ta.stop(!0,fa)}catch(ob){l.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",ob.message)}};0<Ca?(l.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",eb,Ca),window.setTimeout(jb,Ca)):(l.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",eb),jb())}GKk(){let fa=0;0===this.ida.state&&(fa=this.QFe+Oa.pWo-
(new Date).getTime(),0>fa&&(fa=0));return fa}get connectionState(){return this.P9}$sa(fa){this.Cm.$sa(fa)}cgc(fa){this.Cm.cgc(fa)}Rcj(fa){this.lhc(0,fa)}lhc(fa,Ca){const Ta=new a.a;this.Cm.d0i(fa,Ca,Ta);return Ta.task}pYa(fa){this.Cm.pYa(fa)}TLb(fa){this.Cm.TLb(fa)}KCc(fa){this.Cm.KCc(fa)}Z2c(fa){this.Cm.Z2c(fa)}xyd(fa){this.Cm.xyd(fa)}Dbe(fa){this.Cm.Dbe(fa)}KOc(fa){return this.W$l(fa)}BCb(){return this.P5b(0)}P5b(fa){const Ca={};for(let Ta of this.W1)Ta.value.ob(fa)&&(Ca[Ta.key]=Ta.value.J(fa).data);
return Ca}W$l(fa){return this.W1.ob(fa)&&this.W1.J(fa).ob(0)?this.W1.J(fa).J(0).data:null}Lon(fa,Ca){for(let Ta of Ca.pSo)this.W1.ob(Ta.key)||this.W1.Z(Ta.key,new I.a),fa=Ta.value,this.W1.J(Ta.key).Z(Ca.type,new v(fa.Presence,new Date(fa.TimeStamp))),Ta.key===this._clientId&&0===Ca.type&&this.Cm.bHn(fa.Presence)}Kon(fa,Ca){for(const Ta of Ca.LCd)this.W1.remove(Ta)}iEl(){const fa=new I.a;if(!this.W1.ob(this._clientId))return fa;for(let Ca of this.W1.J(this._clientId))fa.Z(Ca.key,Ca.value.data);return fa}LO(fa,
Ca=null,Ta=!1){const eb=new a.a;this.Cm.M_f(fa,Ca,Ta,eb);return eb.task}t2(fa){this.Cm.t2(fa)}ULb(fa){this.Cm.ULb(fa)}fhb(fa){let Ca,Ta;return({value:Ca}=this.W1.Ec(fa)).returnValue&&({value:Ta}=Ca.Ec(0)).returnValue?new m(this.aam(Ta),Ta.timeStamp):null}XLc(){const fa={};for(let Ca of this.W1)Ca.value.Ec(0).returnValue&&(fa[Ca.key]=this.fhb(Ca.key));return fa}ipb(fa){const Ca=new a.a;this.Cm.j0i(fa,Ca);return Ca.task}get clientId(){return this._clientId}get ero(){return this.cdk}dispose(){const {FrequentLoggingMetrics:fa}=
c(1515);this.Xl||(this.Lmb.Jia(),this.Of.sbe(this.Et),this.Et.D0f(),fa.instance&&fa.instance.gIf(),this.Xl=!0)}egn(fa,Ca){this.Slc(Ca,"StateChangedSignalR")&&this.fha(this.sFh(fa.newState),this.sFh(fa.oldState))}fha(fa,Ca){var {FrequentLoggingMetrics:Ta}=c(1515),{ClientToClientMessageTelemetry:eb}=c(1755);if((1!==this.P9||0!==Ca||1!==fa)&&this.P9!==Ca){const jb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.P9,
Ca,fa]));l.ULS.sendTraceTag(3290053,500,10,jb)}if(this.P9!==fa){switch(fa){case 2:Ta.instance&&Ta.instance.k4m();this.u5=this.ida.id;l.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.u5,this.ow);this.e1m(this.ida);l.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Ta=null;this.ge&&(Ta=this.ge.eg("WebServiceCall","Receive First Presence"));eb=this.jpc;this.Cm.vHn(Object(e.a)(this,this.Slc,"verifyConnectionToken"),eb,this.iue,Object(e.a)(this,
this.d5e,"clearExistingPersistentState"),this.iEl(),Ta);this.Rd.z2n&&(Ta=100*Math.random()<=this.Rd.A2n,c(1755).ClientToClientMessageTelemetry.W6b(this.Cm,this.Rd,Ta).start());break;case 1:2===Ca&&l.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.u5);break;case 0:if(eb.instance&&eb.instance.stop(),this.Lmb.RBb)l.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.u5);else{1===Ca&&(l.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.u5),this.Et.k1i());2===Ca&&l.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.u5);this.vHd();return}}this.P9=fa;this.Cm.CGn(fa,Ca)}}e1m(fa){if(fa&&fa.transport&&fa.transport.name){fa=fa.transport.name;var Ca=fa.toLowerCase();
"websockets"===Ca?l.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",fa,this.ow):"serversentevents"===Ca?l.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",fa,this.ow):"foreverframe"===Ca?l.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",fa,this.ow):"longpolling"===Ca?l.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",fa,this.ow):"mocktransport"!==Ca&&l.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
fa)}else l.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}Cnn(){if(this.Rd.x$i){const fa=u.a.JT(this.sQa,"mid");l.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.u5,fa)}else l.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.u5)}unn(){l.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.u5)}vnn(fa){fa=c(1495).RtcUtils.hdc(fa);if(this.Rd.x$i&&fa.startsWith("Keep alive timed out.")){const Ca=
u.a.JT(this.sQa,"mid");l.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",fa,Ca)}else this.ero&&2E3>this.Sch&&!fa.startsWith("Invok")&&!fa.startsWith("Trigger")&&(l.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",fa),this.Sch++)}d5e(){let fa;const Ca=[];({value:fa}=this.W1.Ec(this._clientId)).returnValue&&this.W1.remove(this._clientId);for(let Ta of this.W1.keys)Array.add(Ca,Ta);for(const Ta of Ca)this.W1.remove(Ta);fa&&this.W1.Z(this._clientId,fa);this.Cm.WGn(Ca)}sFh(fa){switch(fa){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",fa,"Unknown SignalR state");}}aam(fa){return fa&&fa.timeStamp?(new Date).getTime()-fa.timeStamp.getTime()>(this.Rd.$Bk?6E4:this.Rd.ZBk)?2:1:1}static createInstance(fa,Ca,Ta,eb,jb,ob,Ya,Xa=null,Sa=null,ab=null,Hb=null,pb=null,Mb=null){return pa(fa,Ca,Ta,Mb,eb,jb,ob,Ya,Xa,Sa,ab,pb,Hb)}}Oa.VGi=31E3;Oa.RJf=8E3;Oa.pWo=15E3;Object(D.a)(Oa,"RealtimeChannel",null,[880,881])},1611:function(D,L,c){c.d(L,"a",function(){return l});
D=c(0);class l{constructor(){this.Vdh=!1;this.Bvb=null;this.kNg=0;this.Lye=this.MJh();this.wed=this.MJh();this.Uqb=this.ZTb=0;this.ir=()=>new Date}get gxo(){return this.Vdh}MJh(){const e=Array(6);for(let a=0;a<e.length;a++)e[a]=0;return e}VOl(){return this.Lye.toString()}BJl(){return this.wed.toString()}Puo(){this.Bvb=this.ir()}$1c(e,a,k=!1){this.gxo||(k&&(this.Vdh=!0),k=this.ir(),0===e&&5<this.ZTb||1===e&&5<this.Uqb||(this.kNg<e?(1===this.ZTb%2&&(this.Lye[this.ZTb]=-1,this.ZTb++),this.kNg=e,1===
a&&(this.wed[this.Uqb]=-1,this.Uqb++),this.wed[this.Uqb]=this.ldg(k),this.Uqb++):0===e?(this.Lye[this.ZTb]=this.ldg(k),this.ZTb++):(this.wed[this.Uqb]=this.ldg(k),this.Uqb++)))}ldg(e){const a=e.getTime()-this.Bvb.getTime();this.Bvb=e;return a}static get instance(){l._instance||(l._instance=new l);return l._instance}static set instance(e){l._instance=e}}l._instance=null;Object(D.a)(l,"LatencyMetrics",null,[])},1642:function(D,L,c){D=c(0);class l{constructor(){this.gKg=this.aue=!1;this.callback=null}TYc(a){this.callback=
a;this.Iuj()}mGi(a){this.aue||(this.aue=!0,this.XSj=a,this.Iuj())}Iuj(){this.aue&&this.callback&&!this.gKg&&(this.gKg=!0,this.callback(this.XSj))}}Object(D.a)(l,"CompletionTask",null,[]);c.d(L,"a",function(){return e});class e{constructor(){this.a3g=new l;this.Z2g=new l}H5d(a){this.a3g.TYc(a)}G5d(a){this.Z2g.TYc(a)}$Wc(a){this.a3g.mGi(a)}jkb(a){this.Z2g.mGi(a)}EJf(){this.$Wc(2);this.jkb(2)}}Object(D.a)(e,"MessageStatus",null,[923])},1693:function(D,L,c){c.r(L);c.d(L,"MaxOutstandingThrottler",function(){return k});
D=c(0);var l=c(46),e=c(67);L=c(1694);var a=c(1642);class k extends L.a{constructor(x,y=""){super(x,y);this.mcc=this.Mob=0;this.ra=new e.a;this.eVb=!1;this.kod=this.Yed=this.xed=this.OSe=0;this.m2=[];this.clearTimeout=k.Raf}add(x){this.fVb||this.init(k.SLh,k.DLh);this.ixb++;const y=new a.a;this.O$b?this.Afe(x,y):this.kod<this.mcc?this.V4c(x,y):(this.Afe(x,y),this.eVb=!1);return y}V4c(x,y){x=this.kbh(x);const m=this.setTimeout(Object(l.a)(this,this.Xjn,"onMessageWaitTimeExpired"),this.Mob);++this.kod;
Array.add(this.m2,m);const u=this.xed;x.H5d(z=>{y.$Wc(z)});x.G5d(z=>{this.xed===u&&(this.Wjn(u,m),y.jkb(z))})}Wjn(x,y){this.xed===x&&(--this.kod,this.clearTimeout(y),Array.remove(this.m2,y),this.O$b&&this.r8n())}r8n(){this.O$b&&!this.eVb&&(this.OSe=this.setTimeout(Object(l.a)(this,this.s8n,"sendThrottledMessageFromTimer"),0),this.eVb=!0)}s8n(){this.eVb=!1;if(this.O$b){const x=this.avd,y=this.QYb;this.mFc(!1);this.V4c(x,y)}}Xjn(){++this.Yed;this.Yed>Math.floor(this.mcc/2)&&(this.Yed=-1E9,this.ra.raiseEvent("TMUDM"))}Ayd(x){this.ra.addHandler("TMUDM",
x)}reset(){this.ixb=this.VAc=this.Wqc=this.Yed=0;++this.xed;for(const x of this.m2)this.clearTimeout(x);this.kod=0;this.m2=[];this.mFc(!0);this.eVb&&(this.clearTimeout(this.OSe),this.OSe=0,this.eVb=!1)}init(x,y){this.fVb||(this.Mob=x,this.mcc=y,this.fVb=!0)}static createInstance(x,y=""){return new k(x,y)}static Raf(x){window.clearTimeout(x)}}k.SLh=15E3;k.DLh=5;Object(D.a)(k,"MaxOutstandingThrottler",L.a,[920,921])},1694:function(D,L,c){c.d(L,"a",function(){return e});D=c(0);var l=c(8);class e{constructor(a,
k=""){this.Wqc=this.VAc=0;this.QDe=!1;this.QYb=this.avd=null;this.fVb=!1;this.kbh=a;this.Bsj=k;this.setTimeout=e.Yaf;this.ixb=this.VAc=this.Wqc=0}C0f(){0<this.ixb&&0<this.Wqc&&l.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Bsj,this.Wqc,this.ixb);0<this.ixb&&0<this.VAc&&l.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Bsj,this.VAc,this.ixb)}get O$b(){return this.QDe}Afe(a,k){this.VAc++;this.mFc(!0);this.QDe=
!0;this.avd=a;this.QYb=k}mFc(a){this.QDe=!1;this.QYb&&a&&(this.Wqc++,this.QYb.EJf());this.QYb=this.avd=null}static Yaf(a,k){return window.setTimeout(a,k)}}Object(D.a)(e,"ThrottlerBase",null,[])},1695:function(D,L,c){c.r(L);c.d(L,"MaxRateThrottler",function(){return a});D=c(0);var l=c(46);L=c(1694);var e=c(1642);class a extends L.a{constructor(k,x=""){super(k,x);this.wcc=0;this.avc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(k){this.fVb||(this.wcc=k,this.fVb=!0)}add(k){this.fVb||
this.init(a.sLh);this.ixb++;const x=this.currentTime(),y=new e.a;this.avc>x&&(this.avc=x);this.O$b?(this.mFc(!0),this.Afe(k,y)):this.avc+this.wcc<=x?this.V4c(k,y):(this.Afe(k,y),this.setTimeout(Object(l.a)(this,this.q8n,"sendThrottledMessage"),this.avc+this.wcc-x));return y}q8n(){if(this.O$b){const k=this.avd,x=this.QYb;this.mFc(!1);this.V4c(k,x)}}V4c(k,x){this.avc=this.currentTime();k=this.kbh(k);k.H5d(y=>{x.$Wc(y)});k.G5d(y=>{x.jkb(y)})}static createInstance(k,x=""){return new a(k,x)}}a.sLh=200;
Object(D.a)(a,"MaxRateThrottler",L.a,[922,921])},1696:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a,k,x){super();this.type=e;this.dL=a;this.bdl=k;this.B6a=x}}Object(D.a)(l,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1698:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l{}l.F5f="rr";l.C2n="rd";l.y2n="rbp";l.U6f="sa";Object(D.a)(l,"RtcReconnectParams",null,[])},1699:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l{constructor(e,
a,k,x){this.I7m=e;this.Mob=a;this.I5m=k;this.ncm=x}}Object(D.a)(l,"ThrottlerManagerSettings",null,[])},1740:function(D,L,c){D=c(0);class l extends Sys.EventArgs{constructor(I,T){super();this.newState=I;this.oldState=T}}Object(D.a)(l,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(I,T){super();this.iSk=I;this.B6a=T}}Object(D.a)(e,"ClientInfoEventArgs",Sys.EventArgs,[]);class a extends Sys.EventArgs{constructor(I){super();this.presence=I}}Object(D.a)(a,
"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var k=c(1857),x=c(1856),y=c(1854);class m extends Sys.EventArgs{constructor(I,T=null){super();this.yk=I;this.Igk=T}get type(){return this.yk}get dL(){return this.Igk}}Object(D.a)(m,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class u extends Sys.EventArgs{constructor(){super()}}Object(D.a)(u,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(I,T,U,W,V,Y){super();this.Slc=I;this.c7e=T;this.KXk=
U;this.$Th=V;this.d5e=W;this.jz=Y}}Object(D.a)(z,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(I){super();this.hubConnection=I}}Object(D.a)(v,"RefreshProxyEventArgs",Sys.EventArgs,[]);class E extends Sys.EventArgs{constructor(I,T){super();this.zfa=I;this.errorMessage=T}}Object(D.a)(E,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class F extends Sys.EventArgs{constructor(I,T,U){super();this.type=I;this.presence=T;this.B6a=U}}Object(D.a)(F,"SendPersistentStateEventArgs",
Sys.EventArgs,[]);var J=c(1696);class K extends Sys.EventArgs{constructor(){super()}}Object(D.a)(K,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class H extends Sys.EventArgs{constructor(I){super();this.LCd=I}}Object(D.a)(H,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class P extends Sys.EventArgs{constructor(I,T){super();this.type=I;this.pSo=T}}Object(D.a)(P,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var N=c(67);c.d(L,"a",function(){return M});class M{constructor(){this.ra=
new N.a}CGn(I,T){this.ra.raiseEvent("CSC",new l(I,T))}wHn(I){this.ra.raiseEvent("RP",new v(I))}sae(I){this.ra.raiseEvent("RC",I)}zHn(){this.ra.raiseEvent("RMID")}vHn(I,T,U,W,V,Y){this.ra.raiseEvent("RPS",new z(I,T,U,W,V,Y))}k0i(I,T){this.ra.raiseEvent("UPSR",new P(I,T))}X_i(I,T){this.ra.raiseEvent("PU",new y.a(I,T))}bHn(I){this.ra.raiseEvent("MPU",new a(I))}M_f(I,T,U,W){this.ra.raiseEvent("SUN",new J.a(I,T,U,W))}OHn(I,T){this.ra.raiseEvent("UNR",new m(I,T))}d0i(I,T,U){this.ra.raiseEvent("SP",new F(I,
T,U))}qHn(I,T){this.ra.raiseEvent("PSU",new x.a(I,T))}pHn(I){this.ra.raiseEvent("PSC",new k.a(I))}WGn(I){this.ra.raiseEvent("IPSC",new k.a(I))}PHn(I){this.ra.raiseEvent("UPSC",new H(I))}BHn(I,T){this.ra.raiseEvent("SPC",new K(I,T))}a0i(I,T){this.ra.raiseEvent("RCF",new E(I,T))}PGn(I){this.ra.raiseEvent("CPSWM",new u(I))}j0i(I,T){this.ra.raiseEvent("UCI",new e(I,T))}$sa(I){this.ra.addHandler("CSC",I)}cgc(I){this.ra.removeHandler("CSC",I)}Yrk(I){this.ra.addHandler("RP",I)}Xrk(I){this.ra.addHandler("RC",
I)}ask(I){this.ra.addHandler("RMID",I)}Wrk(I){this.ra.addHandler("RPS",I)}wsk(I){this.ra.addHandler("UPSR",I)}pYa(I){this.ra.addHandler("PU",I)}TLb(I){this.ra.removeHandler("PU",I)}Zpk(I){this.ra.addHandler("IPU",I)}tsk(I){this.ra.addHandler("UCI",I)}fsk(I){this.ra.addHandler("SUN",I)}$pk(I){this.ra.addHandler("IUNR",I)}t2(I){this.ra.addHandler("UNR",I)}ULb(I){this.ra.removeHandler("UNR",I)}KCc(I){this.ra.addHandler("PSU",I)}Z2c(I){this.ra.removeHandler("PSU",I)}Ypk(I){this.ra.addHandler("IPSU",I)}xyd(I){this.ra.addHandler("PSC",
I)}Dbe(I){this.ra.removeHandler("PSC",I)}Xpk(I){this.ra.addHandler("IPSC",I)}vsk(I){this.ra.addHandler("UPSC",I)}dsk(I){this.ra.addHandler("SP",I)}hsk(I){this.ra.addHandler("SPC",I)}static getInstance(){return M._instance||(M._instance=new M)}}M._instance=null;Object(D.a)(M,"RtcEventHub",null,[911])},1744:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(46),a=c(76),k=c(880);class x{}x.wcc="throttling_messageDelay";x.QTc="enabled";x.Mob="throttling_timeToWaitForResponse";x.mcc="throttling_maxNumberOfOutstandingMessages";
x.bgi="throttling_globalMaxNumberOfOutstandingMessages";x.errorMessage="errorMessage";x.Mmj="url";x.vGa="queryString";x.MW="connectionString";Object(D.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=c(2),m=c(45),u=c(35),z=c(294),v=c(1370),E=c(72),F=c(16),J=c(118);class K{constructor(){this.cgi=this.SGi=this.TGi=this.YGi=0;this.wYd=!1;this.correlationId=this.MW=this.vGa=this.d7e=this.errorMessage=null}get FWk(){return this.d7e+"?"+this.vGa}}Object(D.a)(K,"FindSessionResponse",null,[]);
var H=c(597);class P{constructor(ba,ja,sa,ta,ra,ma){this.OWa=null;const {FindSessionStrategy:Ba}=c(1744);this.p$j=ba;ba=String.format("{0}={1}",H.a.clientId,F.a.Mj(ta));ba=String.format("{0}&{1}={2}",ba,H.a.userSessionId,F.a.Mj(ra));ba=String.format("{0}&{1}={2}",ba,H.a.dCj,F.a.Mj(sa.toString()));ba=String.format("{0}&{1}={2}",ba,H.a.userType,F.a.Mj("1"));ba=String.format("{0}&{1}={2}",ba,H.a.pCj,F.a.Mj(ja));ba=String.format("{0}&{1}={2}",ba,H.a.XAh,F.a.Mj(Ba.kSk));(ja=P.ilf(sa,ma))&&(ba=String.format("{0}&{1}",
ba,ja));this.gTj=ba}l2i(){this.OWa=this.p$j()}generate(){this.OWa&&""!==this.OWa||(this.l2i(),l.ULS.sendTraceTag(575784194,500,this.OWa&&""!==this.OWa?50:15,"Query signature delegate called for refresh returned: {0} ",this.OWa));const ba=String.format("{0}={1}",H.a.kLb,F.a.Mj(this.OWa));return String.format("{0}&{1}",ba,this.gTj)}static ilf(ba,ja){return 4===ba?String.format("{0}={1}",H.a.rKi,"1"):ja?ja.Zei():null}}Object(D.a)(P,"FindSessionQueryStringGenerator",null,[]);var N=c(1515),M=c(1611),I=
c(1495),T=c(1699);class U{}U.$vl="FSType";Object(D.a)(U,"RtcFindSessionRequestHeaders",null,[]);class W{}W.MIn="polling";Object(D.a)(W,"RtcFindSessionTypes",null,[]);var V=c(1698);class Y{}Y.fVo="RTC-TokenProofkey";Y.XMm="RTC-IsWacJsBootFsRequest";Object(D.a)(Y,"RtcRequestHeaders",null,[]);c.d(L,"FindSessionStrategy",function(){return da});class da{constructor(ba,ja,sa,ta,ra,ma,Ba,Pa,Da,Ha,oa,wa,ia=null){this.X_g=(new Date(0)).getTime();this.h2g=0;this.Tmd=!1;this.xbh=null;this.R0f=36E5;this.sSb=
da.vmi;this.Arc=0;this.gMb=null;this.jSa=0;this.Ngc=this.LDh=null;this.pak=[x.QTc,x.errorMessage,x.Mmj,x.MW,x.vGa,x.bgi,x.mcc,x.Mob,x.wcc];this.oak=[x.QTc,x.errorMessage];this.MW=this.sQa=null;this.NRg=new P(oa?oa:()=>y.AFrameworkApplication.fm,ra,ma,Ba,ba,ja);this.Boc=wa;this.ge=ta;this.Of=ja;this.Pye=sa;this.ow=Pa;this.Cm=Da;this.Vrc=ia;this.ORg=!1;this.RKd=9E4;Ha&&Ha.execute(ca=>{ca.nYa(()=>{l.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.ow);
this.NRg.l2i()})});2>=100*Math.random()&&(this.R0f=3E5);N.FrequentLoggingMetrics.instance&&(N.FrequentLoggingMetrics.instance.oZh=this.R0f)}ufo(ba){this.Ngc=ba}init(){this.Cm.ask(Object(e.a)(this,this.JZn,"resetGetMachineIdDelay"));this.Cm.$sa(Object(e.a)(this,this.fha,"onConnectionStateChanged"))}fha(ba,ja){this.jSa=ja.newState;2===ja.newState&&(this.Arc=0)}M4h(){let ba;ba=this.gMb.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.gMb.vGa,da.bGh,F.a.Mj(ba)),correlationId:ba}}Q3l(ba,
ja,sa,ta,ra){this.p7n(()=>{ta(ra,"GetMachineIdSuccess")&&(l.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.MW,this.ow),ba(this.xbh),sa(this.$8l()))},ma=>{ta(ra,"GetMachineIdFailure")&&(l.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.ow),ja(ma))},ta,ra)}Jhl(){this.DAh();this.gom()}p7n(ba,ja,sa,ta){l.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",
this.MW);if(this.MW)ba();else{var ra=this.OJk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(ba,ja,sa,ta)},ra)}}sendFindSessionRequestToServerInternal(ba,ja,sa,ta){sa(ta,"RequestMachineId")&&(this.X_g=(new Date).getTime(),sa=u.a.Ue(),this.NNd(ra=>{const ma=u.a.Ue();this.PUi(ra);this.V8f();ba();ra=u.a.Ue()-ma;l.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ra)},ra=>{const ma=u.a.Ue();this.DAh();N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.pO(2,
3);ja(ra);ra=u.a.Ue()-ma;l.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ra)},!1),sa=u.a.Ue()-sa,l.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",sa))}gom(){this.sSb+=da.HVl;this.sSb=Math.min(this.sSb,da.s5m)}OJk(){var ba=(new Date).getTime();ba=this.X_g+this.sSb-ba;0>ba&&(ba=0);return ba}PUi(ba){try{this.gMb=ba,this.sQa=ba.FWk,this.MW=ba.MW,this.LDh=ba.vGa,this.xbh=ba.d7e}catch(ja){l.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ja.toString())}}DAh(){this.MW=null;this.EAh()}V8f(){this.EAh();this.Tmd=!0;this.h2g=window.setTimeout(Object(e.a)(this,this.VMn,"refreshMachineId"),this.R0f)}EAh(){this.Tmd&&(window.clearTimeout(this.h2g),this.Tmd=!1)}VMn(){this.Tmd=!1;this.NNd(ba=>{const ja=this.LDh!==ba.vGa,sa=this.MW!==ba.MW,ta=this.MW;this.PUi(ba);0!==this.jSa&&(sa?(l.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",ta||"null",ba.MW),this.Cm.sae()):(this.Cm.BHn(ja,sa),
this.V8f()))},()=>{N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.pO(2,3);this.V8f()},!0)}JZn(){this.sSb=da.vmi}$8l(){return new T.a(this.gMb.YGi,this.gMb.TGi,this.gMb.SGi,this.gMb.cgi)}rFo(ba){if(Object.getType(ba)!==Object)return null;for(let ja in ba);return this.u3k(ba)}u3k(ba){if(!(x.QTc in ba))return null;const ja=ba[x.QTc];var sa=ja?this.pak:this.oak;for(const ta of sa)if(!(ta in ba))return null;sa=Object.assign(new K,{wYd:ba[x.QTc],errorMessage:ba[x.errorMessage],correlationId:J.a.create().toString()});
ja&&(sa.d7e=ba[x.Mmj],sa.vGa=ba[x.vGa],sa.MW=ba[x.MW],sa.cgi=ba[x.bgi],sa.SGi=ba[x.mcc],sa.TGi=ba[x.Mob],sa.YGi=ba[x.wcc]);return sa}WOl(ba,ja){l.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.Vrc.zWh.continueWith(()=>{this.Vrc.zWh.result?(l.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),ba(this.Vrc.AWh)):(l.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ja(this.Vrc.AWh))})}Y7i(ba,ja,
sa,ta,ra=!1){return ma=>{M.a.instance.$1c(0,1);ba&&ba.stop();this.Boc=this.Ngc=null;this.hEi(ma.data,!0,ja);var Ba=I.RtcUtils.deserialize(ma.data.we,"FindSession",null);if(Ba)if(Ba=this.rFo(Ba)){if(Ba.wYd&&Ba.vGa&&Ba.MW){l.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.ow);this.TWm(ma.data);sa(Ba);return}ja.FindSessionFailureReason="FindSessionInvalidResponse";ja.IsRtcEnabled=Ba.wYd;ja.IsQueryStringEmpty=!Ba.vGa;ja.IsConnectionStringEmpty=!Ba.MW;l.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.ow,Ba.wYd,!Ba.vGa,!Ba.MW)}else ja.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",l.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.ow);else ja.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",l.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.ow);this.b0i(ja,ra);ta(null)}}S7i(ba,ja,sa,ta=!1){return ra=>{M.a.instance.$1c(0,1);ba&&ba.stop();this.Boc=this.Ngc=null;this.hEi(ra.data,!1,ja);let ma=null;var Ba="unknown";let Pa="unknown";ra.data&&((Ba=ra.data.vj)&&da.m4c in Ba&&(ma=Ba[da.m4c].toString()),Ba=v.a[ra.data.status],Pa=ra.data.Ve.toString());ja.FindSessionFailureReason="FindSessionRequestFailed";ja.HttpErrorCode=Pa;ja.HttpErrorStatus=Ba;ja[da.m4c]=ma;l.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
Ba,Pa,this.ow,ma,ta);this.b0i(ja,ta);sa(Pa)}}NNd(ba,ja,sa=!1){let ta=null;l.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.ow);const ra={};var ma=this.NRg.generate();ra[z.a.g7]=J.a.create().toString();this.Ngc&&""!==this.Ngc?ma=String.format("{0}&{1}={2}",ma,V.a.F5f,this.Ngc):this.Boc&&""!==this.Boc&&(ma=String.format("{0}&{1}={2}",ma,V.a.F5f,this.Boc),ra[Y.fVo]="True",ra[Y.XMm]="True");ma=this.Pye+"?"+ma;sa&&(ra[U.$vl]=W.MIn);const Ba={};Ba.IsNetworkOfflineBeforeSendRequest=
this.Of.DPa;Ba.HasAvailableConnectionsBeforeSendRequest=this.Of.bTd;Ba.MaxConnectionsAllowed=this.Of.jcc;Ba.IsRefreshMachineId=sa;this.Vrc&&!this.ORg?(this.WOl(this.Y7i(null,Ba,ba,ja,sa),this.S7i(null,Ba,ja,sa)),this.ORg=!0):(this.ge&&(ta=this.ge.eg("WebServiceCall","GetMachineIdFromTheServer")),N.FrequentLoggingMetrics.instance&&N.FrequentLoggingMetrics.instance.pO(2,0),0>this.Of.dyb(ma,1,null,ra,[da.SEd,da.m4c,da.zYc,da.E5f,da.oJi,da.PLi,da.OLi],1,this.Y7i(ta,Ba,ba,ja,sa),this.S7i(ta,Ba,ja,sa),
null,!1,null,this.RKd,"3",null,!0)&&(5<this.Arc&&200>this.Arc&&l.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.Arc),window.setTimeout(()=>{this.Arc++;ja("-1")},1E3)))}hEi(ba,ja,sa){sa||(sa={});sa.IsNetworkOfflineAfterRequestComplete=this.Of.DPa;sa.IsRequestSucceeded=ja;ba&&(sa.EnqueueTime=ba.GNa,sa.InvokedTime=ba.tH,sa.CompletedTime=ba.XS,ba.vj&&(da.SEd in ba.vj&&(sa.CorrelationId=ba.vj[da.SEd]),da.zYc in
ba.vj&&(sa[da.zYc]=ba.vj[da.zYc])));l.ULS.sendTraceTag(38633565,500,ja?50:15,I.RtcUtils.hdc(sa))}b0i(ba,ja){ba||(ba={});ba.ConnectionState=k.a[this.jSa];ja||this.Cm.a0i(1,ba)}TWm(ba){try{var ja=!1,sa=!1,ta=ba.vj,ra=m.a.YZ(ba.request.get_url());if(ta&&da.E5f in ta){const Ha=ta[da.E5f].toString().toLocaleLowerCase();sa="true"===Ha;ja="false"===Ha}ta=!1;const Da=0<=ra.toLocaleLowerCase().indexOf("collab");sa&&!Da?ta=!0:ja&&Da&&(ta=!0);if(ta){ja={};ja.HostName=ra;ja.Status=v.a[ba.status];ja.HttpStatus=
ba.Ve.toString();var ma=ba.request.get_headers();for(let Ha in ma){var Ba=ma[Ha];(ra=Ha)&&0<ra.length&&(sa=0,Ba&&(sa=Ba.toString().length),ja["r_"+ra]=sa)}if(ba.vj){const Ha=new a.a;Ha.add(da.SEd);Ha.add(da.zYc);Ha.add(da.m4c);Ha.add(da.PLi);Ha.add(da.OLi);Ha.add(da.oJi);da.Fnk(ja,ba.vj,Ha)}da.pnk(ba.request.get_url(),ja);var Pa=E.a.toJSON(ja);l.ULS.sendTraceTag(559437006,500,15,Pa)}}catch(Da){l.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",Da.toString())}}static createInstance(ba,
ja,sa,ta,ra,ma,Ba,Pa,Da,Ha,oa,wa=null){return da.u4k(ba,ja,sa,ta,ra,ma,Ba,Pa,Da,Ha,oa,wa)}static u4k(ba,ja,sa,ta,ra,ma,Ba,Pa,Da,Ha,oa,wa=null){ba=ba||J.a.create().toString();ba=new da(ba,ja,sa,ta,ra,ma,Ba,Pa,Da,Ha,null,oa,wa);ba.init();return ba}static Fnk(ba,ja,sa){for(let ta of sa)ta in ja&&(ba[ta]=ja[ta])}static pnk(ba,ja){if(ba){var sa=ba.indexOf("?");if(-1!==sa)for(ba=ba.substr(sa+1).split("&"),sa=0;sa<ba.length;++sa){var ta=ba[sa].split("=");if(2===ta.length){const ra=ta[0];if(ra&&0<ra.length){let ma=
0;if(ta=ta[1])ma=ta.length;ja["q_"+ra]=ma}}}}}}da.HVl=3E3;da.s5m=3E5;da.kSk="1.0";da.vmi=1E3;da.SEd="X-CorrelationId";da.bGh="corrid";da.m4c="RtcErrorCode";da.zYc="X-OfficeCluster";da.E5f="X-NewEnv";da.oJi="X-MSEdge-Ref";da.OLi="X-OFFICEFD";da.PLi="X-OfficeFE";Object(D.a)(da,"FindSessionStrategy",null,[907])},1755:function(D,L,c){c.r(L);D=c(0);var l=c(8),e=c(46),a=c(438),k=c(60),x=c(76);class y{constructor(u){this.messageId=u;this.u8n=(new Date).getTime();this.ZFf=new x.a}}Object(D.a)(y,"MessageLatencyDetails",
null,[]);c.d(L,"ClientToClientMessageTelemetry",function(){return m});class m{constructor(u,z,v){this.LKa=null;this.wHe=this.uPe=0;this.Rd=z;this.b3g=v;this.Lzc=!1;this.Cm=u;this.Cm.t2(Object(e.a)(this,this.jJn,"receiveMessage"))}start(){if(this.b3g&&!this.Lzc){const u=this.Rd.B$i;this.wHe=this.Rd.w$i;u<=this.wHe?(l.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.Rd.B$i,this.Rd.w$i),this.b3g=!1):(this.Lzc=!0,this.uPe=window.setInterval(Object(e.a)(this,this.sendMessage,"sendMessage"),u))}}sendMessage(){if(this.Lzc){const u=k.a.create().toString();this.LKa=new y(u);this.Cm.M_f(16,u,!1,new a.a);window.setTimeout(()=>{this.oZm(u)},this.wHe)}}oZm(u){this.LKa&&this.LKa.messageId===u&&(0<this.LKa.ZFf.count?(u=this.LKa.ZFf.toArray().join(","),l.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",u)):l.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.LKa=null)}stop(){this.uPe&&(window.clearInterval(this.uPe),this.Lzc=!1)}jJn(u,z){16===z.type?this.Cm.M_f(17,z.dL,!1,new a.a):17===z.type&&this.Lzc&&z.dL&&this.processMessage(z.dL)}processMessage(u){u&&this.LKa&&u.toString()===this.LKa.messageId&&(u=(new Date).getTime()-this.LKa.u8n,this.LKa.ZFf.add(u))}static get instance(){return m._instance}static W6b(u,z,v){return m.instance||(m._instance=new m(u,z,v))}}m._instance=null;Object(D.a)(m,"ClientToClientMessageTelemetry",null,[])},1854:function(D,
L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.rqa=e;this.wHd=a}}Object(D.a)(l,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1855:function(D,L,c){c.r(L);c.d(L,"RealtimeChannelMetrics",function(){return x});D=c(0);var l=c(8),e=c(187),a=c(72),k=c(1495);class x{constructor(){this.J4g=this.K4g=this.L4g=this.F4g=this.E4g=this.G4g=this.Fwc=this.jJe=0;this.RJa=this.pGe=this.cvc=this.bGe=this.TVa=this.PFe=this.bab=this.Ouc=this.oVb=this.OFe=this.whd=
this.LTb=null;this.HHe=this.Uvc=this.vbh=this.lLg=0;this.c3g=!1;this.d1i=this.n0f;this.g1i=this.q0f;this.f1i=this.p0f;this.k1i=this.s0f;this.j1i=this.r0f;this.D0f=this.E0f;this.a2c=this.B0f;this.wLb=this.z0f;this.xLb=this.A0f;this.e1i=this.o0f;this.HQa=this.PNf;this.Bkb=this.QNf}n0f(){this.jJe++;this.OFe=new Date;this.LTb||(this.LTb=new Date)}q0f(){this.Fwc++;this.bab=new Date;this.whd||(this.whd=this.bab);this.cvc=this.bab;this.YWk()}p0f(){this.G4g++;this.PFe=new Date}s0f(){this.E4g++;this.oVb=new Date}r0f(){this.F4g++;
this.Ouc=new Date}B0f(){this.TVa=new Date;this.L4g++}A0f(){this.RJa||(this.RJa=new Date);this.K4g++}z0f(){this.bGe=new Date;this.J4g++}E0f(){!this.c3g&&this.jJe&&(l.ULS.sendTraceTag(39321871,500,15,a.a.toJSON(this.UTk())),this.c3g=!0)}o0f(y){let m,u;({uki:y,wki:m,exception:u}=k.RtcUtils.Arl(y));y&&y!==e.a.oz&&(l.ULS.sendTraceTag(40157596,500,15,a.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:m,["Exception"]:u})),e.a.zzf(y)&&this.lLg++,e.a.BDf(y)&&this.vbh++)}PNf(){this.pGe=new Date}QNf(){this.oVb=
this.cvc=new Date}UTk(){return{["numberOfConnectionAttempts"]:this.jJe,["numberOfSuccessfulConnections"]:this.Fwc,["numberOfFailedConnections"]:this.G4g,["numberOfDisconnectedConnections"]:this.E4g,["numberOfExplicitDisconnectedConnections"]:this.F4g,["numberOfSentMessages"]:this.L4g,["numberOfReceivedMessages"]:this.K4g,["numberOfLostMessages"]:this.J4g,["firstConnectionAttempt"]:this.LTb?this.LTb:null,["firstMessageReceived"]:this.RJa?this.RJa:null,["firstConnectionSuccess"]:this.whd?this.whd:null,
["lastConnectionAttempt"]:this.OFe?this.OFe:null,["lastConnectionSuccess"]:this.bab?this.bab:null,["lastConnectionFailure"]:this.PFe?this.PFe:null,["lastMessageSent"]:this.TVa?this.TVa:null,["lastMessageLost"]:this.bGe?this.bGe:null,["lastDisconnect"]:this.oVb?this.oVb:null,["lastExplicitDisconnect"]:this.Ouc?this.Ouc:null,["lastTimeOnline"]:this.cvc?this.cvc:null,["lastTimeOffline"]:this.pGe?this.pGe:null,["maxDisconnectedTimeMs"]:this.Uvc,["maxExplicitDisconnectedTimeMs"]:this.HHe,["clientConnectionErrors"]:this.lLg,
["serverConnectionErrors"]:this.vbh}}YWk(){this.LTb&&1===this.Fwc&&(this.Uvc=Math.max(this.Uvc,this.bab.getTime()-this.LTb.getTime()));this.oVb&&1<this.Fwc&&(this.Uvc=Math.max(this.Uvc,this.bab.getTime()-this.oVb.getTime()));this.Ouc&&1<this.Fwc&&(this.HHe=Math.max(this.HHe,this.bab.getTime()-this.Ouc.getTime()))}static createInstance(y){x._instance||(x._instance=new x,l.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x._instance}}x._instance=null;Object(D.a)(x,
"RealtimeChannelMetrics",null,[908,183])},1856:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e,a){super();this.type=e;this.rqa=a}}Object(D.a)(l,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1857:function(D,L,c){c.d(L,"a",function(){return l});D=c(0);class l extends Sys.EventArgs{constructor(e){super();this.LCd=e}}Object(D.a)(l,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},2024:function(D,L,c){c.r(L);var l=c(0),e=c(46);class a{constructor(Ea,
yb){this.Rda=null;this.Oxc=Ea;this.o9j=yb}init(){this.Oxc.continueWith(()=>{this.Rda=this.Oxc.result;this.Rda.w_b(Object(e.a)(this,this.Rba,"onUsersUpdated"))})}Rba(){a.Q_e(this.Rda.U_a())&&(this.Rda.V2f(Object(e.a)(this,this.Rba,"onUsersUpdated")),this.o9j.IsRealCoauthSession=!0)}get xIm(){return this.Rda?a.Q_e(this.Rda.U_a()):!1}static Q_e(Ea){let yb=null;for(const kc of Ea)if(kc)if(Ea=kc.isAnonymous||!kc.email?kc.clientId:kc.email.toUpperCase(),!yb)yb=Ea;else if(yb!==Ea)return!0;return!1}}Object(l.a)(a,
"CoauthTelemetry",null,[740]);var k=c(8),x=c(438),y=c(82),m=c(2),u;(function(Ea){Ea[Ea.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Ea[Ea.notImplemented=1]="notImplemented";Ea[Ea.renderHandled=2]="renderHandled";Ea[Ea.renderHandledWithVeto=3]="renderHandledWithVeto"})(u||(u={}));Object(l.b)("CoauthorGalleryTelemetryEndResult",u);var z=c(75),v=c(72),E=c(122);class F{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le){this.J7g=this.FLg=this.cD=null;this.d5=Ea;this.Ptd=new x.a;this.Na=kc;this.Lte=
yb;this.j5=Rc;this.Mg=Xc;this.CLe=yd;this.$ab=gf;this.BPj=vc;this.BUg=this.uUg=!1;this.hvd=0;this.DLg=1;this.Bqb=Le;this.HBc=this.Na.$("PeoplesWellExtraButtonInfoIsEnabled");this.Oqa=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get bpj(){return this.Ptd.task}init(){E.Task.WAA.call(null,this.$ab,this.Lte,this.CLe).continueWith(()=>{this.cD=this.$ab.result;this.FLg=this.Lte.result;this.J7g=this.CLe.result;E.Task.WAA.call(null,this.Lte.result.N1b,this.CLe.result.Ksj).continueWith(()=>
{this.DLg=this.FLg.N1b.result;this.hvd=this.J7g.Ksj.result;this.cD.w_b(Object(e.a)(this,this.N6d,"onUsersUpdatedEventListener"));this.cD.U_a().length&&this.Rba()})})}N6d(){this.Rba()}Rba(){this.BPj(this.cD.U_a())?(this.cD.V2f(Object(e.a)(this,this.N6d,"onUsersUpdatedEventListener")),this.Ehn(this.uUg)):this.Ptd.XU(1);this.uUg=!0}Ehn(Ea){this.BUg?this.bpj.continueWith(()=>{k.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",u[this.bpj.result])}):(this.BUg=
!0,this.zCn(0===this.DLg&&!Ea))}zCn(Ea){Ea?this.j5.Vk(4,Object(e.a)(this,this.CRf,"onInteractiveReady")):this.Ptd.XU(1)}CRf(){const Ea=this.Mg.dG("AppInitStatus_interactivityReady");k.ULS.shipAssertTag(42259235,325,!!this.hvd);const yb=this.hvd-Ea,kc={};kc.InteractiveTime=Ea;kc.ReactRenderComplete=this.hvd;kc.HadTabSwitch=this.Bqb();kc.IsModernGallery=this.HBc;k.ULS.sendTraceTag(594883104,325,50,v.a.toJSON(kc));this.HBc?(k.ULS.sendTraceTag(42062997,325,15,yb.toString()),this.Ptd.XU(this.AVo(yb)?3:
2)):k.ULS.sendTraceTag(594883103,325,15,yb.toString())}AVo(Ea){const yb=Ea>this.Na.pc("CoauthorGalleryTimeToRenderDurationMs",1E4),kc="Word"===this.Oqa;if(this.Bqb())return k.ULS.sendTraceTag(50455714,325,50,yb.toString()),!1;kc&&z.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);yb&&(kc&&z.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),k.ULS.sendTraceTag(42062998,325,15,Ea.toString()));
return yb}}Object(l.a)(F,"CoauthorGalleryTelemetry",null,[739]);class J{constructor(Ea){this.cD=null;this.ded={};this.Tpd={};this.ztc=null;this.$ab=Ea}TPd(Ea){const yb=new x.a;this.init().continueWith(()=>{Ea in this.ded?yb.XU(this.ded[Ea]):this.Tpd[Ea]=yb});return yb.task}init(){if(this.ztc)return this.ztc.task;this.ztc=new x.a;this.$ab.continueWith(()=>{this.cD=this.$ab.result;this.cD.w_b(Object(e.a)(this,this.Rba,"onUsersUpdated"));this.zAj();this.ztc.xg(null)});return this.ztc.task}zAj(){const Ea=
this.cD.U_a();Ea.sort(Object(e.a)(this,this.xWk,"comparePresenceUsers"));this.ded={};for(let yb=0;yb<Ea.length&&Ea[yb]&&Ea[yb].WPa;yb++)this.gnk(this.ded,Ea[yb].clientId,yb)}gnk(Ea,yb,kc){Ea[yb]=kc;yb in this.Tpd&&(this.Tpd[yb].XU(kc),delete this.Tpd[yb])}Rba(){this.zAj()}xWk(Ea,yb){return Ea.WPa>yb.WPa?1:Ea.WPa<yb.WPa?-1:0}}Object(l.a)(J,"CoauthorPositionFinder",null,[738]);var K=c(529),H=c(318),P=c(439),N=c(76),M=c(118);class I{constructor(){this.kBa=null;this.loc=Array(32)}xor(Ea){if(!Ea)throw Error.argumentNull("Guid argument cannot be null");
const yb=new I,kc=new Sys.StringBuilder;for(let Rc=0;Rc<Ea.loc.length;Rc++){const Xc=this.loc[Rc]^Ea.loc[Rc];yb.loc[Rc]=Xc;kc.append(Xc.toString(16));7!==Rc&&11!==Rc&&15!==Rc&&19!==Rc||kc.append("-")}yb.kBa=M.a.Gf(kc.toString());return yb}toString(){return this.kBa.toString()}equals(Ea){if(!Ea)throw Error.argumentNull("Guid argument cannot be null");return this.kBa.equals(Ea.kBa)}static F5b(Ea){if(!Ea)throw Error.argumentNull("String input cannot be null");const yb=new I;yb.kBa=M.a.Gf(Ea);const kc=
yb.kBa.toString();let Rc=0;for(let yd=0;yd<kc.length;yd++){var Xc=Ea.charAt(yd);if(I.yDm(Xc))Xc=I.ekm(Xc,Ea.charCodeAt(yd)),yb.loc[Rc++]=Xc;else if(!I.VCm(Xc))throw Error.argument("String contains characters not valid in Guids");}return yb}static yDm(Ea){return"0"<=Ea&&"9">=Ea||"A"<=Ea&&"F">=Ea||"a"<=Ea&&"f">=Ea}static VCm(Ea){return"{"===Ea||"}"===Ea||"-"===Ea}static ekm(Ea,yb){if("0"<=Ea&&"9">=Ea)return yb-48;if("A"<=Ea&&"F">=Ea)return yb-65+10;if("a"<=Ea&&"f">=Ea)return yb-97+10;throw Error.argument("Char is not valid hex digit");
}}Object(l.a)(I,"Guid",null,[]);class T{constructor(Ea,yb,kc,Rc){this.Rda=null;this.WNg=this.J3g=!1;this.N0g=0;this.Oxc=Ea;this.XRe=yb;this.Na=kc;this.$Vb=Rc;this.WOj=m.AFrameworkApplication.Elc||m.AFrameworkApplication.ioa;this.V1g=new K.a(H.a.Xh())}get iaf(){return this.Na.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Oxc.continueWith(()=>{this.Rda=this.Oxc.result;this.Rda.w_b(Object(e.a)(this,this.Rba,"onUsersUpdated"))})}Rba(){this.RTk(this.Rda.U_a())}RTk(Ea){var yb=
0;const kc=new P.a(H.a.Xh());for(const Rc of Ea)if(Rc&&Rc.isAnonymous){m.AFrameworkApplication.ye("70eb6120;2gfeb930");if(kc.ob(Rc.userName))kc.J(Rc.userName).add(Rc.clientId);else{let Xc;kc.add(Rc.userName,(Xc=new N.a,Xc.add(Rc.clientId),Xc))}Rc.clientId!==this.$Vb?(yb++,2<=yb&&!this.J3g&&this.xZm()):!this.WNg&&this.iaf&&"Guest"===Rc.userName&&(k.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.WNg=!0)}if(this.iaf&&this.N0g!==yb){k.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",
yb+(this.WOj?1:0));this.N0g=yb;for(let Rc of kc.keys)2<=kc.J(Rc).count&&(Ea=this.nNl(kc.J(Rc)),this.V1g.contains(Ea)||(yb={},yb.guestsWithSameName=kc.J(Rc).count,yb.identifier=Ea,k.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",yb),this.V1g.add(Ea)))}}xZm(){k.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.J3g=!0;this.iaf&&this.XRe&&this.XRe.continueWith(()=>{window.setTimeout(()=>{this.XRe.result.logActivity("MultipleGuestsCoauthoring",
null)},15E3)})}nNl(Ea){if(!Ea||1>=Ea.count)return"";let yb=I.F5b(Ea.J(0));for(let kc=1;kc<Ea.count;kc++)yb=yb.xor(I.F5b(Ea.J(kc)));return yb.toString()}}Object(l.a)(T,"GuestCoauthTelemetry",null,[]);var U=c(234);class W{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(l.a)(W,"PL",null,[]);var V=c(34);class Y{constructor(){this.ct=this.vt=this.d=0}static edj(Ea,yb,kc){const Rc=new Y;Rc.d=Ea;Rc.vt=yb;Rc.ct=kc;return V.c(Rc)}}Object(l.a)(Y,"VD",null,
[]);var da=c(126);class ba{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le){this.Ebh=!1;this._id=Ea;this.Bi=yb;this.Mr=kc;this.CIe=Rc;this.LSe=Xc;this.Bxb=yd;this.rrb=gf;this.hSj=vc;this.Bqb=Le;this.Oqa=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}Ume(Ea){E.Task.WAA(this.CIe,this.LSe).continueWith(()=>{if(this.CIe.result<=this.LSe.result)Ea.XU(!1);else{var yb=this.Mr-this.Bi,kc=new W;kc.id=this._id;kc.et=this.Mr;kc.st=this.Bi;kc.d=this.Mr-this.Bi;kc.mp=this.CIe.result;
kc.tp=this.LSe.result;kc.ct=this.tIl(this.hSj);kc.vc=this.Bqb();var Rc=V.c(kc),Xc="Word"===this.Oqa;k.ULS.sendTraceTag(42078597,302,15,Rc);if(Xc){const yd=new Map;yd.set("data",Rc);z.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",yd)}yb>this.Bxb.value&&!this.Ebh&&!kc.vc&&(this.Ebh=!0,Ea.XU(!0),kc=Object.assign(new da.a,{inStaging:!0,extendedProperties:new Map}),kc.extendedProperties.set("data",Rc),Xc&&z.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",
!1,!0,kc),yb<this.rrb.value&&k.ULS.sendTraceTag(42078598,302,15,Y.edj(yb,this.Bxb.value,this.rrb.value)));Ea.task.isCompleted||Ea.XU(!1)}})}tIl(Ea){switch(Ea){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(l.a)(ba,"PresenceLatencyActivityLogger",null,[]);class ja{constructor(Ea,yb,kc){this.wKg=this.BLg=this.Kdd=this.ced=this.cRb=0;this._id=Ea;this.Bxb=yb;this.rrb=kc;this.Oqa=Object(y.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||
""}get Snh(){return this.cRb}set Snh(Ea){this.cRb=Ea;this.x4e()}get ABh(){return this.ced}set ABh(Ea){this.ced=Ea;this.x4e()}get Jxh(){return this.Kdd}set Jxh(Ea){this.Kdd=Ea;this.x4e()}get BBh(){return 0!==this.BLg}get Kxh(){return 0!==this.wKg}x4e(){!this.BBh&&this.cRb&&this.ced&&(this.BLg=this.Ume(this.ced,"CoauthGalleryLightupDurationTooLong"));!this.Kxh&&this.cRb&&this.Kdd&&(this.wKg=this.Ume(this.Kdd,"CanvasPresenceLightupDurationTooLong"))}Ume(Ea,yb){const kc=Ea-this.cRb;var Rc=new W;Rc.id=
this._id;Rc.et=Ea;Rc.st=this.cRb;Rc.d=kc;var Xc=V.c(Rc);Ea="Word"===this.Oqa;Rc="CanvasPresenceLightupDurationTooLong"===yb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===yb?k.ULS.sendTraceTag(572289499,302,15,Xc):k.ULS.sendTraceTag(571524118,302,15,Xc);if(Ea){var yd=new Map;yd.set("data",Xc);z.Health.instance.recordKpiUsage(Rc,0,"wordcollabrel",yd)}return kc>this.Bxb.value?(yd=Object.assign(new da.a,{inStaging:!0,extendedProperties:new Map}),
yd.extendedProperties.set("data",Xc),Xc=kc<this.rrb.value,yd.extendedProperties.set("cash",Xc?"true":"false"),Ea&&z.Health.instance.recordKpiFailure(Rc,yb,!1,!0,yd),k.ULS.sendTraceTag(572289500,302,15,Y.edj(kc,this.Bxb.value,this.rrb.value)),Xc?2:1):3}}Object(l.a)(ja,"PresenceLightupLatencyLogger",null,[]);var sa=c(38),ta=c(161);class ra{constructor(Ea,yb,kc,Rc,Xc,yd,gf=null,vc=null,Le=null){this.Q8g={};this.Kte={};this.n_g=new N.a;this.Atc=this.cD=this.nj=null;this.udh=this.tdh=0;this.Bxb=new U.a(()=>
gf.iO("PresenceBootLatencyThreshold",1E4));this.rrb=new U.a(()=>gf.iO("PresenceBootLatencyCutoffThreshold",6E4));this.yhk=new U.a(()=>gf.iO("PresenceLightupLatencyThreshold",2E3));this.jUj=new U.a(()=>gf.iO("PresenceLightupLatencyCutoffThreshold",1E4));this.v9j=Rc;this.ELg=Ea;this.pah=yb;this.$ab=kc;this.Mg=Xc;this.$Vb=vc;this.Bqb=yd;this.HUg=Le;this.sJg=!1;this.init()}CJc(Ea,yb,kc=null,Rc=0){kc&&(k.ULS.shipAssertTag(42274970,302,!this.$Vb||this.$Vb===kc,"_myClientId is already set and you are trying to update it to something different"),
this.$Vb=kc);const Xc=new x.a;this.init().continueWith(()=>{this.oln(Ea);this.Yml(Xc,Ea,yb,Rc)})}get zJi(){return this.$Vb||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.Atc)return this.Atc.task;this.Atc=new x.a;this.Bqb()&&k.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.ELg.continueWith(()=>{const Ea=this.ELg.result,yb=Ea.N1b,kc=Ea.Y8m;kc.continueWith(()=>{yb.continueWith(()=>{this.HUg&&this.HUg.addQosPillar("RealTimeCoauth");this.$cg(yb.result,kc.result);this.Atc.xg(null)})})});
this.pah.continueWith(()=>{this.nj=this.pah.result;this.nj.$sa(Object(e.a)(this,this.Amn,"onRtcConnection"));this.nj.t2(Object(e.a)(this,this.Efn,"onCoauthorBootReceived"))});this.$ab.continueWith(()=>{this.cD=this.$ab.result;this.cD.w_b(Object(e.a)(this,this.N6d,"onUsersUpdatedEventListener"));0<this.cD.U_a().length&&this.Rba()});return this.Atc.task}Q1h(){return this.Mg.Vea(sa.a.o7a)?this.Mg.dG(sa.a.o7a):ta.a.sdb?window.performance.timing.fetchStart:-1}Amn(Ea,yb){this.sJg||2!==yb.newState||(Ea=
this.Q1h(),Ea=Date.now()-Ea,yb={},yb.clientId=this.zJi,yb.bootTime=Ea,this.sJg=!0,this.nj.LO(15,yb))}Efn(Ea,yb){if(15===yb.type){Ea=Date.now();yb=yb.dL;var kc=yb.bootTime;this.$of(yb.clientId).Snh=Ea-kc}}N6d(){this.Rba()}Rba(){const Ea=Date.now();var yb=this.cD.U_a();const kc=new N.a;for(const Rc of yb)this.n_g.contains(Rc.clientId)||(this.n_g.add(Rc.clientId),kc.add(Rc.clientId));if(0<kc.count)for(let Rc of kc)yb=this.$of(Rc),yb.BBh||(yb.ABh=Ea)}oln(Ea){Ea=this.$of(Ea);Ea.Kxh||(Ea.Jxh=Date.now())}$of(Ea){return Ea in
this.Kte?this.Kte[Ea]:this.Kte[Ea]=new ja(Ea,this.yhk,this.jUj)}$cg(Ea,yb=0){this.tdh=Ea;this.udh=yb?yb:(new Date).getTime()}Yml(Ea,yb,kc,Rc){kc=kc?kc.getTime():(new Date).getTime();yb in this.Q8g?Ea.Gia():(Rc=new ba(yb,this.s6l(),kc,this.TPd(this.zJi),this.TPd(yb),this.Bxb,this.rrb,Rc,this.Bqb),this.Q8g[yb]=Rc,Rc.Ume(Ea))}s6l(){return 1===this.tdh?this.udh:this.Q1h()}TPd(Ea){return this.v9j.TPd(Ea)}}Object(l.a)(ra,"PresenceBootTelemetry",null,[737]);var ma=c(113),Ba=c(180),Pa=c(203),Da=c(21),Ha=
c(648);class oa{get name(){return"Common.App.CoauthTelemetry"}yc(Ea){Ea.register(a,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().Qd(()=>new a(Ha.a.xp(Ea.Sa("Common.IPeopleInfoProvider")),m.AFrameworkApplication.Sg));Ea.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().Qd(()=>new F(m.AFrameworkApplication.xa,Ha.a.xp(Ea.Sa("Common.ICoauthoringTelemeryInfoProvider")),
m.AFrameworkApplication.K,ma.a.get_instance(),Pa.a.instance,Ha.a.xp(Ea.Sa("Common.IPeoplesWell")),Ha.a.xp(Ea.Sa("Common.IPeopleInfoProvider")),a.Q_e,()=>this.zuh()));Ea.register(ra,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().Qd(()=>new ra(Ha.a.xp(Ea.Sa("Common.ICoauthoringTelemeryInfoProvider")),Ha.a.xp(Ea.Sa("Common.IRealtimeChannelBasic")),Ha.a.xp(Ea.Sa("Common.IPeopleInfoProvider")),Ea.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),
Pa.a.instance,()=>this.zuh(),m.AFrameworkApplication.K,null,z.Health.instance));Ea.register(J,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().Qd(()=>new J(Ha.a.xp(Ea.Sa("Common.IPeopleInfoProvider"))));Ea.register(T,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().Qd(()=>new T(Ha.a.xp(Ea.Sa("Common.IPeopleInfoProvider")),Ha.a.xp(Ea.Sa("Common.ISystemInitiatedFeedback")),m.AFrameworkApplication.K,"{"+
m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.Wo(()=>{Da.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Da.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&Da.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(Da.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),
Da.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}zuh(){return ta.a.sdb&&Pa.a.instance.Vea(sa.a.bad)?0<Pa.a.instance.dG(sa.a.bad)[sa.a.wDj]:!1}static main(){Ba.a.instance.Gc(new oa)}}Object(l.a)(oa,"CoauthTelemetryPackage",null,[1,2]);class wa extends Sys.EventArgs{constructor(){super()}}Object(l.a)(wa,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ia;(function(Ea){Ea[Ea.notYetStarted=0]="notYetStarted";Ea[Ea.polling=1]="polling";Ea[Ea.subscribed=2]="subscribed";
Ea[Ea.blocked=3]="blocked";Ea[Ea.permanentlyStopped=4]="permanentlyStopped"})(ia||(ia={}));Object(l.b)("RtcHostNotificationSubscriptionState",ia);var ca=c(79),pa=c(1403),Ma=c(67);class ya{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le){this.Gh=!1;this.G$=this.eXb=this.fea=this.$Wa=null;this.zAc=ya.Hpe;this.ra=new Ma.a;this.Ybb=new pa.a(0);this.Ybb.zYe(Object(e.a)(this,this.Hnn,"onStateMachineChanged"));this.Zak=Ea;this.fsd=yb;this.Yak=kc;this.wOe=Rc;this.Gb=Xc;this.ff=yd;gf.execute(id=>{this.Gh||(this.eXb=
id,this.eXb.t2(Object(e.a)(this,this.S_,"onUpdateNotificationReceived")),this.start())});vc.execute(id=>{this.Gh||(this.G$=id,id.nYa(Object(e.a)(this,this.lha,"onTokenRefreshed")))});this.evd=Le}get tjc(){return this.Ybb.currentState}get hxi(){return!this.ff||this.ff.swa}get Axi(){return 2===this.tjc&&this.evd()<this.zAc}start(){0!==this.tjc?k.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",ia[this.tjc]):(this.Ybb.event(1),this.l7f(null))}l7f(){this.$Wa=
null;if(this.hxi){k.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ia[this.tjc]);let Ea=null;this.wOe&&this.wOe.length&&(Ea={},Ea.etts=this.wOe);this.eXb.LO(14,Ea,!0);this.Vaj(this.Zak)}else this.Ybb.event(3)}Vaj(Ea){this.$Wa=ca.a.l7(1E3*Ea,Object(e.a)(this,this.l7f,"sendSubscribeEvent"),this.fsd,192,"RtcHostNotificationSubscribe");this.Gb.Wb(this.$Wa)}W4n(Ea){Ea=1E3*(Ea+this.Yak);const yb=this.evd().getTime()+Ea;this.zAc=new Date(yb);Ea-=this.fsd;
this.fea?this.Gb.l4(this.fea,Ea):(this.fea=ca.a.l7(Ea,Object(e.a)(this,this.kFo,"transitionToPollingEvent"),this.fsd/2,194,"RtcHostNotificationTransitionToPolling"),this.Gb.Wb(this.fea))}kFo(){this.fea=null;2===this.tjc&&(this.Ybb.event(1),k.ULS.shipAssertTag(573100185,502,!!this.$Wa,"Missing task to ensure that we re-subscribe."))}lha(){this.Sdm()}Sdm(){3===this.tjc&&this.hxi&&(this.Ybb.event(this.Axi?2:1),this.l7f(null))}S_(Ea,yb){if(13===yb.type&&(Ea=yb.dL,k.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:Ea,["DurationBeforeExpirationToResubscribeInSec"]:this.fsd}),yb=Ea.cts,!this.QHo(yb))){if(Ea.sb){var kc=2;this.W4n(Ea.cts)}else kc=1,this.zAc=ya.Hpe,this.fea&&(this.Gb.Se(this.fea),this.fea=null);this.Ybb.event(kc);this.$Wa?this.Gb.l4(this.$Wa,1E3*yb):this.Vaj(yb)}}QHo(Ea){if(!isNaN(Ea)&&isFinite(Ea)&&0<Ea)return!1;this.qpj(!1);return!0}qpj(Ea){this.$Wa&&(this.Gb.Se(this.$Wa),this.$Wa=null);this.fea&&(this.Gb.Se(this.fea),this.fea=null);this.eXb&&(this.eXb.ULb(Object(e.a)(this,
this.S_,"onUpdateNotificationReceived")),this.eXb=null);this.G$&&(this.G$.SLb(Object(e.a)(this,this.lha,"onTokenRefreshed")),this.G$=null);Ea||this.Ybb.event(4)}Hnn(Ea,yb){Ea=yb.newState;const kc=yb.NXf,Rc={};Rc.NewState=ia[Ea];Rc.PreviousState=ia[kc];Rc.PreviousStateHits=yb.OXf;Rc.PreviousStateTransitionTime=yb.PXf.toISOString();Rc.IsSubscribed=this.Axi;this.zAc!==ya.Hpe&&(Rc.SubscriptionExpiringTime=this.zAc.toISOString());k.ULS.sendTraceTag(572346515,502,4===Ea?15:50,"HostNotificationChanged: {0}",
Rc);this.ra.raiseEvent("HN",new wa(kc,Ea))}dispose(){this.Gh||(this.Gh=!0,this.qpj(!0),this.fea&&(this.Gb.Se(this.fea),this.fea=null))}}ya.Hpe=new Date(0);Object(l.a)(ya,"RtcHostNotificationSubscriptionManager",null,[729,9]);var Oa=c(398);class fa{constructor(){this.xh=this.Gh=!1}get name(){return"RtcHostNotificationSubscription"}yc(Ea){Ea.register(ya,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().Qd(()=>
{const yb=m.AFrameworkApplication.K;return new ya(yb.pc("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),yb.pc("RtcHostNotificationRetryIntervalBufferInSeconds",120),yb.pc("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.g4l(yb),m.AFrameworkApplication.oc,Oa.SessionStatusManager.instance,Ea.Sa("Common.IRealtimeChannelBasic"),Ea.Sa("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.Wo(()=>{!this.Gh&&m.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&
(this.xh=!0,Da.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Gh||(this.Gh=!0,this.xh&&Da.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}g4l(Ea){return Ea.yw("RtcEventTypesToSubscribe")?Ea.oC("RtcEventTypesToSubscribe"):null}static main(){Ba.a.instance.Gc(new fa)}}Object(l.a)(fa,"RtcHostNotificationSubscriptionPackage",null,[1,2]);var Ca=c(503),Ta=c(657);
class eb{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi){this.clientId=Ea;this.SkypeChatThreadId=kc;this.chatThreadDiscoveryUri=Rc;this.inChat=Xc;this.localColbaltSessionId=yb;this.capabilities=yd;this.email=gf;this.isReadOnly=vc;this.userName=Le;this.isAnonymous=id;this.presenceStatus=Gi}}Object(l.a)(eb,"SerializablePresenceUserData",null,[]);class jb extends Ca.a{constructor(Ea,yb,kc,Rc,Xc=null,yd=null,gf=null,vc=null,Le=null,id=!1,Gi=!1,Oh=!1,Yg=null){super(Ea,yb,kc,Rc,yd,gf,vc,Le,id,Gi,Oh);this.PQ=
Xc;this.presenceStatus=Yg}getData(){return new eb(this.clientId,this.PQ,this.QEc,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}UPd(Ea){return(Ea=Ea.value)?Ea.user:null}clone(){return new jb(this.clientId,this.userName,this.color,this.capabilities.clone(),this.PQ,this.QEc,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static kAb(Ea){return Ea.clientId?
new jb(Ea.clientId,Ea.userName,null,new Ta.a(void 0===Ea.capabilities?0:Ea.capabilities),Ea.localColbaltSessionId,Ea.SkypeChatThreadId,Ea.email,null,Ea.chatThreadDiscoveryUri,Ea.isAnonymous,Ea.inChat,Ea.isReadOnly,Ea.presenceStatus):null}static CHh(Ea,yb,kc,Rc=null,Xc=null,yd=null,gf=null,vc=null,Le=!1,id=!1,Gi=!1,Oh=null){return Ea?new jb(Ea,yb,null,new Ta.a(void 0===kc?0:kc),Rc,Xc,yd,gf,vc,Gi,Le,id,Oh):null}}Object(l.a)(jb,"PresenceUser",Ca.a,[1445,1446,21]);class ob extends jb{constructor(){super();
this.efc=this.wHf=null}YWl(){const Ea=m.AFrameworkApplication.userName,yb=m.AFrameworkApplication.K.kb("UserPrincipalName"),kc=this.wHf?this.wHf.PQ:null,Rc=m.AFrameworkApplication.Elc||m.AFrameworkApplication.ioa,Xc=this.efc?this.efc.getStatus():null;return new jb(this.clientId,Ea,this.color,this.capabilities,kc,this.QEc,yb,this.client,this.chatThreadDiscoveryUri,Rc,this.inChat,this.isReadOnly,Xc)}}Object(l.a)(ob,"MyPresenceUser",jb,[1492,21]);var Ya=c(227);class Xa{constructor(Ea,yb,kc,Rc,Xc){this.Rd=
Ea;this._clientId=yb;this.nVj=Xc;this.gZj=kc||(()=>null);this.hZj=Rc||(()=>null)}get id(){return this.Rd.id}get hxd(){return this.Rd.hxd}get lxd(){return this.Rd.lxd}get kxd(){return this.Rd.kxd}get jxd(){return this.Rd.jxd}get ixd(){return this.Rd.ixd}get nxd(){return this.Rd.nxd}get bWe(){return this.Rd.bWe}get Uic(){return this.Rd.Uic}get she(){return this.Rd.she}get m3d(){return this.Rd.m3d}get clientId(){return this._clientId}get KOc(){return this.gZj}get fhb(){return this.hZj}get shl(){return this.nVj}static createInstance(Ea,
yb,kc,Rc,Xc=!1){return new Xa(Ea,yb,kc,Rc,Xc)}}Object(l.a)(Xa,"PeoplesWellSettings",null,[]);var Sa=c(11),ab=c(57),Hb=c(155),pb=c(83),Mb=c(216),Qb=c(181),Aa=c(442),bb=c(362);class nb extends Mb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(l.a)(nb,"PeopleButtonProps",Mb.a,[]);var Va=c(349),Ab=c(350),Zb=c(16),Kb=c(80);class dc{constructor(Ea){this.cad=new Kb.a;this.haf=null;this.clientId=
Ea}tho(Ea){this.YRn();this.W$n(Ea);for(const yb of Ea)yb.clientId!==this.clientId&&this.Vlh(yb)}get wkg(){const Ea=[];for(let yb of this.cad.values){const kc=this.Tbj(yb);Array.add(Ea,kc)}return Ea}get Nkb(){return this.cad.count}QXe(Ea,yb){Ea=Ea.toUpperCase();let kc;({value:kc}=this.cad.Ec(Ea)).returnValue||(kc=[],this.cad.Z(Ea,kc));Array.add(kc,yb)}YRn(){this.cad=new Kb.a}W$n(Ea){for(const yb of Ea)if(yb.clientId===this.clientId){this.haf=yb;break}}}Object(l.a)(dc,"UserTracker",null,[1008]);class jc extends dc{constructor(Ea,
yb){super(Ea);this.iZj=yb}Vlh(Ea){Ea.isAnonymous||!Ea.email?this.QXe(Ea.clientId,Ea):this.haf&&H.a.Xh().equals(this.haf.email,Ea.email)||this.QXe(Ea.email,Ea)}Tbj(Ea){let yb=new Date(0),kc=0<Ea.length?Ea[0]:null;for(const Rc of Ea)(Ea=this.iZj(Rc.clientId))&&yb.getTime()<Ea.pbc.getTime()&&(yb=Ea.pbc,kc=Rc);return kc}}Object(l.a)(jc,"UniqueUserTracker",dc,[]);class zb extends dc{constructor(Ea){super(Ea)}Vlh(Ea){this.QXe(Ea.clientId,Ea)}Tbj(Ea){return Ea[0]}}Object(l.a)(zb,"UserInstanceTracker",dc,
[]);const cc=(Ea,yb,kc)=>kc?new jc(Ea,yb):new zb(Ea);var Ub=c(62),Wb=c(625),Qa=c(12);class sb{constructor(Ea,yb=null,kc=null){this.cD=null;this.USe=new x.a;this.Rd=Ea;this.j8d=yb;kc&&kc.continueWith(()=>{this.cD=kc.result;this.cD.w_b(Object(e.a)(this,this.Rba,"onUsersUpdated"));this.Oae()});new Ca.a(this.settings.clientId,"Anonymous user","#cccccc",new Ta.a(7));this.WWd=this.REe=!0;this.JAe=this.BLe=!1;this.Jya=cc(this.settings.clientId,this.settings.fhb,Ea.shl)}get settings(){return this.Rd}get izm(){return m.AFrameworkApplication.K?
m.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get Pqi(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}tKl(){let Ea;let yb,kc,Rc,Xc;var yd=this.uKl();this.Jya.Nkb?1===this.Jya.Nkb?(yb=!0,kc=this.settings.Uic.cluster,Rc=this.settings.Uic.UFd,Xc=this.Jya.wkg[0].color):(yb=!0,kc=this.settings.m3d.cluster,Rc=this.settings.m3d.UFd,Xc=""):(yb=!1,Xc=Rc=kc="");Ea=yd[0];yd=yd.slice(1);return{Qqn:Ea,Rqn:yd,Mqn:yb,Wcp:kc,Oqn:Rc,Nqn:Xc}}uKl(){if(2<=
this.Jya.Nkb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.Jya.Nkb)];if(1===this.Jya.Nkb){const Ea=this.Jya.wkg[0],yb=this.settings.fhb(Ea.clientId);return yb&&2===yb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Ea.userName]:[Ea.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Ea.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}bam(Ea){return this.cam(Ea)}jxh(Ea,
yb,kc){return yb?this.ILk(yb)?(Ea=this.settings.fhb(Ea))&&2===Ea.status?!1:!0:(kc&&k.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(kc&&k.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}y6l(Ea){return Ea.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}cam(Ea){if(!Ea.capabilities.gEa(1))return this.y6l(Ea);const yb=Ea.isReadOnly,kc=this.settings.fhb(Ea.clientId);
Ea=this.settings.KOc(Ea.clientId);if(!kc)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(kc.status){case 1:return Ea?yb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.Z_k(Ea)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}vSl(Ea){if(this.j8d.YUc)return this.j8d.vAb(Ea.email,
"O365",m.AFrameworkApplication.fm,0)}N$l(Ea){Ea=this.settings.fhb(Ea.clientId);return!Ea||Ea&&1===Ea.status?!0:!1}P$l(Ea){var yb=String.format("buttonPeoplesWellUser-{0}",Ea.clientId),kc=Ea.clientId,Rc=this.bam(Ea);const Xc=Ea.userName,yd=Ea.color;var gf=Object,vc=gf.assign,Le=new nb,id=this.settings.nxd.toString(),Gi=this.settings.she.cluster,Oh=this.settings.she.UFd,Yg=this.O3h(),xi=Ea.isAnonymous,Dj;if(Dj=[Xc],Dj.length){var Ml=new Sys.StringBuilder("STRARRY@");for(const Kn of Dj)Ml.append(Kn?
Kn.length:0),Ml.append(","),Ml.append(Kn),Ml.append(",");Dj=Ml.toString().slice(0,-1)}else Dj=null;yb=vc.call(gf,Le,{Id:yb,Command:id,LabelText:"{0}",Image32by32:Gi,Image32by32Class:Oh,MenuItemId:kc,CommandValueId:kc,Alt:Xc,DisplayMode:Yg,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Rc,ImageBackColor:yd,IsAnonymous:xi,LabelTextUserGeneratedPlaceholderReplacements:Dj,Upn:Ea.email});m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
this.j8d&&(kc=this.vSl(Ea),Rc=this.N$l(Ea),yb.ImageUrl=kc,yb.ActiveStatus=Rc,yb.JoinTimeInMS=Ea.WPa,Ea=this.jxh(Ea.clientId,this.settings.KOc(Ea.clientId),!1),yb.CanJump=Ea,""===kc&&k.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return yb}HQl(){return Object.assign(new Mb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}O3h(){return this.izm?"Initials":
"Menu32"}Q$l(Ea){const yb=[];for(const kc of Ea)Ea=this.P$l(kc),Array.add(yb,Ea);return yb}uWd(){return 0<this.Jya.Nkb}PFn(Ea){if(!this.REe)return!0;this.WWd||(Ea[Wb.a.Visible]=!0);let yb,kc,Rc,Xc,yd;({Qqn:yb,Rqn:kc,Mqn:Rc,Oqn:Xc,Nqn:yd}=this.tKl());Ea[Wb.a.LabelText]=yb;kc&&kc.length&&(Ea[Wb.a.LabelTextUserGeneratedPlaceholderReplacements]=kc);Ea[Wb.a.ImageIsVisible]=Rc;Ea[Wb.a.Image16by16Class]=Xc;Ea[Wb.a.ImageBackColor]=yd;this.REe=!1;return!0}nxn(Ea){if(0>=this.Jya.Nkb)return!1;var yb=this.yso(this.Jya.wkg),
kc=this.Q$l(yb);yb=Object.assign(new Aa.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});kc=Object.assign(new bb.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.O3h(),ControlList:kc});m.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.j8d&&(kc.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,kc.TitleId="menuCoauthorsTitle",kc.Theme="Light");Array.add(yb.MenuSectionList,kc);m.AFrameworkApplication.K.$("DocChatIsEnabled")&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Ob.rq&&(kc=[],Array.add(kc,this.HQl()),kc=Object.assign(new bb.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:kc}),Array.add(yb.MenuSectionList,kc));m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Ob.rq?Ea.MenuItems=yb:Ea.PopulationXML=Qb.o(yb);return!0}tkg(Ea){k.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Ea=Ea.MenuItemId;if(!Ea)return!1;const yb=this.settings.KOc(Ea);if(!this.jxh(Ea,yb,
!0))return!1;this.fOm(yb);return!0}MMn(){const Ea=this.DEl();this.Jya.tho(Ea);this.WWd&&1<=this.Jya.Nkb&&(k.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.WWd=!1);this.REe=!0}Rba(){this.JAe||(window.setTimeout(()=>{this.Oae();this.JAe=!1},3E3),this.JAe=!0)}DEl(){let Ea;Ea=this.CEl()||[];for(const yb of Ea)this.A3n(yb);return Ea}A3n(Ea){Ea.clientId||(Ea.clientId=M.a.create().toString());Ea.userName||(Ea.userName="Anonymous user");Ea.capabilities||(Ea.capabilities=
new Ta.a);Ea.color||(Ea.color="#cccccc");Ea.WPa||(Ea.WPa=0)}yso(Ea){const yb=[];Array.addRange(yb,Ea);yb.sort(sb.Aqn);return yb}dQn(){m.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&!this.BLe&&(m.AFrameworkApplication.xa.VZ(Qa.a.MBh)&&Va.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.xa.gb(Qa.a.MBh,Ub.a.frame,Object(e.a)(this,this.Ffn,"onCoauthorGalleryFirstRender"),96));this.eQn();this.BLe=
!0;this.Oae()}Ffn(Ea,yb,kc,Rc,Xc){this.USe.XU(Xc.RenderTime);return 32}get Ksj(){return this.USe.task}Oae(){if(!this.BLe&&(this.USe.XU((new Date).getTime()),k.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.Pqi))return;this.MMn();this.Pqi&&this.WWd?m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||Ab.a.$cc("ribbon","coauthorGallery"):
(m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(Ab.a.Lwa("ribbon","coauthorGallery"),Ab.a.L3a("ribbon","coauthorGallery")),this.NMn())}dispose(){this.cD&&(this.cD.V2f(Object(e.a)(this,this.Rba,"onUsersUpdated")),this.cD=null)}static Aqn(Ea,yb){return Ea.capabilities.gEa(1)&&yb.capabilities.gEa(1)||!Ea.capabilities.gEa(1)&&!yb.capabilities.gEa(1)?Zb.a.localeCompare(Ea.userName,yb.userName):Ea.capabilities.gEa(1)?
-1:1}}Object(l.a)(sb,"APeoplesWell",null,[946,9]);var Jb=c(14);const pc=()=>!0;class rc extends sb{constructor(Ea,yb,kc=null,Rc=null){super(Ea,kc,Rc);this.Zzm=(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,()=>this.uWd(),pc);this.QFn=(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,id=>this.PFn(id),pc);this.oxn=(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,pc,id=>this.nxn(id));this.HUk=(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,pc,pc);this.GUk=(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,pc,pc);this.ETo=(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,pc,id=>this.tkg(id));this.ivn=
(Xc,yd,gf,vc,Le)=>this.X0a(gf,Le,pc,()=>{this.Oae();return!0});this.ga=yb}X0a(Ea,yb,kc,Rc){let Xc=!1;switch(Ea){case 1:Xc=kc(yb);break;case 2:Xc=Rc(yb)}return Xc?32:8}eQn(){this.ga.pa(this.settings.hxd,Jb.a.application,this.Zzm);this.ga.gb(this.settings.lxd,Jb.a.application,this.QFn,96);this.ga.gb(this.settings.jxd,Jb.a.application,this.HUk,96);this.ga.gb(this.settings.ixd,Jb.a.application,this.GUk,96);this.ga.gb(this.settings.kxd,Jb.a.application,this.oxn,96);this.ga.pa(this.settings.nxd,Jb.a.application,
this.ETo);this.ga.gb(this.settings.bWe,Jb.a.application,this.ivn,96)}}Object(l.a)(rc,"ABox4PeoplesWell",sb,[]);var db=c(3),lb=c(52),qa=c(10),Ga=c(31),Fb=c(185);class $b{static isSupported(Ea){for(let yb=0;yb<$b.tqj.length;yb++)if(Ea===$b.tqj[yb])return!0;return!1}}$b.tqj=[1];Object(l.a)($b,"RTTDataVersion",null,[]);var rb=c(1612);const xb=Ea=>{if("number"!==typeof Ea.RK||"number"!==typeof Ea.DK)return!1;let yb,kc=!1,Rc=!1,Xc=!1;switch(Ea.RK){case 0:Rc=yb=!0;break;case 1:Xc=kc=Rc=yb=!0;break;case 2:if(null!=
Ea.PE&&"number"!==typeof Ea.PE)return!1;yb=!0;break;case 4:yb=!0;break;case 3:Rc=yb=!0;break;case 5:kc=yb=!0;break;default:return!1}return yb&&("number"!==typeof Ea.PS||"number"!==typeof Ea.TS)||Rc&&("object"!==typeof Ea.OS||!Ea.OS||!rb.validateVersionedCpData(Ea.OS))||kc&&("number"!==typeof Ea.PE||"number"!==typeof Ea.TE)||Xc&&("object"!==typeof Ea.OE||!Ea.OE||!rb.validateVersionedCpData(Ea.OE))?!1:!0},gb=Ea=>{let yb="";if("number"!==typeof Ea.I)return{returnValue:!1,mga:"Invalid PacketId Type"};
if("number"!==typeof Ea.O)return{returnValue:!1,mga:"Invalid Operation Type"};if("string"!==typeof Ea.A)return{returnValue:!1,mga:"Invalid ClientId Type"};if("object"!==typeof Ea.AN)return{returnValue:!1,mga:"Invalid Anchor Object Type"};if(!Ea.AN)return{returnValue:!1,mga:"Null AnchorObject"};if(!xb(Ea.AN)){let kc;try{kc=V.c(Ea.AN)}catch(Rc){kc=String.format("Failed to JSON-serialize payload : {0}",Rc)}8E3<kc.length&&(kc=String.format("Payload exceeds maximum length: {0} > {1}, not logging",kc.length,
8E3));yb="Invalid AnchorObject: "+kc+", Client: "+Ea.C;return{returnValue:!1,mga:yb}}return!Ea.O&&Ea.AN.RK?(yb="Invalid RangeKind:"+Ea.AN.RK+" for Caret",{returnValue:!1,mga:yb}):2===Ea.O&&("number"!==typeof Ea.TF||"undefined"!==typeof Ea.TX&&"string"!==typeof Ea.TX||1!==Ea.AN.RK&&Ea.AN.RK)?{returnValue:!1,mga:"Invalid TypingData"}:3!==Ea.O||"object"===typeof Ea.AP&&Ea.AP&&"number"===typeof Ea.AP.TFA&&"number"===typeof Ea.AP.PN&&"number"===typeof Ea.AP.TN&&2===Ea.AN.RK?6!==Ea.O||"object"===typeof Ea.MP&&
Ea.MP&&"number"===typeof Ea.MP.PM&&"number"===typeof Ea.MP.TM&&5===Ea.AN.RK?4!==Ea.O||"object"===typeof Ea.SP&&Ea.SP&&"number"===typeof Ea.SP.PA&&"number"===typeof Ea.SP.TA&&"number"===typeof Ea.SP.PB&&"number"===typeof Ea.SP.TBS&&3===Ea.AN.RK&&(Ea.AN.PS===Ea.SP.PA||Ea.AN.PS===Ea.SP.PB)?7!==Ea.O||"object"===typeof Ea.SPS&&Ea.SPS&&"string"===typeof Ea.SPS.SF&&"boolean"===typeof Ea.SPS.SL?null!=Ea.ISS&&"number"!==typeof Ea.ISS?{returnValue:!1,mga:"invalid StrictlySequentialId"}:{returnValue:!0,mga:yb}:
{returnValue:!1,mga:"Invalid SymbolData"}:{returnValue:!1,mga:"Invalid SplitParaData"}:{returnValue:!1,mga:"Invalid RemoveParaData"}:{returnValue:!1,mga:"Invalid AddParaData"}};var Gb=c(1581);class ac{constructor(Ea,yb=null,kc=null){this.y0=this.RUf=this.Ffg=null;null!=Ea&&(this.Ffg=Ea);null!=yb&&(this.RUf=yb);null!=kc&&(this.y0=kc)}}Object(l.a)(ac,"AddParaData",null,[]);class hc{constructor(Ea=null,yb=null){this.ckc=this.QUf=null;null!=Ea&&(this.QUf=Ea);null!=yb&&(this.ckc=yb)}}Object(l.a)(hc,"MergeRemoveParaData",
null,[]);class Ec{constructor(Ea,yb,kc,Rc,Xc,yd,gf=null,vc=null,Le=null,id=null,Gi=null,Oh=null,Yg=0,xi=null){this.h8c=this.text=this.QOb=this.hOb=this.xXc=this.e_b=this.Tia=null;this.packetId=Ea;this.client=kc;this.ot=Rc;this.clientId=yb.toLowerCase();this.HS=Xc;this.version=Yg;yd&&(this.Tia=yd);null!=gf&&(this.QOb=gf);void 0!==vc&&null!==vc&&(this.text=vc);Le&&(this.e_b=Le);id&&(this.xXc=id);Gi&&(this.hOb=Gi);Oh&&(this.h8c=Oh);this.strictlySequentialId=xi}}Object(l.a)(Ec,"RTTData",null,[]);class Uc{constructor(Ea=
null,yb=null,kc=null,Rc=null){this.Efg=this.PUf=this.Bfg=this.OUf=null;null!=Ea&&(this.OUf=Ea);null!=yb&&(this.Bfg=yb);null!=kc&&(this.PUf=kc);null!=Rc&&(this.Efg=Rc)}}Object(l.a)(Uc,"SplitParaData",null,[]);class dd{constructor(Ea=null,yb=null){this.heg=this.geg=null;Ea&&(this.geg=Ea);null!=yb&&(this.heg=yb)}}Object(l.a)(dd,"SymbolData",null,[]);class fd{constructor(Ea,yb=null,kc=null){null!=Ea&&(this.TFA=Ea);null!=yb&&(this.PN=yb);null!=kc&&(this.TN=kc)}}Object(l.a)(fd,"SerializableAddParaDataV1",
null,[]);class xc{constructor(Ea=null,yb=null){null!=Ea&&(this.PM=Ea);null!=yb&&(this.TM=yb)}}Object(l.a)(xc,"SerializableMergeRemoveParaDataV1",null,[]);class $c{}Object(l.a)($c,"SerializableRTTDataV1",null,[]);class Bc{constructor(Ea=null,yb=null,kc=null,Rc=null){null!=Ea&&(this.PA=Ea);null!=yb&&(this.TA=yb);null!=kc&&(this.PB=kc);null!=Rc&&(this.TBS=Rc)}}Object(l.a)(Bc,"SerializableSplitParaDataV1",null,[]);class Vd{constructor(Ea=null,yb=null){Ea&&(this.SF=Ea);null!=yb&&(this.SL=yb)}}Object(l.a)(Vd,
"SerializableSymbolDataV1",null,[]);const Je=Ea=>{var yb;if(!({mga:yb}=gb(Ea)).returnValue)return k.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",yb),null;let kc=yb=null,Rc=null,Xc=null,yd=null,gf=null,vc=null,Le=null;Ea.WD&&(yb=Ea.WD);null!=Ea.TF&&(kc=Ea.TF);void 0!==Ea.TX&&null!==Ea.TX&&(Rc=Ea.TX);Ea.AP&&(Xc=new ac(Ea.AP.TFA,Ea.AP.PN,Ea.AP.TN));Ea.MP&&(yd=new hc(Ea.MP.PM,Ea.MP.TM));Ea.SP&&(gf=new Uc(Ea.SP.PA,Ea.SP.TA,Ea.SP.PB,Ea.SP.TBS));Ea.SPS&&(vc=new dd(Ea.SPS.SF,
Ea.SPS.SL));null!=Ea.ISS&&(Le=Ea.ISS);return new Ec(Ea.I,Ea.A,Ea.C,Ea.O,Gb.a(Ea.AN),yb,kc,Rc,Xc,yd,gf,vc,1,Le)},Gf=Ea=>{let yb=Ea;if("number"===typeof yb.V){if(1===yb.V)return Je(Ea);k.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");return null}let kc=0,Rc=null;for(let Xc=0;Xc<Ea.length;Xc++)yb=Ea[Xc],$b.isSupported(yb.V)&&yb.V>kc&&(kc=yb.V,Rc=Ea[Xc]);return 1===kc?Je(Rc):null},Nc=Ea=>{if(Ea){const yb=new $c;yb.I=Ea.packetId;yb.V=1;yb.A=Ea.clientId;yb.C=Ea.client;yb.O=Ea.ot;yb.AN=Gb.c(Ea.HS);
Ea.Tia&&(yb.WD=Ea.Tia);null!=Ea.QOb&&(yb.TF=Ea.QOb);void 0!==Ea.text&&null!==Ea.text&&0<Ea.text.length&&(yb.TX=Ea.text);Ea.e_b&&(yb.AP=new fd(Ea.e_b.Ffg,Ea.e_b.RUf,Ea.e_b.y0));Ea.xXc&&(yb.MP=new xc(Ea.xXc.QUf,Ea.xXc.ckc));Ea.hOb&&(yb.SP=new Bc(Ea.hOb.OUf,Ea.hOb.Bfg,Ea.hOb.PUf,Ea.hOb.Efg));Ea.h8c&&(yb.SPS=new Vd(Ea.h8c.geg,Ea.h8c.heg));yb.ISS=Ea.strictlySequentialId;Ea=yb}else Ea=null;return Ea};var md=c(60);class Oe{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le){this.LocalCobaltSessionId=Ea;this.SkypeChatThreadId=
yb;this.ChatThreadDiscoveryUri=kc;this.InChat=Rc;this.Capabilities=Xc;this.Email=yd;this.UserName=gf;this.IsAnonymous=vc;this.PresenceStatus=Le}}Object(l.a)(Oe,"SerializableWacData",null,[]);class fg{constructor(){this.Itd=this.Htd=0}MXl(){this.Itd===Number.MAX_VALUE&&(this.Itd=0);this.Itd++;return this.Itd}LXl(){this.Htd===Number.MAX_VALUE&&(this.Htd=0);this.Htd++;return this.Htd}static get instance(){return fg.Idk}}fg.Idk=new fg;Object(l.a)(fg,"StrictlySequentialIdGenerator",null,[722]);var If=
c(1512);class tf{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc=0){this.fsa=null;this.dryDeletion=0;this.kI=Ea;this.aLa=yd;this.od=Xc;this.Oxb=gf;this.Lc=yb;this.shapeId=vc;this.kGa=kc;this.S8=gf.create(this,Rc,Xc,yd)}clone(){return new tf(this.kI,this.Lc,this.kGa,this.S8.Ipb,this.od,this.aLa,this.Oxb,this.shapeId)}get paragraphId(){return this.fsa?this.fsa:this.kI.Ugb(this.Lc)}ASf(){this.fsa||(this.fsa=this.paragraphId,this.S8.ASf())}isValid(){return 0<=this.S8.cp}getData(){const Ea=this.S8.Ipb;return Ea?new If.a(0,
this.Lc,this.kGa,Ea,null,null,null,0,this.shapeId):null}static kAb(Ea,yb,kc,Rc,Xc){return yb?new tf(yb,parseInt(Ea.hRa),Ea.C6a,Ea.YQ,kc,Rc,Xc,Ea.shapeId):null}}Object(l.a)(tf,"WordPresenceIp",null,[751,106,752]);class vf{constructor(Ea,yb,kc){this.HSa=this.nba=this.Pvc=!1;this.Qab=Ea;this.EVa=kc;this.user=yb}get ip(){return this.EVa}get icc(){return this.Pvc}set icc(Ea){(this.Pvc=Ea)&&this.ip.ASf()}zrf(){const Ea=fg.instance.LXl();return new Ec(this.Qab,this.user.clientId,1,0,this.ip?this.ip.getData():
null,new Oe(this.user.PQ,this.user.QEc,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ea)}O5h(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():md.a.nil.toString())}isValid(){const Ea=!!this.user&&this.user.isValid(),yb=!this.ip||this.ip.isValid();return Ea&&yb}clone(){const Ea=new vf;Ea.Qab=this.Qab;Ea.Pvc=this.Pvc;
Ea.user=this.user?this.user.clone():null;Ea.EVa=this.ip?this.ip.clone():null;Ea.nba=this.nba;Ea.HSa=this.HSa;return Ea}static k9e(Ea,yb,kc,Rc,Xc){if(!Ea||!yb)return null;if(Ea.ot)return k.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Ea.ot),null;let yd;yd=void 0!==Ea.Tia&&null!==Ea.Tia?jb.CHh(Ea.clientId,Ea.Tia.UserName,Ea.Tia.Capabilities,Ea.Tia.LocalCobaltSessionId,Ea.Tia.SkypeChatThreadId,Ea.Tia.Email,Ea.client,Ea.Tia.ChatThreadDiscoveryUri,Ea.Tia.InChat,
!1,Ea.Tia.IsAnonymous,Ea.Tia.PresenceStatus):jb.CHh(Ea.clientId,null,0,void 0,void 0,void 0,Ea.client);return new vf(Ea.packetId,yd,tf.kAb(Ea.HS,yb,kc,Rc,Xc))}}Object(l.a)(vf,"WordPresenceInfo",null,[746,106]);class $f extends rc{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Oh,Yg,xi){super(Ea,yd,xi,yb);this.KRj=kc;this.jbk=Rc;this.I$j=Xc;this.ib=gf;$f.Gt=vc;this.kI=Le;this.od=id;this.aLa=Gi;this.DVe=Oh;this.cJa=Yg}tkg(Ea){this.cJa.Hzi(Ea.CommandValueId);return super.tkg(Ea)}fOm(Ea){let yb;({CXf:yb}=
this.RCf(Ea)).returnValue&&(this.jbk(yb.ip.paragraphId,yb.ip.S8.cp),m.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Ea=$f.h5l(yb),void 0!==Ea&&null!==Ea?(k.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.ib.setSelection(Ea),ab.FocusManager.DJ()&&ab.FocusManager.instance().mg(Hb.AFrame.$n)):k.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Ea=new ca.a(2,1,0,
()=>{this.ga.Rb(db.a.Uge,2,yb)}),pb.a.instance.Wb(Ea))}bai(Ea){return Ea?(Ea=vf.k9e(Gf(Ea),this.kI,this.od,this.aLa,this.DVe.instance))&&Ea.isValid()&&Ea.ip?Ea:null:null}ILk(Ea){return this.WHm(Ea)?this.aMk(Ea)?!0:(k.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(k.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}WHm(Ea){return!!this.bai(Ea)}RCf(Ea){Ea=this.bai(Ea);return{returnValue:!!Ea,
CXf:Ea}}aMk(Ea){let yb;return({CXf:yb}=this.RCf(Ea)).returnValue?this.KRj(yb.ip.paragraphId,yb.ip.S8.cp):!1}CEl(){if(!this.cD)return[];const Ea=[];for(const yb of this.cD.U_a())yb.userName?Ea.push(yb):k.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Ea}Z_k(Ea){let yb;return({CXf:yb}=this.RCf(Ea)).returnValue&&yb.user&&yb.user.presenceStatus&&"0"!==yb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,yb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}NMn(){this.I$j(this.settings.id)}static createInstance(Ea,
yb,kc,Rc,Xc,yd,gf){const vc=Sa.App.ya.jb,Le=m.AFrameworkApplication.xa,id=lb.a.instance,Gi=Da.a.instance.resolve("Box4.ICoauthCashTelemetry");return new $f(Ea,yb,Oh=>vc.xc.Yi?vc.xc.F3e(Oh,!0):!1,(Oh,Yg)=>{vc.xc.Yi&&vc.xc.SGa(Oh,Yg,!0,!0,!1)},()=>{Sa.App.Ov.tI.q$c()},Le,id,vc,kc,Rc,Xc,yd,Gi,gf)}static h5l(Ea){const yb=$f.Gt.Wc.ud.Db(Ea.ip.paragraphId);if(void 0===yb||null===yb)return k.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!qa.ParagraphReader.Yb(yb))return k.ULS.sendTraceTag(20764577,
325,15,"The obtained node is not a paragraph node"),null;Ea=Ga.a.Tc(yb,Ea.ip.S8.cp);return new Fb.Selection([Ea],!0)}}$f.Gt=null;Object(l.a)($f,"WordEditorPeoplesWell",rc,[]);class vg{constructor(){this.zx=()=>{m.AFrameworkApplication.zVi?vg.wpa.tD().continueWith(this.AZc):k.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")};this.AZc=()=>{vg.nj=vg.wpa.tD().result;if(vg.nj){var Ea=()=>{const yb=Sa.App.ya.jb;return yb?yb.Wc?yb.Wc.ud:(k.ULS.sendTraceTag(23196876,
325,15,"ActivePage is null"),null):(k.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};Sa.App.cna().continueWith(()=>{const yb=Sa.App.cna().result.kj,kc=Ya.CuiHelper.p0l(m.AFrameworkApplication.Ks,m.AFrameworkApplication.Ks,m.AFrameworkApplication.Ks,m.AFrameworkApplication.Ks),Rc=Xa.createInstance(kc,yb,Object(e.a)(vg.nj.Tce,vg.nj.Tce.KOc,"getUserPresence"),Object(e.a)(vg.nj.Tce,vg.nj.Tce.fhb,"getUserStatusInfo"),m.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));
Da.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>$f.createInstance(Rc,Ha.a.xp(vg.W.Sa("Common.IPeopleInfoProvider")),vg.W.Ma("WordEditor.ParagraphWordIdMapping"),vg.W.Ma("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ea,vg.W.Sa("WordEditor.Presence.IWordPresenceCpFactory"),vg.W.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();vg._instance=Da.a.instance.resolve("Common.IPeoplesWell");vg._instance.dQn();k.ULS.sendTraceTag(23196877,
325,50,"PeoplesWellControl is fully initialized")})}else k.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}}get name(){return"WordEditor.PeoplesWellControl"}yc(Ea){vg.W=Ea}init(){m.AFrameworkApplication.K.Wo(this.zx)}dispose(){vg._instance&&(vg._instance.dispose(),vg._instance=null)}static get wpa(){return null!=vg.ECg?vg.ECg:vg.ECg=Da.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}}vg._instance=null;vg.W=null;vg.nj=null;Object(l.a)(vg,
"WordEditorPeoplesWellControlPackage",null,[1,2]);var Kf=c(78),Ph=c(148);class ff{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le=!1){this.g8a=null;this.Uye=!0;this.bMe=this.yl=this.Fre=null;this.ra=new Ma.a;this.UKa=Ea;this.gZ=yb;this.s8g=kc;this.byc=Rc;this.XIg=yd;ff.Gb=Xc;this.M9j=gf;this.i6=vc;this.P$j=Le;E.Task.WAA(yb,kc).continueWith(Object(e.a)(this,this.xpm,"initOnTaskReady"))}zsk(Ea){this.ra.addHandler("u",Ea)}l0i(){this.ra.raiseEvent("u",null,this)}xpm(){this.gZ.result&&this.s8g.result&&(this.yl=
this.gZ.result,this.bMe=this.s8g.result,this.yl.pYa(Object(e.a)(this,this.X3,"onPresenceUpdated")),this.Fre=new ca.a(2,2,this.XIg,Object(e.a)(this,this.KLo,"updateAwayClientsTask"),88),ff.Gb.Wb(this.Fre))}X3(Ea,yb){(this.Uye||this.nJn(yb.rqa))&&ff.Gb.l4(this.Fre,0)}nJn(Ea){for(let kc in Ea){var yb=this.byc.UPd({key:kc,value:Ea[kc]});if(yb&&yb.clientId&&(yb=yb.clientId.toLowerCase(),(yb=this.g8a[yb]||this.g8a[yb.toUpperCase()])&&2===yb.status))return!0}return!1}KLo(Ea){var yb=this.yl.XLc();if(yb){var kc=
new Date,Rc=!1;if(this.Uye){this.g8a=yb;this.Uye=!1;var Xc=this.g8a;for(var yd in Xc){yb=yd;var gf=Xc[yd];gf.pbc<kc&&(kc=gf.pbc);2===gf.status&&(Rc=!0,this.bMe.Q2c(yb))}Rc&&this.l0i();ff.Gb.l4(Ea,this.O8h(kc))}else{gf=new N.a;yd=!1;var vc=this.g8a;for(Xc in vc){vc=Xc;if(!(vc in this.g8a)||this.UKa.clientId===vc)continue;var Le=this.g8a[vc];const id=yb[vc];if(Le&&id){Le=Le.status;const Gi=id.status;2===Le&&1===Gi?(gf.add(vc),k.ULS.sendTraceTag(38052609,392,50,vc+" returned from away")):1===Le&&2===
Gi&&(yd=Rc=!0,this.bMe.Q2c(vc),k.ULS.sendTraceTag(38052610,392,50,vc+" went away"));1===Gi&&id.pbc<kc&&(kc=id.pbc)}}this.g8a=yb;ff.Gb.l4(Ea,this.O8h(kc));(0<gf.count||Rc)&&this.l0i();0<gf.count&&!this.P$j?(Ea=this.BIl(gf),this.$Co(Ea)):Ea=new N.a;(yd||0<Ea.count)&&this.M9j(Qa.a.YCd,2)}}}$Co(Ea){if(Ea.count)for(let yb of Ea)Ea=this.i6.Jla(String.format(CommonUIStrings.l_EditorsToastArriving,yb),!1),Ea.image=5,Ea.ona="CoAuth_AuthorStatus_16x16x32",this.i6.Kz(Ea)}BIl(Ea){const yb=this.yl.BCb(),kc=new N.a;
for(let Rc in yb){const Xc={key:Rc,value:yb[Rc]};if(Ea.contains(Xc.key)){const yd=this.byc.UPd(Xc);yd&&(kc.add(yd.userName),Ea.remove(Xc.key))}}kc.count||k.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return kc}O8h(Ea){const yb=new Date;return Math.max(Ea.getTime()+this.XIg-yb.getTime(),0)}}ff.Gb=null;Object(l.a)(ff,"AwayManager",null,[]);var yc=c(776);class Rd{constructor(Ea=0){this.updates=Ea}get evf(){return 0!==this.updates}gEa(Ea){return!!(this.updates&Ea)}D5a(Ea){this.updates|=
Ea}toString(){if(this.gEa(0))return"none";const Ea=new N.a;this.gEa(1)&&Ea.add("user(s) joined");this.gEa(2)&&Ea.add("user(s) disconnected");this.gEa(4)&&Ea.add("user(s) updated");return Ea.toArray().join(", ")}}Object(l.a)(Rd,"UserUpdateEvent",null,[]);var de=c(36);class Sb{constructor(Ea,yb,kc,Rc,Xc=null){this.ra=new Ma.a;this.PJ=this.nj=null;this.N3g=this.i4g=this.Xl=!1;this.jq=new Kb.a;Ea.continueWith(()=>{this.nj=Ea.result;this.nj.pYa(Object(e.a)(this,this.NQi,"onRtcPresenceUpdate"));this.nj.$sa(Object(e.a)(this,
this.MQi,"onRtcConnectionChange"));this.Tjg(null,null)});yb.continueWith(()=>{this.PJ=yb.result;this.PJ.kYa(Object(e.a)(this,this.bZc,"onEditorsTableUpdated"))});Xc&&Xc.continueWith(()=>{Xc.result.zsk(Object(e.a)(this,this.Tjg,"updateUserStatus"));this.Tjg(null,null)});this.nLa=kc;this.byc=Rc}get users(){return this.jq}w_b(Ea){this.ra.addHandler("UU",Ea)}V2f(Ea){this.ra.removeHandler("UU",Ea)}Tjg(){if(this.nj){var Ea=!1,yb=this.nj.XLc();for(let Rc in yb){var kc=yb[Rc];const Xc=Rc;this.users.ob(Xc)&&
(kc=this.zuj(kc),Ea=this.users.J(Xc).Fzb!==kc||Ea,this.users.J(Xc).Fzb=kc)}Ea&&(Ea=new Rd(4),this.Sde(Ea))}}zuj(Ea){return 1===Ea.status?0:1}U_a(){this.users.count||(this.i4g||(de.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.i4g=!0),this.Nxn());const Ea=[];for(let yb of this.users)Array.add(Ea,yb.value);return Ea}Nxn(){if(this.nj){var Ea=this.nj.BCb();this.tKf(Ea)}if(this.PJ){Ea=this.PJ.RLc();for(const yb of Ea)yb.Id&&(Ea=this.IJh(yb.Id),this.Sjg(new Rd,Ea))}}IIf(Ea){({value:Ea}=
this.users.Ec(Ea));return Ea}dispose(){this.Xl||(this.nj&&(this.nj.TLb(Object(e.a)(this,this.NQi,"onRtcPresenceUpdate")),this.nj.cgc(Object(e.a)(this,this.MQi,"onRtcConnectionChange"))),this.PJ&&this.PJ.z5i(Object(e.a)(this,this.bZc,"onEditorsTableUpdated")),this.Xl=!0)}MQi(Ea,yb){2===yb.newState&&(Ea=this.tKf(this.nj.BCb()),Ea.evf&&this.Sde(Ea))}bZc(Ea,yb){Ea=new Rd;var kc=this.PJ.RLc();k.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
kc.length,yb.ldn,yb.YJi);const Rc=new Kb.a;for(var Xc of kc){kc=Xc.Id;const yd=this.IJh(kc);this.Sjg(Ea,yd);Rc.Z(kc,yd)}if((yb=yb.leaving)&&0<yb.length)for(Xc=0;Xc<yb.length;Xc++)k.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,yb.J(Xc).Id),({value:kc}=this.users.Ec(yb.J(Xc).Id)).returnValue?kc?(this.users.remove(yb.J(Xc).Id),Ea.D5a(2),Rc.Z(yb.J(Xc).Id,kc)):k.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",yb.J(Xc).Id):
k.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",yb.J(Xc).Id);yb=this.nj.BCb();for(let yd in yb)Xc=this.byc.UPd({key:yd,value:yb[yd]}),Rc.Z(Xc.clientId,Xc);for(let yd of this.users)Rc.ob(yd.value.clientId)||(k.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",yd.key),this.users.remove(yd.key),Ea.D5a(2));Ea.evf&&this.Sde(Ea)}NQi(Ea,yb){Ea=this.tKf(yb.rqa);for(const kc of yb.wHd)this.users.ob(kc)&&(Ea.D5a(2),this.users.J(kc).Fzb=
2);Ea.evf&&this.Sde(Ea)}tKf(Ea){const yb=new Rd;if(!Ea)return yb;for(let Rc in Ea){var kc=this.byc.UPd({key:Rc,value:Ea[Rc]});kc&&(kc=kc.clone(),this.Sjg(yb,kc))}return yb}Sjg(Ea,yb){if(yb){var kc=yb.clientId;var Rc=this.W_n(yb);({value:yb}=this.users.Ec(kc)).returnValue?yb.equals(Rc)||(Ea.D5a(4),this.users.Z(kc,Rc)):(k.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,kc),Ea.D5a(1),this.users.Z(kc,Rc))}}IJh(Ea){return this.users.ob(Ea)?this.users.J(Ea):
Ca.a.H3k(Ea)}W_n(Ea){if(!Ea||!Ea.clientId||!this.PJ)return Ea;const yb=Ea.clone();yb.Fzb=this.AIl(Ea);if(Ea=this.PJ.e6b(yb.clientId))yb.isReadOnly=yb.isReadOnly||Ea.IsReadOnly?!0:!1,yb.userName=this.V_n(yb,Ea),yb.capabilities=this.v7m(yb.capabilities,Ea.Capabilities),yb.email=yb.email||Ea.SIPAddress||Ea.EmailAddress,Ea.JoinCoauthTime&&(yb.WPa=Ea.JoinCoauthTime);yb.color=this.nLa.Q7b(new yc.a(yb.email,void 0,yb.userName,void 0,yb.isAnonymous,yb.clientId),3);return yb}AIl(Ea){if(!this.nj)return 2;if(Ea&&
Ea.clientId){const yb=this.nj.XLc();if(Ea.clientId in yb)return this.zuj(yb[Ea.clientId])}return 2}pWk(Ea,yb){yb.Name&&Ea.userName&&yb.Name!==Ea.userName&&!this.N3g&&(this.N3g=!0,de.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}v7m(Ea,yb){Ea=Ea||new Ta.a;yb&&(yb.SupportsRealtimeChannel&&Ea.D5a(1),yb.SupportsRename&&Ea.D5a(2),yb.SupportsChat&&Ea.D5a(4));return Ea}V_n(Ea,yb){this.pWk(Ea,yb);return yb.Name||Ea.userName||(Ea.isAnonymous||yb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}Sde(Ea){k.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Ea.toString());this.ra.raiseEvent("UU")}}Object(l.a)(Sb,"PeopleInfoProvider",null,[960,9]);var nc;(function(Ea){Ea[Ea.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Ea[Ea.peopleImageClassName=1]="peopleImageClassName";Ea[Ea.peopleImageClusterPath=4]="peopleImageClusterPath";Ea[Ea.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Ea[Ea.imageDimension=6]="imageDimension";
Ea[Ea.rtl=8]="rtl";Ea[Ea.pointerInputManager=9]="pointerInputManager";Ea[Ea.clickInputManager=10]="clickInputManager";Ea[Ea.vertical=11]="vertical";Ea[Ea.zIndex=12]="zIndex";Ea[Ea.contextMenuInputManager=13]="contextMenuInputManager";Ea[Ea.imageDomElement=14]="imageDomElement";Ea[Ea.useIdleTooltip=15]="useIdleTooltip";Ea[Ea.viewportBoundsCallback=16]="viewportBoundsCallback";Ea[Ea.flipHorizontalDirection=17]="flipHorizontalDirection";Ea[Ea.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Ea[Ea.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Ea[Ea.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(nc||(nc={}));Object(l.b)("PresenceTooltipSettingKeys",nc);class Tc{constructor(){this.eu={}}get(Ea,yb=null){Ea=nc[Ea];return"number"===typeof yb?(yb=this.eu[Ea])?Number.parseInvariant(yb.toString()):0:this.eu[Ea]}add(Ea,yb){this.eu[nc[Ea]]=yb}qMa(Ea,yb){nc[Ea]in this.eu||(this.eu[nc[Ea]]=yb)}remove(Ea){delete this.eu[nc[Ea]]}}Object(l.a)(Tc,"PresenceTooltipSettings",null,
[]);class td extends Ma.a{constructor(Ea){super();this._element=null;this.element=Ea}get element(){return this._element}set element(Ea){this._element=Ea}get visible(){return"visible"===this.element.style.visibility}set visible(Ea){this.element.style.visibility=Ea?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ea){this.element.dir=Ea?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ea){this.element.style.zIndex=String(Ea)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ea){return this.element.ownerDocument.createElement(Ea)}sia(){return!0}static WIh(Ea){return"prControl"+(Ea?"Rtl":"")}}Object(l.a)(td,"BasePresenceControl",Ma.a,[9,965]);class je extends Sys.EventArgs{constructor(Ea,yb){super();this.type=Ea;this.Fo=yb}}je.XT="InteractivityChanged";Object(l.a)(je,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class se{static MLl(Ea){return se.NLl(Ea)}static NLl(Ea){const yb=
document.createElementNS(se.zmg,"svg");yb.setAttribute("viewBox",String.format(se.A$k,se.mDj,se.lDj));yb.appendChild(se.o7l(Ea));return yb}static o7l(Ea){const yb=se.mDj/Ea,kc=2*yb,Rc=se.lDj/2;Ea=(Ea-12-8)*yb/2;const Xc=document.createElementNS(se.zmg,"g");Sys.UI.DomElement.addCssClass(Xc,se.z$k);for(let yd=1;3>=yd;yd++)Xc.appendChild(se.nIl(yd,kc,Ea+(6*yd-2)*yb,Rc));return Xc}static nIl(Ea,yb,kc,Rc){const Xc=document.createElementNS(se.zmg,"circle");Sys.UI.DomElement.addCssClass(Xc,String.format("{0}-{1}",
se.bQk,Ea));Xc.setAttribute("cx",String.format("{0}",kc));Xc.setAttribute("cy",String.format("{0}",Rc));Xc.setAttribute("r",String.format("{0}",yb));return Xc}}se.zmg="http://www.w3.org/2000/svg";se.z$k="prDancingDots";se.bQk="prAnimateCircle";se.A$k="0 0 {0} {1}";se.lDj=40;se.mDj=120;Object(l.a)(se,"ModernPresenceTooltipDancingDots",null,[]);var Ze=c(89),Xe=c(97),ye=c(7),Ei=c(23),Db=c(119),Vb=c(49);class Sc extends td{constructor(Ea,yb){super(Ea);this.Ygh=this.T9a=this.rte=this._img=this.ZD=this.Nr=
this.hg=null;this.GLa=yb.get(8,!1);this.B9a=yb.get(6,0);this.Wgk=yb.get(15,!1);this.Rd=yb;this.bRg=0;this.element=Ea;this.element.className=Sc.Kif;this._span=document.createElement("span");this.element.appendChild(this._span);this.PVj=se.MLl(yb.get(6,0));this.bF(yb);this._state=5}jyb(Ea){this.addHandler(je.XT,Ea)}PLb(Ea){this.removeHandler(je.XT,Ea)}get user(){return this.Ygh}get state(){return this._state}dispose(){this.element&&(this.hg.sc(ye.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),
this.hg.sc(ye.a.$A,this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")),this.Nr.sc(ye.a.pointerDown,this.element,Object(e.a)(this,this.zC,"onPointerDown")),this.Nr.sc(ye.a.pointerOut,this.element,Object(e.a)(this,this.iJ,"onPointerOut")),this.Nr.sc(ye.a.pointerOver,this.element,Object(e.a)(this,this.DO,"onPointerOver")),this.ZD.sc(this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}bF(Ea){this.hg=Ea.get(10);this.hg.mb(ye.a.click,
this.element,Object(e.a)(this,this.onClick,"onClick"));this.hg.mb(ye.a.$A,this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior"));this.Nr=Ea.get(9);this.Nr.mb(ye.a.pointerOver,this.element,Object(e.a)(this,this.DO,"onPointerOver"));this.Nr.mb(ye.a.pointerOut,this.element,Object(e.a)(this,this.iJ,"onPointerOut"));this.Nr.mb(ye.a.pointerDown,this.element,Object(e.a)(this,this.zC,"onPointerDown"));this.ZD=Ea.get(13);this.ZD.mb(this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior"))}hide(Ea=
null,yb=0,kc=0){this.Wgk&&Ea?this.kpo(Ea,yb,kc):(3===this.state&&this.j4i(),this.visible=!1,this._state=5)}kpo(Ea,yb,kc=0){this.show(Ea,yb,15,4,void 0,kc)}flj(Ea,yb,kc=!1,Rc=!1,Xc=!1,yd=0){this.show(Ea,yb,20,kc?2:Rc?1:0,Xc,yd)}Ioo(Ea,yb,kc,Rc=!1,Xc=0){this.show(Ea,yb,kc+20,3,Rc,Xc)}show(Ea,yb,kc,Rc=3,Xc=!1,yd=0){!Ea||Rc===this.state&&this.ajm(yb,kc)||(this.nkk(Rc,Xc,yd),this.rea(Ea,Rc,yd),this._state=Rc,4===yd||0===yd&&!this.GLa?this.element.style.left=yb+"px":this.element.style.right=yb+"px",this.element.style.top=
kc+"px",this.visible=!0)}rea(Ea,yb,kc){this.Ygh=Ea;Vb.a.eC(this._span);Db.a.KRk(this._span);this._span.id="fly_"+Ea.clientId;this._span.style.backgroundColor=Ea.color;4!==yb?(this._span.style.height=this.B9a+"px",this._span.style.lineHeight=this.B9a+"px",Db.a.Uhc(this._span,"border-radius",this.B9a+"px")):4===kc||0===kc&&!this.GLa?this._span.style.left="0px":this._span.style.right="0px";2!==yb&&(4===yb?Vb.a.uy(this._span,""):1===yb?this._span.appendChild(this.PVj):(this._span.setAttribute("dir","auto"),
kc=Zb.a.USl(Ea.userName),(!Ea.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&kc||0!==yb?(Ea=Ea.userName,0===yb&&(Ea=kc,Db.a.Uhc(this._span,"text-align","center")),Vb.a.uy(this._span,Ea)):(this._img||(this._img=this.A1k()),this._span.appendChild(this._img),Db.a.Uhc(this._span,"text-align","start"))))}onClick(Ea){if(0===this.state)return this.raiseEvent(je.XT,new je(1,Ea)),!0;3===this.state&&k.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}iJ(Ea){3===this.state&&this.raiseEvent(je.XT,new je(3,Ea));return!1}DO(Ea){3!==Ea.ig&&this.raiseEvent(je.XT,new je(2,Ea));return!1}zC(Ea){if(3!==Ea.ig)return!0;this.raiseEvent(je.XT,new je(4,Ea));return!1}A1k(){const Ea=document.createElement("img");Ea.src=Ze.a.laa("doughperson_white_glyph.svg");Ea.setAttribute("Unselectable","on");Ei.a.Uq(Ea,Ei.a.oh,Ei.a.Ny);return Xe.createClusteredImageFromClusterWithImageClass(this.B9a,this.B9a,null,null,Sc.tyl,
"",!1,"",this.element.ownerDocument,Ea)}nkk(Ea,yb=!1,kc=0){if(!this.iSc(this.state)||!this.iSc(Ea))switch(Sys.UI.DomElement.removeCssClass(this.element,this.rte),this.state){case 4:3===Ea?this.eYa(Sc.Lif,Sc.JXh):this.iSc(Ea)&&this.eYa(Sc.Jif,Sc.JXh);break;case 3:4===Ea?this.eYa(Sc.Oif,Sc.IXh):this.iSc(Ea)&&(yb&&this.j4i(),this.eYa(Sc.Jif,Sc.IXh,yb?Sc.syl:""));break;case 0:case 1:case 2:4===Ea?this.eYa(Sc.Oif,Sc.Mif):3===Ea&&(yb&&this.ulk(),this.eYa(Sc.Lif,Sc.Mif,yb?Sc.KXh:"",3===kc?Sc.wyl:Sc.uyl));
break;default:4===Ea?this.eYa(Sc.Oif):3===Ea?this.eYa(Sc.Lif):this.iSc(Ea)&&this.eYa(Sc.Jif)}}eYa(...Ea){this.rte=Ea.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.rte)}ulk(){this.bRg=window.setTimeout(()=>{this.element&&(this.T9a=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.T9a),this.element.style.zIndex="2",this.T9a.style.zIndex="1")},300)}j4i(){window.clearTimeout(this.bRg);this.T9a&&(Sys.UI.DomElement.removeCssClass(this.T9a,Sc.Mif+" "+Sc.KXh),Sys.UI.DomElement.addCssClass(this.T9a,
Sc.ryl),E.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.T9a.parentNode&&this.element.parentNode.removeChild(this.T9a)}),Db.a.agc(this.element,"z-index"))}iSc(Ea){return 0===Ea||1===Ea||2===Ea}ajm(Ea,yb){const kc=Db.a.hY(this.element.style.top);return Db.a.hY(this.element.style.left)===Ea&&kc===yb}f4f(Ea){3===Ea&&Db.a.faa(this.element,"left")?(Ea=Db.a.hY(this.element.style.left),Db.a.agc(this.element,"left"),this.element.style.right=-1*Ea+"px"):4===Ea&&Db.a.faa(this.element,
"right")&&(Ea=Db.a.hY(this.element.style.right),Db.a.agc(this.element,"right"),this.element.style.left=-1*Ea+"px")}}Sc.Kif="prModernFlyout UIFont";Sc.Oif="flyoutIdle";Sc.Lif="flyoutExpanded";Sc.Jif="flyoutCollapsed";Sc.JXh="flyoutFromIdle";Sc.IXh="flyoutFromExpanded";Sc.Mif="flyoutFromCollapsed";Sc.KXh="flyoutStacked";Sc.syl="flyoutFromStacked";Sc.ryl="flyoutFadeOut";Sc.tyl="cui-img-cont-float cui-img-20by20";Sc.uyl="flyoutLtrDir";Sc.wyl="flyoutRtlDir";Object(l.a)(Sc,"ModernPresenceTooltipFlyoutControl",
td,[]);class bd{constructor(Ea,yb,kc=2,Rc=4){this.offsetTop=Ea;this.offsetLeft=yb;this.jDj=kc;this.Wji=Rc}}Object(l.a)(bd,"FlyoutsPositioningInfo",null,[]);var Ud=c(35);class sf{constructor(Ea=!1,yb=!1){this.Zl=Ea;this.Zye=yb}fUl(Ea,yb,kc,Rc,Xc){const yd=Xc.y,gf=Xc.height;var vc=this.HGl(Rc);const Le=vc+yb,id=Ea*kc+2*(Ea-1);kc=null;1===Ea||this.yLk(vc,id,yd,gf)?Ea=new bd(0,0,2):(Ea=this.qif(Le,id,yd,gf),Ea.offsetTop-=vc);this.Zye?kc=new bd(0,0,void 0,this.Zl?4:3):(Rc=this.GGl(Rc,Xc),vc=Math.max(0,
Xc.x),Xc=Xc.width,yb=Rc+yb,this.zLk(Rc,vc,Xc)?kc=new bd(0,0,void 0,this.Zl?3:4):this.ALk(yb,vc)&&(kc=new bd(0,0,void 0,this.Zl?4:3)),kc||(kc=this.bxl(Rc,yb,vc,Xc)));return new bd(Ea.offsetTop,kc.offsetLeft,Ea.jDj,kc.Wji)}HGl(Ea){return Ud.a.BDa(Ea)}GGl(Ea,yb){return this.Zl?yb.width-Ud.a.T0h(Ea):Ud.a.zlf(Ea)}yLk(Ea,yb,kc,Rc){return Ea+yb<=kc+Rc}qif(Ea,yb,kc,Rc){let Xc=1,yd=Math.max(kc,Ea-yb);yb>Ea-kc&&(Xc=2,yd=yb<Rc?Rc-yb:kc);return new bd(yd,0,Xc)}zLk(Ea,yb,kc){return Ea+150<=yb+kc}ALk(Ea,yb){return 150<=
Ea-yb}bxl(Ea,yb,kc,Rc){Rc-yb>=Ea-kc?Ea=4:(yb=Ea,Ea=3);return new bd(0,yb,void 0,Ea)}}Object(l.a)(sf,"ModernPresenceTooltipPositioner",null,[]);class eg{constructor(Ea,yb,kc,Rc,Xc,yd,gf){this.X9=Ea;this._parent=yb;this.GLg=kc;this.BSj=Rc;this.x_j=Xc;this.JYb=yd;this.GLa=gf;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Ea,yb){if(3!==Ea)if(5!==Ea&&this.X9&&this.X9.length){if(4===Ea){var kc=this.x_j;var Rc=(this.JYb-kc)/2;
this.element.style.height=this.JYb+"px";this.element.style.width=this.JYb+"px";Ea=Db.a.hY(this.X9[0].element.style.top);yb=Db.a.hY(this.GLa?this.X9[0].element.style.right:this.X9[0].element.style.left)}else kc=this.GLg,Rc=(this.JYb-kc)/2,this.element.style.height=this.JYb+"px",this.element.style.width=this.EIl()+2*Rc+"px",Ea=Db.a.hY(this.X9[this.X9.length-1].element.style.top),yb=this.AKk(this.X9[this.X9.length-1].element,kc,yb);Db.a.Uhc(this.element,"border-radius",this.JYb+"px");this.element.style.top=
Ea-Rc-kc+"px";this.GLa?this.element.style.right=yb-Rc+"px":this.element.style.left=yb-Rc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}AKk(Ea,yb,kc){return this.GLa&&!kc?Db.a.hY(Ea.style.right):this.GLa||kc?this.GLa&&kc?-Db.a.hY(Ea.style.left)-yb:-Db.a.hY(Ea.style.right)-yb:Db.a.hY(Ea.style.left)}EIl(){return this.X9&&this.X9.length?this.GLg+Math.min(this.X9.length-1,2)*
this.BSj:0}}Object(l.a)(eg,"ModernPresenceTooltipTarget",null,[]);var Ug=c(112),Lh=c(189);class ah extends td{constructor(Ea,yb,kc){super(Ea);this.hXb=this.pKa=this.TVg=this.ssb=!1;this.jq=[];this.ljd={};this.Rd=kc;this.Zl=kc.get(8,!1);this.PUg=kc.get(15,!1);this.FUj=kc.get(12,0);this.tdb=kc.get(6,0);this.vka=yb;this.shh=kc.get(16);this.Zye=kc.get(17,!1);this.B_j=kc.get(19,!1);this.C9j=kc.get(20,!1);this.gmd=0;this.w9j=new sf(this.Zl,this.Zye);this.jnc=this.w3h();this.ovb=!1;this.TQb=[];this.mtc=
[];this.element.id=ah.egb();this.element.className=td.WIh(this.Zl);this.SZa&&(this.zIndex=this.SZa);this.rtl=this.Zl;this.d8f(yb);this.L5=this.createElement("div");this.L5.className="prFlyoutContainer";this.element.appendChild(this.L5);this.X9=[];this.t$a=new eg(this.f3,this.element,this.tdb,4,6,32,this.Zl);this.Nr=kc.get(9);this.Nr.mb(ye.a.pointerDown,this.t$a.element,Object(e.a)(this,this.wdc,"onHitTarget"));this.Nr.mb(ye.a.pointerOver,this.t$a.element,Object(e.a)(this,this.wdc,"onHitTarget"));
this.Nr.mb(ye.a.pointerOut,this.t$a.element,Object(e.a)(this,this.wdc,"onHitTarget"))}get i9d(){return Lh.a.clone(this.jq)}get f3(){return this.X9}get SZa(){return this.FUj}get J_a(){return this.f3?this.f3.length:0}get aPb(){return 0<this.J_a?this.f3[0].state:5}get FAf(){return 3===this.aPb&&!this.ssb}jyb(Ea){this.addHandler(je.XT,Ea)}PLb(Ea){this.removeHandler(je.XT,Ea)}dispose(){if(this.FAf)this.ovb=!0;else{if(this.f3)for(const Ea of this.f3)Ea.PLb(Object(e.a)(this,this.VQa,"onInteractivityChanged")),
Kf.a.zB(Ea);this.X9=null;this.Nr.sc(ye.a.pointerDown,this.t$a.element,Object(e.a)(this,this.wdc,"onHitTarget"));this.Nr.sc(ye.a.pointerOver,this.t$a.element,Object(e.a)(this,this.wdc,"onHitTarget"));this.Nr.sc(ye.a.pointerOut,this.t$a.element,Object(e.a)(this,this.wdc,"onHitTarget"));super.dispose()}}Gic(){this.P1b();this.visible=!0}Q6c(){this.visible=!0;this.cUh();this.ssb=!0}Oag(){this.Q6c()}hide(){this.R4i();this.i1a();this.t$a.update(this.aPb,this.hXb)}rea(Ea){const yb=this.aPb,kc=this.ssb;Ea.clientId||
(Ea.clientId=(ah.Gtc++).toString());if(Ea.clientId in this.ljd){var Rc=this.eCb(Ea.clientId);if(0<=Rc){Rc=this.jq[Rc];if(Rc.color===Ea.color&&Rc.userName===Ea.userName)return;this.Y4a(Ea.clientId)}}this.hide();Rc=new Sc(this.createElement("div"),this.Rd);Rc.jyb(Object(e.a)(this,this.VQa,"onInteractivityChanged"));this.L5.insertBefore(Rc.element,this.L5.firstChild);this.ljd[Ea.clientId]=Rc;Array.add(this.jq,Ea);Array.add(this.f3,Rc);this.tBj(yb,kc);this.visible=!0}Y4a(Ea){if(this.FAf)Array.add(this.mtc,
Ea);else{var yb=this.aPb,kc=this.ssb;this.hide();this.P2c(Ea);this.tBj(yb,kc)}}iJi(Ea){const yb=this.eCb(Ea);if(!(0>=yb)){var kc=this.jq[yb];Ea=this.ljd[Ea];Array.removeAt(this.jq,yb);Array.insert(this.jq,0,kc);Array.removeAt(this.f3,yb);Array.insert(this.f3,0,Ea);this.L5.removeChild(Ea.element);this.L5.appendChild(Ea.element);this.P1b()}}tBj(Ea,yb){0>=this.jq.length?this.hide():3===Ea&&yb?this.Q6c():this.Gic()}kgf(Ea){if(this.FAf&&this.B_j)return!1;Ea=ah.$qf(Ea);if(this.L5!==Ea&&Vb.a.tPa(this.L5,
Ea))return!0;for(const yb of this.f3)if(Vb.a.tPa(yb.element,Ea))return!0;return!1}position(Ea,yb){this.element.style.top=yb+"px";this.element.style.left=Ea+"px"}P1b(Ea=!1){if(!Ea||this.pKa){this.TVg&&this.Qgj(!0);var yb=Math.min(3,this.J_a)-1;Ea=0;var kc=1,Rc=0;this.hXb&&(Ea=this.jnc,kc=-1,Rc=-this.tdb);for(let Xc=this.J_a-1;Xc>yb;Xc--)this.f3[Xc].flj(this.jq[Xc],-4*yb*kc+Rc,!0,!1,!0,Ea);for(;0<=yb;yb--)this.f3[yb].flj(this.jq[yb],-4*yb*kc+Rc,0<yb,Array.contains(this.TQb,this.jq[yb].clientId),yb!==
this.gmd,Ea);this.gmd=0;this.t$a.update(0,this.hXb);this.zIndex=this.SZa;this.ssb=!1;this.R4i(0);this.ovb&&this.dispose()}}cUh(){this.TVg&&this.Qgj(!1);this.zIndex=this.SZa+1;let Ea,yb,kc;({offsetX:yb,offsetY:Ea,Vji:kc}=this.Gco());for(let Rc=0;Rc<this.J_a;Rc++)this.f3[Rc].Ioo(this.jq[Rc],yb,Ea+(this.tdb+2)*Rc,Rc!==this.gmd,kc)}i1a(){let Ea=0,yb=0;this.hXb&&(Ea=this.jnc,yb=-6);for(let kc=0;kc<this.J_a;kc++)this.f3[kc].hide(this.jq[kc],yb,Ea);this.zIndex=this.SZa;this.visible=this.ssb=!1;this.ovb&&
this.dispose()}Y5e(Ea=0){Ea?(this.pKa=!0,E.Task.delay(Ea).continueWith(()=>{this.PUg?this.Ikm():this.P1b(!0);this.pKa=!1})):this.PUg?this.hide():this.P1b()}Ikm(){this.pKa&&this.hide()}ADk(){if(m.AFrameworkApplication.ta&&m.AFrameworkApplication.ta.Ob.Una&&Ug.c()){const Ea=appChrome.selectors.getShyState();return Ea.isActive&&0!==Ea.state}return!1}VQa(Ea,yb){Ea=this.aPb;this.ADk()||2!==yb.type&&(4!==yb.type||3===Ea)?4===yb.type&&3===Ea?(this.pKa&&(this.pKa=!1),this.Y5e()):3!==yb.type||3!==Ea||this.ssb||
(1<this.J_a?(this.pKa=!0,E.Task.delay(250).continueWith(()=>{this.P1b(!0);this.pKa=!1})):this.Y5e()):(this.pKa&&(this.pKa=!1),3!==Ea&&(this.cUh(),3===yb.Fo.ig&&this.Y5e(2E3)));this.raiseEvent(je.XT,yb)}wdc(Ea){3===Ea.ig?this.VQa(this,new je(4,Ea)):Ea.eventName===ye.a.pointerOver?this.VQa(this,new je(2,Ea)):Ea.eventName===ye.a.pointerOut&&this.VQa(this,new je(3,Ea));return!1}d8f(Ea){this.element.style.width=Ea+"px";this.element.style.height=this.tdb+"px"}P2c(Ea){this.PRn(Ea);Ea=this.eCb(Ea);if(!(0>
Ea)){var yb=this.jq[Ea];Array.removeAt(this.jq,Ea);delete this.ljd[yb.clientId];yb=this.f3[Ea];this.L5.removeChild(yb.element);this.Rd.get(18,!1)&&yb.PLb(Object(e.a)(this,this.VQa,"onInteractivityChanged"));Array.removeAt(this.f3,Ea);yb.dispose()}}R4i(Ea=5){if(this.mtc.length){this.visible&&this.i1a();for(let yb=0;yb<this.mtc.length;yb++)this.P2c(this.mtc[yb]);Array.clear(this.mtc);0>=this.jq.length||5===Ea?this.hide():0===Ea&&this.Gic()}}eCb(Ea){for(let yb=0;yb<this.jq.length;yb++)if(this.jq[yb].clientId===
Ea)return yb;return-1}PRn(Ea){-1===this.eCb(Ea)?k.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.TQb,Ea)&&(Array.remove(this.TQb,Ea),this.jq[0].clientId===Ea&&0<this.TQb.length&&this.iJi(this.TQb[this.TQb.length-1]),this.jq[0].clientId===Ea&&1===this.aPb&&this.P1b())}Qgj(Ea){Ea?Sys.UI.DomElement.addCssClass(this.L5,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.L5,"prBackgroundSelection")}Gco(){let Ea,yb;yb=Ea=0;var kc=
this.jnc;if(this.shh){const Rc=this.shh(this);if(!Rc)return{offsetX:Ea,offsetY:yb,Vji:kc};const Xc=4===this.aPb;kc=this.w9j.fUl(this.J_a,Xc?6:this.tdb,this.tdb,this.element,Rc);yb=kc.offsetTop;this.gmd=this.JSl(kc.jDj,kc.offsetTop);kc=kc.Wji;kc!==this.jnc&&(this.f4f(kc),this.element.dir=3===kc?"rtl":"ltr",this.jnc=kc);kc!==this.w3h()?(Ea=this.C9j?-2:Xc?-6:-this.tdb,this.hXb=!0):this.hXb=!1}return{offsetX:Ea,offsetY:yb,Vji:kc}}JSl(Ea,yb){if(1===Ea)return this.J_a-1;Ea=Math.abs(yb);return 0<Ea?Ea/(this.tdb+
2):0}f4f(Ea){for(let yb=0;yb<this.J_a;yb++)this.f3[yb].f4f(Ea)}w3h(){return this.Zl?3:4}static egb(){return String.format("{0}-{1}","presencetooltip",ah.Gtc++)}static $qf(Ea){return Ea.Ib.rawEvent.relatedTarget}}ah.Gtc=0;Object(l.a)(ah,"ModernPresenceTooltipControl",td,[1213,9]);var dh=c(208),Hf=c(238);class Mf{constructor(Ea){this.Rd=Ea;this.Rd.qMa(10,dh.a.instance);this.Rd.qMa(9,Ph.a.instance);this.Rd.qMa(6,20);this.Rd.qMa(13,Hf.a.instance);this.Rd.qMa(17,!1)}R8e(Ea,yb=!1){this.Rd.qMa(15,yb);return new ah(Ea,
20,this.Rd)}}Object(l.a)(Mf,"ModernPresenceTooltipFactory",null,[1210]);class Md extends td{constructor(Ea,yb){super(Ea);this.jq=null;this.GLa=yb.get(8,!1);this.B9a=yb.get(6,0);this.element=Ea;this.element.className=Md.Kif;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.hg=yb.get(10);this.hg.mb(ye.a.click,this.element,Object(e.a)(this,this.onClick,"onClick"));this.Nr=yb.get(9);this.Nr.mb(ye.a.pointerOut,this.element,Object(e.a)(this,this.iJ,"onPointerOut"));this.Nr.mb(ye.a.pointerDown,
this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior"));this.ZD=yb.get(13);this.ZD.mb(this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior"))}jyb(Ea){this.addHandler(je.XT,Ea)}PLb(Ea){this.removeHandler(je.XT,Ea)}get users(){return this.jq}dispose(){this.element&&(this.hg.sc(ye.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.Nr.sc(ye.a.pointerDown,this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")),
this.Nr.sc(ye.a.pointerOut,this.element,Object(e.a)(this,this.iJ,"onPointerOut")),this.ZD.sc(this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Ea,yb,kc){this.hide();!Ea||0>=Ea.length||(this.GLa?this.element.style.right=yb+"px":this.element.style.left=yb+"px",this.element.style.top=kc+"px",this.apk(Ea),this.visible=!0)}apk(Ea){this.jq=Ea;Vb.a.eC(this._ul);for(let yb=Ea.length-1;0<=yb;yb--)this.rea(Ea[yb])}rea(Ea){const yb=
document.createElement("li");yb.style.backgroundColor=Ea.color;yb.style.height=this.B9a+"px";yb.id="fly_"+Ea.clientId;yb.style.lineHeight=this.B9a+"px";Vb.a.uy(yb,Ea.userName);yb.setAttribute("dir","auto");this._ul.appendChild(yb)}onClick(){this.hide();return!1}iJ(Ea){this.raiseEvent(je.XT,new je(3,Ea));return!1}}Md.Kif="prFlyout UIFont";Object(l.a)(Md,"PresenceTooltipFlyoutControl",td,[]);class Sd extends td{constructor(Ea,yb,kc){super(Ea);this._img=null;this.jq=[];this.element.className="prGlyph";
this.Rd=yb;this.NWb=this.Rd.get(9);this.Bq=this.Rd.get(10);this.ZD=this.Rd.get(13);this.elm();this.rea(kc);this.sDe=!1}get P3a(){return this.jq.length}get users(){return this.jq}jyb(Ea){this.addHandler(je.XT,Ea)}PLb(Ea){this.removeHandler(je.XT,Ea)}dispose(){this.xJo();super.dispose()}rea(Ea){Array.add(this.jq,Ea);2===this.P3a?this.Nia(!0):1===this.P3a?this.Nia(!1):this.Nia(this.sDe)}Y4a(Ea){this.vul(Ea)&&(1<this.P3a&&this.Nia(!0),1===this.P3a?this.Nia(!1):1>this.P3a&&this.hide())}show(){this.Nia(2<=
this.P3a);this.visible=!0}hide(){this.visible=!1}tSl(Ea){return Ea?this.Y1h(0,5):this.Y1h(1,4)}vul(Ea){for(let yb=0;yb<this.P3a;yb++)if(this.jq[yb].clientId===Ea)return Ea=this.jq[yb],Array.removeAt(this.jq,yb),Ea;return null}Nia(Ea){this.sDe!==Ea&&(this._img&&this.element.removeChild(this._img),this._img=this.tSl(Ea),this.element.appendChild(this._img),this.sDe=Ea);this._img.childNodes[0].style.backgroundColor=this.jq[this.jq.length-1].color}Y1h(Ea,yb){const kc=this.Rd.get(6,0),Rc=this.Rd.get(14);
return Xe.createClusteredImageFromClusterWithImageClass(kc,kc,this.Rd.get(Ea),this.Rd.get(yb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Rc?Rc.cloneNode(!0):null)}DO(Ea){3!==Ea.ig&&this.raiseEvent(je.XT,new je(2,Ea));return!1}onClick(Ea){this.raiseEvent(je.XT,new je(1,Ea));return!0}iJ(Ea){3!==Ea.ig&&this.raiseEvent(je.XT,new je(3,Ea));return!1}xJo(){this.element&&(this.NWb.sc(ye.a.pointerDown,this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")),
this.NWb.sc(ye.a.pointerOver,this.element,Object(e.a)(this,this.DO,"onPointerOver")),this.NWb.sc(ye.a.pointerOut,this.element,Object(e.a)(this,this.iJ,"onPointerOut")),this.Bq.sc(ye.a.$A,this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")),this.Bq.sc(ye.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.ZD.sc(this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")))}elm(){this.element&&(this.NWb.mb(ye.a.pointerDown,this.element,
Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")),this.NWb.mb(ye.a.pointerOver,this.element,Object(e.a)(this,this.DO,"onPointerOver")),this.NWb.mb(ye.a.pointerOut,this.element,Object(e.a)(this,this.iJ,"onPointerOut")),this.Bq.mb(ye.a.$A,this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")),this.Bq.mb(ye.a.click,this.element,Object(e.a)(this,this.onClick,"onClick")),this.ZD.mb(this.element,Object(e.a)(this,this.sia,"stopPropagationAndPreventDefaultBehavior")))}}
Object(l.a)(Sd,"PresenceTooltipGlyph",td,[]);class Pd extends td{constructor(Ea,yb,kc){super(Ea);this.jq=[];this.eK=[];this.XKa=0;this.cAc=this.VTb=!1;this.nHg=null;this.mjd={};this.Rd=kc;this.Zl=kc.get(8,!1);this.Tja=kc.get(11,!1);Ea=kc.get(12,0);this.imageDimension=kc.get(6,0);this.vka=yb;this.element.id=Pd.egb();this.element.className=td.WIh(this.Zl);Ea&&(this.zIndex=Ea);this.rtl=this.Zl;this.d8f(yb);this.Wza=this.createElement("div");this.Wza.className=this.Tja?"prContainerV":"prContainerHr";
this.element.appendChild(this.Wza);this.kSg=Array(this.XKa);for(yb=0;yb<this.XKa;yb++)this.Eaa[yb]=new Md(this.createElement("div"),this.Rd),this.Eaa[yb].jyb(Object(e.a)(this,this.VQa,"onInteractivityChanged")),this.element.appendChild(this.Eaa[yb].element)}get i9d(){return Lh.a.clone(this.jq)}get Eaa(){return this.kSg}get mjh(){return this.nHg}get yhe(){return this.imageDimension+2}get width(){return this.Tja?this.yhe:this.vka}get height(){return this.Tja?this.vka:this.yhe}jyb(Ea){this.addHandler(je.XT,
Ea)}PLb(Ea){this.removeHandler(je.XT,Ea)}dispose(){if(this.Eaa)for(const Ea of this.Eaa)Ea.PLb(Object(e.a)(this,this.VQa,"onInteractivityChanged")),Kf.a.zB(Ea);Kf.a.M5f(this.eK);this.eK=this.kSg=null;super.dispose()}Gic(){this.i1a();this.bbg();this.visible=!0;this.VTb=!1}Q6c(){!this.eK||1>this.eK.length||(this.i1a(),this.visible=!0,this.bbg(),this.Y8d(this.eK[this.eK.length-1]),this.VTb=!0)}Oag(){if(this.eK&&!(1>this.eK.length)){this.visible=!0;this.bbg();var Ea=0;for(const yb of this.eK)this.Y8d(yb,
Ea++);this.VTb=!1;this.cAc=!0}}hide(){this.visible=!1;this.i1a();for(let Ea=0;Ea<this.eK.length;Ea++)this.eK[Ea].hide();this.VTb=!1}kzh(){if(!this.cAc)return!1;let Ea=0;for(const yb of this.Eaa)yb.visible&&Ea++;return this.cAc=0<Ea&&(this.jq.length<=this.XKa?Ea===this.jq.length:Ea===this.XKa)}rea(Ea){if(!(0>=this.XKa)){Ea.clientId||(Ea.clientId=(Pd.Gtc++).toString());if(Ea.clientId in this.mjd){var yb=this.eCb(Ea.clientId);if(0<=yb){yb=this.jq[yb];if(yb.color===Ea.color&&yb.userName===Ea.userName)return;
this.Y4a(Ea.clientId)}}yb=this.kzh();var kc=0;if(this.jq.length<this.XKa){var Rc=new Sd(this.createElement("div"),this.Rd,Ea);Rc.jyb(Object(e.a)(this,this.VQa,"onInteractivityChanged"));this.Zl&&!this.Tja&&0<this.jq.length?this.Wza.insertBefore(Rc.element,this.Wza.firstChild):(this.Wza.appendChild(Rc.element),kc=this.eK.length);Array.add(this.eK,Rc)}else this.Zl&&!this.Tja?Rc=this.eK[0]:(kc=this.eK.length-1,Rc=this.eK[kc]),Rc.rea(Ea);Rc.show();this.mjd[Ea.clientId]=Rc;Array.add(this.jq,Ea);this.dzj(Rc,
kc);yb&&this.Oag()}}Y4a(Ea){const yb=this.kzh();yb&&this.i1a();this.P2c(Ea);this.jq.length>=this.XKa&&this.eK.length<this.XKa&&this.rJn();0>=this.jq.length?this.hide():yb&&this.Oag()}iJi(){}P2c(Ea){var yb=this.eCb(Ea);0>yb||(Ea=this.jq[yb],Array.removeAt(this.jq,yb),yb=this.mjd[Ea.clientId],delete this.mjd[Ea.clientId],yb.Y4a(Ea.clientId),this.dzj(yb),0>=yb.P3a&&(this.Wza.removeChild(yb.element),Array.remove(this.eK,yb),yb.dispose()))}rJn(){var Ea=this.xZl();!Ea||1>=Ea.users.length||(Ea=Array.clone(this.jq),
Ea.forEach(yb=>{this.P2c(yb.clientId)}),Ea.forEach(yb=>{this.rea(yb)}))}eCb(Ea){for(let yb=0;yb<this.jq.length;yb++)if(this.jq[yb].clientId===Ea)return yb;return-1}xZl(){return this.Zl&&!this.Tja?this.eK[0]:this.eK[this.eK.length-1]}position(Ea,yb){this.element.style.top=yb+"px";this.element.style.left=Ea+"px"}bbg(){for(let Ea=0;Ea<this.eK.length;Ea++)this.eK[Ea].show()}i1a(){for(let Ea=0;Ea<this.XKa;Ea++)this.Eaa[Ea].hide();this.cAc=!1}Y8d(Ea,yb=0){if(Ea)if(this.nHg=Ea,this.Tja){const kc=this.imageDimension;
if(1<Ea.users.length)this.Eaa[yb].show(Ea.users,kc,this.height-this.imageDimension);else{const Rc=this.Wza.children.length;for(let Xc=0;Xc<this.Wza.children.length;Xc++)Ea.element===this.Wza.children[Xc]&&this.Eaa[yb].show(Ea.users,kc,this.height-(Rc-Xc)*this.yhe+2)}}else this.Eaa[yb].show(Ea.users,this.width,0)}VQa(Ea,yb){var kc=Object(y.a)(Sd,Ea);kc=kc?this.aWh(kc):-1;if(2===yb.type||1===yb.type&&-1!==kc&&!this.Eaa[kc].visible)this.Y8d(Ea);else if(1===yb.type)this.i1a(),this.VTb=!1;else if(3===
yb.type){if(this.kgf(yb.Fo))return;this.VTb||this.i1a()}this.raiseEvent(je.XT,yb)}kgf(Ea){Ea=Pd.$qf(Ea);let yb=!1;for(const kc of this.Eaa)if(Vb.a.tPa(kc.element,Ea)){yb=!0;break}return this.Wza!==Ea&&Vb.a.tPa(this.Wza,Ea)||yb}dzj(Ea,yb=0){const kc=this.Zwm(Ea);kc&&0>=Ea.P3a?this.Eaa[yb].hide():kc?this.Y8d(Ea):this.Eaa[yb].hide()}aWh(Ea){let yb=0;for(const kc of this.eK){if(Ea===kc)return yb;yb++}return-1}Zwm(Ea){const yb=this.aWh(Ea);return!!this.mjh&&Ea===this.mjh&&-1!==yb&&this.Eaa[yb].visible}d8f(Ea){this.XKa=
Ea===this.imageDimension?1:Math.floor(Ea/this.yhe);this.Tja?(this.element.style.height=Ea+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Ea+"px",this.element.style.height=this.imageDimension+"px")}static egb(){return String.format("{0}-{1}","presencetooltip",Pd.Gtc++)}static $qf(Ea){Ea=Ea.Ib.rawEvent;return Ea.relatedTarget||Ea.toElement}}Pd.Gtc=0;Object(l.a)(Pd,"PresenceTooltipControl",td,[1213,9]);class Fk{constructor(Ea){this.Rd=Ea;this.Rd.qMa(10,dh.a.instance);
this.Rd.qMa(9,Ph.a.instance);this.Rd.qMa(6,16);this.Rd.qMa(13,Hf.a.instance)}R8e(Ea){return new Pd(Ea,16,this.Rd)}}Object(l.a)(Fk,"PresenceTooltipFactory",null,[1210]);var Vg=c(269),Lf=c(106),kg=c(59),Og=c(6),kh=c(5),ai=c(20),Bn=c(91),yh=c(543),bi=c(336),qi=c(117);class ql extends Sys.EventArgs{constructor(Ea,yb){super();this.paragraphId=Ea;this.RQm=yb}}Object(l.a)(ql,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class ci extends td{constructor(Ea,yb,kc,Rc,Xc,yd=null,gf=null){super(null);this.ejd=
this.Tm=null;this.SVc=!1;this.iqa=0;this.rp=Ea;this.bBc=yb;this.Nr=kc;this.mj=Rc;this.cJa=Xc;ci.Psb=0;this.Coh=new Kb.a;this.M8i=new Kb.a;this.$V=yd;this.Na=gf;this.AXj=this.Na.pc("PresenceIpRenderedFloodgateTimeLapseSec",30);this.igk=this.Na.pc("PresenceIpRenderedFloodgateTriggerThreshold",3);this.Zqa=0}get E3a(){return m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Npk(Ea){this.addHandler("CR",Ea)}x5i(Ea){this.removeHandler("CR",Ea)}rae(){this.raiseEvent("CR",new ql(this.rp.ip.paragraphId,
this.SVc))}kLf(){if(Object(qi.a)(ah,this.Tm)){const Ea=Object(y.a)(ah,this.Tm);ci.Psb=0<ci.Psb?ci.Psb+1:Ea.SZa+1;Ea.zIndex=ci.Psb;this.element.style.zIndex=String(ci.Psb)}}c_n(){if(Object(qi.a)(ah,this.Tm)){const Ea=Object(y.a)(ah,this.Tm);ci.Psb=Ea.SZa;Ea.zIndex=Ea.SZa;this.element.style.zIndex=String(Ea.SZa)}}aEi(){this.$V&&!this.SFo()&&this.$V.continueWith(()=>{this.$V.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.AXj)&&this.Zqa++})}SFo(){return this.Zqa>=this.igk}static oDi(){ci.XRg||
(ci.XRg=!0,k.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static egb(Ea){return ci.tmm+Ea.O5h()}}ci.EXi="data-presence-control";ci.pTi="OverlayControlElementOwner";ci.tmm="ipId_";ci.FXi="WacPresence";ci.Hrn="PresenceIpPaddingDiv";ci.XRg=!1;ci.Psb=0;Object(l.a)(ci,"APresenceControl",td,[1498,9]);class Zk{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.T5a=!1}}Object(l.a)(Zk,"PresenceImageControlStyle",null,[1497]);class Wg extends ci{constructor(Ea,
yb,kc,Rc,Xc,yd=null,gf=null){super(Ea,yb,kc,Rc,Xc,yd,gf);this.iJ=()=>{this.pIi();return!1};this.H6d=vc=>{this.Tm&&3===vc.ig&&(2!==this.iqa?(this.kLf(),this.$Nb()):this.pIi());return!1}}Y4a(Ea){this.Tm&&this.Tm.Y4a(Ea)}Eme(){return this.Tm?this.Tm.i9d.length:0}updatePosition(Ea){if(this.element&&this.element.parentNode){var yb=this.o6h(Ea);if(yb){var kc=Sys.UI.DomElement.getBounds(this.element.parentNode),Rc,Xc;({left:kc,top:Rc,height:Xc,width:yb}=this.$0l(yb,kc,this.element.parentNode,this.mj.instance));
this.element.style.top=Rc+"px";this.element.style.left=kc+"px";this.element.style.height=Xc+"px";this.element.style.width=yb+"px";kc=this.w6h(Ea);Db.a.w4(this.element,kc);Ea=this.zof(Ea,this.rp.ip.shapeId);this.vhj(kc,yb,this.isSelected(Ea),m.AFrameworkApplication.isRtl);this.$Nb()}}}kY(){this.element&&(Vb.a.Pw(this.element),this.Tm.Y4a(this.rp.user.clientId),this.rae())}vDh(Ea,yb,kc,Rc){yb=new Zk;if(!Rc||!kc)return yb;kc=this.o6h(Ea);if(!kc)return yb;yb.top=kc.y;yb.left=kc.x;yb.height=kc.height;
yb.width=kc.width;yb.rotation=this.F3l(Ea);yb.T5a=!0;return yb}s6i(Ea,yb,kc,Rc){ci.oDi();this.ejd=Ea;if(Rc){const Xc=this.zof(Ea,this.rp.ip.shapeId);if(!Xc)return;const yd=!this.element;yd&&this.U8e(yb.ownerDocument,Ea);yd||!this.element.parentNode?Xc.appendChild(this.element):this.element.parentNode!==Xc&&(this.element.parentNode.removeChild(this.element),Xc.appendChild(this.element));this.Tm.rea(this.rp.user);this.element.style.borderColor=this.rp.user.color;this.element.id=ci.egb(this.rp);kc.T5a&&
(this.element.style.height=kc.height+"px",this.element.style.top=kc.top+"px",this.element.style.left=kc.left+"px",this.element.style.width=kc.width+"px",Db.a.w4(this.element,kc.rotation),Db.a.w4(this.Tm.element,-1*kc.rotation),this.vhj(kc.rotation,kc.width,this.isSelected(Xc),m.AFrameworkApplication.isRtl),this.$Nb())}this.SVc=!Rc;this.rae()}F3l(Ea){return this.element&&this.element.parentNode&&this.ybi(Db.a.getTransform(this.element.parentNode))?this.ybi(Db.a.getTransform(this.element)):this.w6h(Ea)}ybi(Ea){return Ea&&
-1<Ea.indexOf("deg")&&(Ea=parseInt(Ea.substring(Ea.indexOf("(")+1,Ea.indexOf("deg"))),!isNaN(Ea))?Ea:0}Eyj(Ea){this.element.style.borderColor=this.rp.user.color;this.element.id=ci.egb(this.rp);this.updatePosition(Ea)}U8e(Ea,yb){this.element=Ea.createElement("div");this.element.setAttribute(ci.EXi,!0);Lf.a.jl(this.element,ci.pTi,this);this.element.className=Wg.Gzn;m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",
!1)&&(Ea=yb.Cb)&&Ea.UP&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.Tm=this.bBc.R8e(this.createElement("div"),!0);this.Tm.rea(this.rp.user);this.Tm.hide();this.Nr.mb(ye.a.pointerOut,this.Tm.element,this.iJ);this.Nr.mb(ye.a.pointerDown,this.Tm.element,this.H6d);this.Tm.element.classList.add(ci.FXi);this.element.appendChild(this.Tm.element)}$0l(Ea,yb,kc,Rc){let Xc=Ea.y,yd=Ea.x,gf=Ea.height;Ea=Ea.width;(1<Math.abs(yb.width-kc.offsetWidth)||
1<Math.abs(yb.height-kc.offsetHeight))&&Rc&&(Xc=Math.round(Xc/Rc.ij),yd=Math.round(yd/Rc.ij),gf=Math.round(gf/Rc.ij),Ea=Math.round(Ea/Rc.ij));return{left:yd,top:Xc,height:gf,width:Ea}}isSelected(Ea){return Ea.classList.contains(bi.a.y3b)}vhj(Ea,yb,kc,Rc){this.Tm.element.style.left="auto";this.Tm.element.style.top="auto";this.Tm.element.style.right="auto";this.Tm.element.style.bottom="auto";kc=kc?Math.round(.5*Wg.hqa)+Wg.IDo:0;0<=Ea&&90>Ea||360===Ea?(this.Tm.element.style.top=-.5*Wg.hqa-kc+"px",Rc?
this.Tm.element.style.right=yb-.5*Wg.hqa+"px":this.Tm.element.style.left=yb-.5*Wg.hqa+"px"):90<=Ea&&180>Ea?(this.Tm.element.style.left=-.5*Wg.hqa-kc+"px",Rc?this.Tm.element.style.bottom=-.5*Wg.hqa+"px":this.Tm.element.style.top=-.5*Wg.hqa+"px"):180<=Ea&&270>Ea?(this.Tm.element.style.bottom=-.5*Wg.hqa-kc+"px",Rc?this.Tm.element.style.left=yb-.5*Wg.hqa+"px":this.Tm.element.style.right=yb-.5*Wg.hqa+"px"):(this.Tm.element.style.right=-.5*Wg.hqa-kc+"px",Rc?this.Tm.element.style.top=-.5*Wg.hqa+"px":this.Tm.element.style.bottom=
-.5*Wg.hqa+"px")}Ik(Ea,yb){const kc=this.hOd(Ea,yb);return kc?kc.properties:(Ea=this.u6h(Ea,yb))?Ea.properties:null}zof(Ea,yb){var kc=this.hOd(Ea,yb);return kc&&(kc=kc.nva(Ea.Og,Ea))?kc.element:(yb=this.u6h(Ea,yb))?Object(y.a)(yh.a,yb).Ee(Ea.jc).htmlElement:null}hOd(Ea,yb){Ea=Bn.i(Ea.Cb,5);for(const kc of Ea)if(kc.properties.getValue(Og.a.sBb)===yb)return kc;return null}u6h(Ea,yb){Ea=kh.GraphIterator.$a(Ea.Cb);let kc=Ea.Tb(6);for(;kc;){const Rc=kc.properties.getValue(Og.a.sBb);if(ai.ImageReader.Wu(kc)&&
Rc===yb)return kc;kc=Ea.wf(6)}return null}hSl(Ea){const yb=kg.a.ef(ai.ImageReader.JE(Ea),0);Ea=kg.a.ef(ai.ImageReader.bG(Ea),1);return{Uia:yb,akm:Ea}}w6h(Ea){Ea=this.Ik(Ea,this.rp.ip.shapeId);return ai.ImageReader.ZZ(Ea)}o6h(Ea){var yb=this.rp.ip;if(!yb||!yb.shapeId)return null;var kc=this.Ik(Ea,yb.shapeId);const Rc=this.zof(Ea,yb.shapeId);if(!kc||!Rc)return null;const Xc=ai.ImageReader.sk(kc);let yd=Ea=1,gf;({Uia:yb,akm:gf}=this.hSl(kc));Sa.App.instance&&Sa.App.instance.h8(Xc)?(kc=ai.ImageReader.Fma(kc),
Ea=kg.a.ef(kc[0],0),yd=kg.a.ef(kc[2],1)):kc.hasProperty(Og.a.bca)?(kc=kc.getValue(Og.a.bca),Ea+=kg.a.ef(kc[0],0),yd+=kg.a.ef(kc[2],1)):(Ea+=0<Rc.offsetWidth?(Rc.offsetWidth-yb)/2:2,yd+=0<Rc.offsetHeight?(Rc.offsetHeight-gf)/2:2);return new Sys.UI.Bounds(Math.round(Ea),Math.round(yd),Math.round(yb),Math.round(gf))}pIi(){this.Tm&&(this.Tm.Gic(),this.iqa=1)}$Nb(){for(const Ea of this.Tm.i9d)if(Ea.clientId===this.rp.user.clientId&&!Ea.equals(this.rp.user)){this.Tm.rea(this.rp.user);break}if(this.rp.HSa||
2===this.iqa)this.Tm.Q6c(),this.rp.HSa=!1,this.rp.nba=!0,this.iqa=2;this.rp.nba&&1!==this.iqa||(this.Tm.Gic(),this.rp.nba=!0,this.iqa=1)}}Wg.Gzn="WACImgPresenceHighlight";Wg.hqa=20;Wg.IDo=6;Object(l.a)(Wg,"PresenceImageControl",ci,[]);var Qh=c(296);class Fm{constructor(){this.height=this.top=this.left=this.Cpi=0;this.T5a=!1;this.sB=this.Dh=null}}Object(l.a)(Fm,"PresenceIpControlStyle",null,[1497]);var Pg=c(70);class Xh extends ci{constructor(Ea,yb,kc,Rc,Xc,yd=null,gf=null,vc=null){super(Ea,yb,kc,
Rc,Xc,yd,gf);this.jAc=this.FVa=this.jYb=null;this.DO=Le=>{!this.Tm||this.E3a&&!this.Tm.kgf(Le)||(this.kLf(),this.mde(Le));this.Eyj(this.ejd);return!1};this.iJ=()=>{this.Tm&&this.yQ();return!1};this.H6d=Le=>{this.Tm&&3===Le.ig&&(2!==this.iqa?(this.kLf(),this.mde(Le)):this.yQ());return!1};this.cD=vc}U8e(Ea){this.element=Ea.createElement("div");this.element.setAttribute(ci.EXi,!0);Lf.a.jl(this.element,ci.pTi,this);this.element.className=ci.Hrn;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";
this.Nr.mb(ye.a.pointerOver,this.element,this.DO);this.E3a&&(this.Nr.mb(ye.a.pointerOut,this.element,this.iJ),this.Nr.mb(ye.a.pointerDown,this.element,this.H6d));this.FVa=this.createElement("div");this.FVa.className=Xh.Hzn;this.E3a||(this.jAc=this.createElement("div"),this.jAc.className=Xh.Kzn,this.FVa.appendChild(this.jAc));this.Tm=this.bBc.R8e(this.createElement("div"),this.E3a);Ea=this.Na.$("NoPresenceUserLookUpBeforeRender");this.cD&&!Ea&&(this.rp.user=this.cD.IIf(this.rp.user.clientId)||this.rp.user);
this.Tm.rea(this.rp.user);this.Tm.hide();this.Tm.element.classList.add(this.E3a?ci.FXi:Xh.avn);this.FVa.appendChild(this.Tm.element);this.element.appendChild(this.FVa)}mcl(){this.jYb&&(pb.a.instance.Se(this.jYb),this.jYb=null)}$Nb(Ea){for(var yb of this.Tm.i9d)if(yb.clientId===this.rp.user.clientId&&!yb.equals(this.rp.user)){this.Tm.rea(this.rp.user);break}yb=!1;Xh.kal===this.rp.user.color?({value:yb}=this.Coh.Ec(this.rp.user.clientId,!1),yb||(this.Coh.Z(this.rp.user.clientId,!0),k.ULS.sendTraceTag(17954772,
302,50,'{ "ClientID" : "'+this.rp.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:yb}=this.M8i.Ec(this.rp.user.clientId,!1),yb||(this.M8i.Z(this.rp.user.clientId,!0),k.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.rp.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Ea||this.rp.HSa||2===this.iqa?(this.aEi(),this.Tm.Q6c(),this.rp.HSa=!1,this.rp.nba=!0,this.iqa=2,Xh.tCo):this.rp.nba&&1!==this.iqa?0:(this.aEi(),this.Tm.Gic(),this.rp.nba=!0,this.iqa=1,Xh.sCo)}mde(Ea=null){this.mcl();
const yb=this.$Nb(!!Ea);this.E3a&&Ea&&Ea.eventName===ye.a.pointerOver||this.N4n(yb)}yQ(){this.Tm&&this.iqa&&(this.c_n(),this.Tm.hide(),this.iqa=0)}N4n(Ea){this.jYb=new ca.a(2,1,Ea,()=>{this.jYb=null;this.yQ()},56);pb.a.instance.Wb(this.jYb)}updatePosition(Ea){if(this.element&&this.element.parentNode){var yb=this.c7h(Ea);if(yb){Ea=Sys.UI.DomElement.getBounds(this.element.parentNode);yb=new Sys.UI.Bounds(yb.x-Ea.x,yb.y-Ea.y,Xh.Gpi,yb.height);var kc;({left:Ea,top:yb,height:kc}=this.c1l(yb,Ea,this.element.parentNode,
this.mj.instance));this.element.style.height=2*Xh.nec+kc+"px";this.element.style.top=yb-Xh.nec+"px";this.element.style.left=Ea-Xh.nec+"px";this.FVa.style.height=Math.max(Xh.fIi,kc)+"px";this.mde()}}}kY(){this.element&&(Vb.a.Pw(this.element),this.rae())}vDh(Ea,yb,kc,Rc,Xc){const yd=new Fm;if(!Rc||!kc)return yd;Rc=this.c7h(Ea);if(!Rc)return yd;var gf=kc;kc=Ea;if(Ea.yj){var vc=Ea.fc;gf=Ea.Rg.w7b(this.rp.ip.S8.cp);0>gf&&0==gf;Ea.fc.Uva?Vb.a.tPa(vc.editingElement,Ea.Rg.Pi.J(gf))||(kc=Pg.InteractiveViewManager.instance.vd.Ej(Ea.source),
yb=kc.Rg.Pi.J(gf)):yb=kc.Rg.Pi.J(gf);gf=yb.getBoundingClientRect()}gf=new Sys.UI.Bounds(Rc.x-gf.x,Rc.y-gf.y,Xh.Gpi,Rc.height);Ea=gf.y;Rc=gf.x;gf=gf.height;vc=this.mj.instance;Xc&&vc&&(Xc=vc.ij,Ea=Math.round(Ea/Xc),Rc=Math.round(Rc/Xc),gf=Math.round(gf/Xc));yd.top=Ea-Xh.nec;yd.left=Rc-Xh.nec;yd.height=2*Xh.nec+gf;yd.Cpi=Math.max(Xh.fIi,gf);yd.T5a=!0;yd.Dh=yb;yd.sB=kc;return yd}s6i(Ea,yb,kc,Rc){ci.oDi();this.ejd=Ea;Ea=kc.Dh;yb=kc.sB;if(Ea&&yb){if(Rc){const Xc=!this.element;Xc&&this.U8e(Ea.ownerDocument);
Xc||!this.element.parentNode?Ea.appendChild(this.element):this.element.parentNode!==Ea&&(this.element.parentNode.removeChild(this.element),Ea.appendChild(this.element));this.ejd=yb;Ea=this.rp.user.color;this.FVa.style.borderColor=Ea;this.E3a||(this.jAc.style.borderColor=Ea);this.element.id=ci.egb(this.rp);kc.T5a&&(this.element.style.height=kc.height+"px",this.element.style.top=kc.top+"px",this.element.style.left=kc.left+"px",this.FVa.style.height=kc.Cpi+"px",this.mde())}this.SVc=!Rc;this.rae()}else k.ULS.sendTraceTag(520950942,
302,50,`Skip IpControl rendering due to paragraphElement is null:${!Ea} or paragraphViewElement is null:${!yb}`)}dispose(){this.element&&(this.kY(),this.Nr.sc(ye.a.pointerOver,this.element,this.DO),this.E3a&&(this.Nr.sc(ye.a.pointerOut,this.element,this.iJ),this.Nr.sc(ye.a.pointerDown,this.element,this.H6d)),Kf.a.zB(this.Tm),this.element=this.Tm=null);super.dispose()}Eyj(Ea){const yb=this.rp.user.color;this.FVa.style.borderColor=yb;this.E3a||(this.jAc.style.borderColor=yb);this.element.id=ci.egb(this.rp);
this.updatePosition(Ea)}c1l(Ea,yb,kc,Rc){let Xc=Ea.y,yd=Ea.x;Ea=Ea.height;(1<Math.abs(yb.width-kc.offsetWidth)||1<Math.abs(yb.height-kc.offsetHeight))&&Rc&&(Xc=Math.round(Xc/Rc.ij),yd=Math.round(yd/Rc.ij),Ea=Math.round(Ea/Rc.ij));return{left:yd,top:Xc,height:Ea}}c7h(Ea){const yb=this.rp.ip;if(!yb)return null;let kc;try{const Rc=yb.S8.cp;kc=Qh.a.AZ(Rc,Ea,0<Rc,!1,!1,!1)}catch(Rc){k.ULS.sendTraceTag(4301318,302,15,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",pb.a.instance.zv,
Rc.message,Rc.stack),kc=null}return kc}}Xh.avn="WacPawn";Xh.Gpi=2;Xh.sCo=7E3;Xh.tCo=2E3;Xh.nec=5;Xh.Hzn="presenceIp";Xh.Kzn="PresenceSmallBox";Xh.fIi=10;Xh.kal="0xcccccc";Object(l.a)(Xh,"PresenceIpControl",ci,[]);class fi{constructor(Ea,yb,kc,Rc,Xc=null,yd=null,gf=null){this.Ipc={};this.Gpc={};this.oLg={};this.bBc=Ea;this.Nr=yb;this.Um=kc;this.cJa=Rc;this.$V=Xc;this.Na=yd;this.cD=gf}get Q9k(){return this.Ipc}get oKh(){return this.Gpc}Z0l(Ea){const yb=!!this.Na&&this.Na.$("PeoplesWellExtraButtonInfoIsEnabled");
return Ea.ip.shapeId&&yb?this.d1l(Ea):this.e1l(Ea)}d1l(Ea){const yb=Ea.ip.shapeId.toString();this.oLg[Ea.user.clientId]=yb;const kc=this.Gpc[yb];return kc?(kc.rp=Ea,{returnValue:kc,Cme:!0}):{returnValue:this.Gpc[yb]=new Wg(Ea,this.bBc,this.Nr,this.Um,this.cJa,this.$V,this.Na),Cme:!1}}e1l(Ea){const yb=Ea.user.clientId,kc=this.Ipc[yb];return kc&&kc.rp.user.equals(Ea.user)?(kc.rp=Ea,{returnValue:kc,Cme:!0}):{returnValue:this.Ipc[yb]=new Xh(Ea,this.bBc,this.Nr,this.Um,this.cJa,this.$V,this.Na,this.cD),
Cme:!1}}d7h(Ea){return this.Ipc[Ea]}dSl(Ea){return(Ea=this.Gpc[this.oLg[Ea]])&&!Ea.Eme()?Ea:null}Ahl(){var Ea=this.Ipc;for(const yb in Ea)Ea[yb].dispose();Ea=this.Gpc;for(const yb in Ea)Ea[yb].dispose()}}Object(l.a)(fi,"PresenceControlProvider",null,[]);var kl=c(167);class $k{constructor(){this.Qab=0}T8h(){this.Qab++;this.Qab===Number.MAX_VALUE&&(this.Qab=1);return this.Qab}static get instance(){return $k.mxc}}$k.mxc=new $k;Object(l.a)($k,"PacketIdGenerator",null,[723]);var dj=c(1098);class Mm{constructor(Ea,
yb,kc){this.$4n=Ea;this.Xnm=yb;this.oAi=kc}}Object(l.a)(Mm,"SuccessfulInboundReplicationCallbackData",null,[]);class Qi{constructor(Ea,yb,kc,Rc,Xc,yd,gf){this.F2n=(vc,Le)=>{Le.type||(vc=this.Lk.NQh>=this.TVj,this.zfk&&vc?(vc=this.Zze())?vc.FSh():k.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.DE())};this.Lnn=vc=>{if(vc=Object(y.a)(Mm,vc)){var Le=vc.Xnm.ri.toString(),id=this.Zze(),Gi=id.kt,Oh="";Gi!==vc.oAi&&(k.ULS.sendTraceTag(19964236,
500,50,"Time saved due to force inbound on update notification message = {0} ms",vc.$4n.toString()),Oh=this.sXl(id,Gi,vc.oAi));k.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",Oh,Le)}else k.ULS.sendTraceTag(19964235,500,10,"The callback data was null")};this.x2n=Ea;this.Zze=yb;this.Lk=kc;this.zfk=Xc;this.TVj=yd;this.cVb=Rc;this.vq=gf;this.x2n.t2(this.F2n)}DE(){const Ea=this.Zze();if(!Ea)k.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");
else if(!this.cVb()&&Ea.bQa){let yb=-1;Object(qi.a)(dj.a,Ea)&&(yb=Ea.$j.IGa());const kc=this.vq.eg("Task","ShoulderTapInboundReplicationTimer");Ea.DE(this.Lnn,null,new Mm(yb,kc,Ea.kt))}}sXl(Ea,yb,kc){const Rc=new Sys.StringBuilder;Ea=Ea.node.ud.store.getRevision(yb);if(!Ea)return k.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:yb}),"";for(Rc.append(Ea.id.guid);yb!==kc;){Rc.append(", ");Rc.append(yb.guid);Ea=Ea.gm;if(!Ea)break;
yb=Ea.id}return Rc.toString()}}Object(l.a)(Qi,"ContentNotificationManager",null,[]);class Rg extends Qi{constructor(Ea,yb,kc,Rc,Xc,yd,gf){super(Ea,yb,kc,Rc,Xc,yd,gf)}static get wpa(){return null!=Rg.GCg?Rg.GCg:Rg.GCg=Da.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){if(Sa.App.ya){var Ea=Sa.App.ya.jb;Ea&&(Ea.sea(Rg.IYc),Ea=Ea.Wc)&&(Rg.mv=Ea.contentReplicator,Rg.mv&&Sa.App.cna().continueWith(Rg.vQf))}}static vQf(){Rg.eed=Sa.App.cna().result;Rg.eed&&Rg.eed.Yp&&Rg.wpa.tD().continueWith(Rg.AZc)}static AZc(){Rg.nj=
Rg.wpa.tD().result;if(Rg.nj){var Ea=m.AFrameworkApplication.K,yb=Ea.$("Box4ThrottleInboundRequests");Ea=Ea.pc("Box4ThrottleInboundsAtUserCount",20);Rg.mv.mQd=()=>Rg.nj.sQa;Rg.bed=Rg.bed||new Rg(Rg.nj,()=>Rg.mv,Rg.eed,()=>m.AFrameworkApplication.Rk,yb,Ea,Sa.App.ya.xq);Rg.bed.DE()}}static IYc(Ea){Rg.bed||(Ea.Amb(Rg.IYc),Rg.init())}}Rg.bed=null;Rg.nj=null;Rg.mv=null;Rg.eed=null;Object(l.a)(Rg,"WordContentNotificationManager",Qi,[]);var Cj=c(55);class fl{constructor(Ea,yb,kc,Rc,Xc,yd){this.Zed=null;this.q8g=
Ea;this.od=kc;this.aLa=Rc;this.zy=Xc;this.uh=yd;this.Ipb=yb}clone(){return new fl(this.q8g,this.Ipb.clone(),this.od,this.aLa,this.zy,this.uh)}get cp(){if(null!=this.Zed)return this.Zed;var Ea=this.q8g.paragraphId;if(Ea.equals(md.a.nil))return 0;var yb=this.aLa();if(!yb)return 0;Ea=yb.Db(Ea);if(!Ea)return k.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;yb=this.od.gAb(this.od.jRa(Ea.characterData,Ea.qa),this.Ipb);if(Cj.a.Oj&&this.zy){var kc=Ga.a.Tc(Ea,yb);
this.uh&&Ea.Js&&(kc.Fb=this.uh.hPd(Ea,yb,this.Ipb.Lta));yb=this.zy.paa(kc,!0)}else this.zy&&this.uh&&Ea.Js&&(kc=Ga.a.Tc(Ea,yb),kc.Fb=this.uh.hPd(Ea,yb,this.Ipb.Lta),yb=this.zy.paa(kc,!0));return yb}ASf(){null==this.Zed&&(this.Zed=this.cp)}equals(Ea){return Ea?this.Ipb.isEqual(Ea.Ipb,!1):!1}}Object(l.a)(fl,"WordPresenceCp",null,[784,106,785]);class qj{constructor(Ea,yb){this.zy=Ea;this.uh=yb}create(Ea,yb,kc,Rc){return new fl(Ea,yb,kc,Rc,this.zy,this.uh)}}Object(l.a)(qj,"Factory",null,[764]);class kn extends Sys.EventArgs{constructor(Ea,
yb,kc){super();this.paragraphId=Ea;this.presence=yb;this.czf=kc}}Object(l.a)(kn,"ParagraphChangedEventArg",Sys.EventArgs,[]);class Gk{constructor(Ea){this.cp=Ea}equals(Ea){return Ea?this.cp===Ea.cp:!1}clone(){return new Gk(this.cp)}}Object(l.a)(Gk,"PresenceCp",null,[784,106]);class xk{constructor(Ea,yb,kc,Rc,Xc){this.paragraphId=Ea;this.cp=yb;this.length=kc;this.shapeId=Rc;this.dryDeletion=Xc}}Object(l.a)(xk,"SerializablePresenceIpData",null,[]);class Rh{constructor(Ea,yb,kc,Rc=0,Xc=0){this.fsa=null;
Ea&&(this.fsa=md.a.Gf(Ea));this.p8g=new Gk(yb);this.kGa=kc;this.Ubh=Rc;this.LPg=Xc}get paragraphId(){return this.fsa}get S8(){return this.p8g}get shapeId(){return this.Ubh}get dryDeletion(){return this.LPg}isValid(){return 0<=this.S8.cp&&!!this.paragraphId&&!this.paragraphId.equals(md.a.nil)}getData(){return new xk(this.paragraphId.toString(),this.S8.cp,this.kGa,this.shapeId,this.dryDeletion)}clone(){const Ea=new Rh;Ea.fsa=this.paragraphId;Ea.p8g=this.S8?this.S8.clone():null;Ea.kGa=this.kGa;Ea.Ubh=
this.shapeId;Ea.LPg=this.dryDeletion;return Ea}static kAb(Ea){return Ea.paragraphId&&void 0!==Ea.cp&&null!==Ea.cp&&void 0!==Ea.length&&null!==Ea.length?new Rh(Ea.paragraphId,Ea.cp,Ea.length,void 0,Ea.dryDeletion):null}}Object(l.a)(Rh,"PresenceIp",null,[751,106]);class ln{constructor(Ea,yb){this.ip=Ea;this.user=yb}}Object(l.a)(ln,"SerializablePresenceData",null,[]);class Sf{constructor(Ea,yb){this.HSa=this.nba=this.icc=!1;this.EVa=yb;this.user=Ea}get ip(){return this.EVa}zrf(){return new ln(this.ip?
this.ip.getData():null,this.user.getData())}O5h(){return this.user.clientId+(this.EVa?this.EVa.paragraphId.toString():md.a.nil.toString())}isValid(){const Ea=!!this.user&&this.user.isValid(),yb=!this.ip||this.ip.isValid();return Ea&&yb}clone(){const Ea=new Sf;Ea.user=this.user?this.user.clone():null;Ea.EVa=this.EVa?this.EVa.clone():null;Ea.nba=this.nba;Ea.icc=this.icc;Ea.HSa=this.HSa;return Ea}static kAb(Ea){return Ea?new Sf(jb.kAb(Ea.user),Ea.ip?Rh.kAb(Ea.ip):null):null}}Object(l.a)(Sf,"PresenceInfo",
null,[746,106]);class Jd extends Ma.a{constructor(){super();this.zxc={};this.qUa={};this.RRg=!1}get Ksn(){return this.zxc}get nvi(){return!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}hnh(Ea){this.addHandler("PPC",Ea)}d6i(Ea){this.removeHandler("PPC",Ea)}RNc(Ea){return Ea.ip.paragraphId.toString()}sXe(Ea,yb=!1){this.RRg||(this.RRg=!0,k.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var kc=({Izn:Rc}=this.iMm(Ea)).returnValue;
if(Rc&&!yb)(kc=this.qUa[Ea.user.clientId])&&0<=kc.length&&(kc[kc.length-1].ip.kGa=Ea.ip.kGa);else{kc||this.V4i(Ea.user.clientId);this.nvi&&kc&&this.BOo(Ea);yb=this.RNc(Ea);var Rc=Ea.user.clientId;var Xc=this.zxc[yb]||[],yd=this.qUa[Rc]||[];yd.length>=Jd.RGi&&(yd=yd.splice(-Jd.scn,Jd.RGi));kc||Xc.push(Rc);yd.push(Ea);this.zxc[yb]=Xc;this.qUa[Rc]=yd;Ea.ip.paragraphId.equals(md.a.nil)||this.I_f(Ea.ip.paragraphId,Ea,!0)}}iMm(Ea){var yb=this.qUa[Ea.user.clientId];const kc=!yb||0>=yb.length?null:yb[yb.length-
1],Rc=!!kc&&this.RNc(kc)===this.RNc(Ea);yb=Rc&&kc.ip.S8.equals(Ea.ip.S8)&&kc.user.equals(Ea.user);this.nvi&&yb&&kc.ip.shapeId&&Ea.ip.shapeId&&kc.ip.shapeId!==Ea.ip.shapeId&&(yb=!1);return{returnValue:Rc,Izn:yb}}BOo(Ea){const yb=this.c$k(Ea);yb&&yb.ip.shapeId&&(Ea.ip.shapeId&&Ea.ip.shapeId===yb.ip.shapeId||this.I_f(yb.ip.paragraphId,yb,!1))}c$k(Ea){Ea=this.qUa[Ea.user.clientId];return!Ea||0>=Ea.length?null:Ea[Ea.length-1]}V4i(Ea){const yb=this.qUa[Ea];if(yb&&0<yb.length){const kc=yb[0].ip.paragraphId,
Rc=this.RNc(yb[0]);delete this.qUa[Ea];this.ATn(Rc,Ea);kc.equals(md.a.nil)||this.I_f(kc,yb[0],!1)}}R1h(Ea){return this.zxc[Ea]}VLc(Ea,yb,kc,Rc=!1){const Xc=[],yd=this.R1h(Ea);if(!yd)return Xc;for(let gf=0;gf<yd.length;gf++){const vc=yd[gf],Le=this.qUa[vc];let id=!1;for(let Gi=Le.length-1;0<=Gi;Gi--){const Oh=Le[Gi];if(Rc){if(Oh.nba&&Oh.ip.paragraphId.equals(md.a.Gf(Ea))){id=!0;Xc.push(Oh);break}}else if(Object(qi.a)(Sf,Oh)?Oh.ip.kGa===yb:Oh.ip.kGa===kc){id=!0;Oh.icc=!0;Xc.push(Oh);this.qUa[vc]=Le.splice(Gi,
Le.length);break}}!id&&0<Le.length&&Le[0].icc&&Le[0].ip.paragraphId.equals(md.a.Gf(Ea))&&Xc.push(Le[0])}return Xc}sEl(Ea){if(!Ea||!Ea.Qa||!Ea.Qa.node)return null;Ea=this.VLc(Ea.Qa.node.id.toString(),0,0,!0);Ea=this.gam(Ea);Ea.sort((yb,kc)=>{if(!(yb&&yb.userName&&kc&&kc.userName))return k.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Ea}gam(Ea){if(!Ea||!Ea.length)return[];const yb=[],kc=new K.a(H.a.Xh());for(let Rc=0;Rc<Ea.length;Rc++){const Xc=
Ea[Rc].user;Xc.isAnonymous&&kc.contains(Xc.clientId)||!Xc.isAnonymous&&Xc.email&&kc.contains(Xc.email)||(yb.push(Xc),kc.add(Xc.isAnonymous?Xc.clientId:Xc.email))}return yb}I_f(Ea,yb,kc){this.raiseEvent("PPC",new kn(Ea,yb,kc))}ATn(Ea,yb){Array.remove(this.zxc[Ea],yb)}}Jd.RGi=10;Jd.scn=2;Object(l.a)(Jd,"PresenceDataManager",Ma.a,[1451]);class rn extends Jd{constructor(Ea){super();this.PG=Ea}sXe(Ea,yb=!1){super.sXe(Ea,yb)}RNc(Ea){return Ea.ip.Lc.toString()}R1h(Ea){Ea=this.PG.Db(md.a.Gf(Ea));if(!Ea)return null;
Ea=Ea.ia(Og.a.Lc,0);return this.Ksn[Ea.toString()]}}Object(l.a)(rn,"WordPresenceDataManager",Jd,[]);var mn=c(1469),Al=c(1057),dg=c(1854),Gm=c(19);class gl{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Oh,Yg,xi,Dj,Ml,Kn,Kj,Rj,Ul,uh,yk,Bi,yf){this.cMa=Array(5);this.qUe=this._started=this.wPe=!1;this.ZLe=null;this.R8g=new K.a(H.a.Xh());this.Epd={};this.uEe=!1;this.qsn=()=>{if(!this.qUe&&!this.nl.$y){var Uh=new ca.a(0,1,20,()=>{const ue=new N.a;var Be=this.abb.Q9k;for(var nf in Be){const qe=Be[nf];qe.SVc&&
ue.add(qe.rp.ip.paragraphId)}if(this.j4d){Be=this.abb.oKh;for(const qe in Be)nf=Be[qe],nf.SVc&&!ue.contains(nf.rp.ip.paragraphId)&&ue.add(nf.rp.ip.paragraphId)}this.$_h(ue);this.qUe=!1},72);this.Gb.Wb(Uh);this.qUe=!0}};this.kOi=()=>{this.wPe&&(this.Y6f(),this.wPe=!1)};this.Z3=(Uh,ue)=>{this.Xcj(ue.sl.lb)};this.X3=(Uh,ue)=>{Uh=ue.rqa;for(var Be in Uh){const nf=Uh[Be];this.Na.$("CashTelemetryIsEnabled")&&this.CJc(nf,new Date,null);nf.ip?this.lXe(nf):this.Q2c(nf.user.clientId)}ue=ue.wHd;for(Be=0;Be<
ue.length;++Be)this.Ycl(ue[Be]);this.Hbe()};this.BSf=(Uh,ue)=>{ue.paragraphId?this.yQo(ue.paragraphId.toString(),ue.RQm,this.Epd):k.ULS.shipAssertTag(8758481,302,!1,"null paraid")};this.GXi=(Uh,ue)=>{ue.paragraphId&&(Uh=this.LB.Db(ue.paragraphId))&&((Object(qi.a)(Sf,ue.presence)?this.Pze(Uh):this.Qze(Uh))===ue.presence.ip.kGa&&this.T4n(ue.paragraphId),this.j4d&&this.Jzn(ue))};this.Jv=Ea;this.ib=Rc;this.cD=Xc;this.vvb=yd;this.nl=Le;this.RVj=id;this.abb=Gi;this.LB=kc;this.OTg=Oh;this.Pze=Yg;this.Qze=
xi;this.VNj=gf;this.UVj=vc;this.UKa=Dj;this.Oo=Ml;this.Ic=Kn;this.Gb=Kj;this.cfh=yk;this.D$j=yf;this.$Le=Ul;this.Na=uh;this.gpd=yb;gl.kqd=new Kb.a;for(Ea=0;Ea<this.gpd.length;Ea++)this.gpd[Ea].UPn(this);this.vvb.hnh(this.GXi);this.Jv.pYa(this.X3);Bi&&this.nl.Xka(this.qsn);this.Jv.Uae(this)}get j4d(){return!!this.Na&&this.Na.$("PeoplesWellExtraButtonInfoIsEnabled")}Hbe(Ea=!1){this.cfh&&!Ea||this.o6i()}o6i(){const Ea=new N.a,yb=this.Epd;for(const kc in yb)Ea.add(md.a.Gf(kc));this.$_h(Ea);this.Epd={}}Y6f(){this.ib.hb&&
this.Xcj(this.ib.hb.lb,!0)}Xcj(Ea,yb=!1){this.D$j||(this.LB.Gm.kwa||yb?Ea?(yb=this.C6k(Ea))?this.Jv.f7f(yb):(this.Jv.f7f(null),k.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Ea.Qa.contextId)):this.Jv.f7f(null):this.wPe=!0)}C6k(Ea){if(!this.j4d||!Ea.wjb)if(Ea=Gm.SelectionEditor.Bj(Ea,!0,!1),!Gm.SelectionEditor.hm(Ea))return null;return this.Yuh(Ea)}Yuh(Ea){const yb=Ea.Qa.cpBegin,kc=Ea.Qa.node.id;Ea=this.Pze(Ea.Qa.node);return new Rh(kc.toString(),yb,Ea)}CJc(Ea,yb,kc){if(this.$Le)if(Ea&&
Ea.user&&Ea.user.clientId){var Rc=Ea.user.clientId;this.R8g.contains(Rc)||(this.ZLe?(this.ZLe.CJc(Rc,yb,null,gl.P3l(kc||Ea.user.client)),this.R8g.add(Rc)):this.$Le.continueWith(()=>{this.ZLe=this.$Le.result;this.CJc(Ea,yb,kc)}))}else k.ULS.sendTraceTag(42262876,302,15,"invalid presence")}a1l(Ea){const yb=new N.a;for(let kc=0;kc<Ea.length;kc++)yb.add(this.X$l(Ea[kc]));return yb}lXe(Ea){var yb=null;Ea&&Ea.user&&(yb=Ea.user.client);Ea=Ea.clone();Ea.user=this.cD.IIf(Ea.user.clientId)||Ea.user;this.Na.$("CashTelemetryIsEnabled")&&
this.CJc(Ea,new Date,yb);Ea.isValid()&&!Ea.user.DX()&&(yb=Ea.user.clientId,gl.kqd.ob(yb)||this.Ugi(yb),this.mQo(yb),Ea.user.userName=CommonUIStrings.l_AnonymousUserName);this.vvb.sXe(Ea,!1)}mQo(Ea){const {value:yb}=gl.kqd.Ec(Ea,!1);yb||(gl.kqd.Z(Ea,!0),k.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Ea+'" , "Event" : "CreateAnonymousGrayPawn"}'))}Ugi(){}Q2c(Ea){this.vvb.V4i(Ea)}Ycl(Ea){this.Q2c(Ea);const yb=this.abb.d7h(Ea);yb&&(yb.x5i(this.BSf),yb.dispose());this.j4d&&(Ea=this.abb.dSl(Ea))&&
(Ea.x5i(this.BSf),Ea.dispose())}X6b(Ea){if(12!==Ea.type)return new N.a;Ea=this.vvb.VLc(Ea.id.toString(),this.Pze(Ea),this.Qze(Ea));return 0>=Ea.length?new N.a:this.a1l(Ea)}yQo(Ea,yb,kc){!yb&&Ea in kc&&delete kc[Ea]}dispose(){this.stop();this.vvb.d6i(this.GXi);this.Jv.TLb(this.X3);this.Jv.jig(this);for(let Ea=0;Ea<this.gpd.length;Ea++)this.gpd[Ea].tKo(this);Kf.a.M5f([this.VNj,this.UVj,this.Jv]);this.abb.Ahl()}X$l(Ea){let yb=!1;Ea=({Cme:yb}=this.abb.Z0l(Ea)).returnValue;yb||Ea.Npk(this.BSf);return Ea}bfi(Ea){Ea=
this.LB.Db(Ea);if(!Ea)return this.cMa[0]||(k.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.cMa[0]=!0),null;if(!qa.ParagraphReader.Yb(Ea))return this.cMa[1]||(k.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.cMa[1]=!0),null;if(!Ea.Ee(this.nl.jc))return this.cMa[2]||(k.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.cMa[2]=!0),null;if(!Ea.anchor)return this.cMa[3]||(k.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.cMa[3]=
!0),null;this.cMa[4]||(k.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.cMa[4]=!0);return Ea}A4i(Ea){Ea=this.vvb.VLc(Ea.toString(),-1,-1,!0);if(!Lh.a.mf(Ea))for(const yb of Ea)(Ea=this.abb.d7h(yb.user.clientId))&&Ea.element&&Ea.kY()}$_h(Ea){if(Ea.count){var yb=new N.a;for(var kc of Ea)(Ea=this.bfi(kc))?yb.add(Ea):this.A4i(kc);if(yb.count){kc=this.Ic.Qc(2);try{kc.set(this.Oo);for(const Rc of yb)this.bPh(Rc)}finally{kc&&kc.dispose()}}}}bPh(Ea){Ea.sH(this.nl.jc,32,
!0);Ea.sH(this.RVj,32,!0)}T4n(Ea){this.Epd[Ea.toString()]=null;this.cfh&&!this.uEe&&(Ea=new ca.a(0,1,200,()=>{this.uEe=!1;this.o6i()},70),this.Gb.Wb(Ea),this.uEe=!0)}Jzn(Ea){if(Ea.presence.ip.shapeId&&!Ea.czf){var yb=this.abb.oKh[Ea.presence.ip.shapeId.toString()];yb&&yb.Y4a(Ea.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.ib.lY(this.Z3),this.OTg.X5i(this.kOi))}start(){if(!this._started){this._started=!0;this.ib.gx(this.Z3);this.OTg.nYe(this.kOi);var Ea=this.Jv.BCb();delete Ea[this.UKa.clientId];
this.X3(null,new dg.a(Ea,[]));this.Y6f()}}Uge(Ea){if(Ea&&Ea.isValid()&&Ea.ip){var yb=this.vvb.VLc(Ea.ip.paragraphId.toString(),-1,-1),kc=!1,Rc=null;for(let Xc=0;Xc<yb.length;Xc++)if(Rc=yb[Xc],Rc.user.clientId===Ea.user.clientId){kc=Rc.HSa=!0;break}if(kc)if(yb=Rc.ip.paragraphId,Ea=this.bfi(yb)){yb=this.Ic.Qc(2);try{yb.Eb(Ea),this.bPh(Ea)}finally{yb&&yb.dispose()}}else this.A4i(yb)}}static P3l(Ea){return Ea?Ea?1===Ea?1:2===Ea?2:0:2:0}}gl.kqd=null;Object(l.a)(gl,"PresenceManager",null,[1447,9,701,1448,
1449,1450]);class Cn{constructor(Ea,yb,kc,Rc){this.ySb=null;this._started=this.XCe=!1;this.yxb=null;this.Foa=(Xc,yd)=>{if(!m.AFrameworkApplication.Rk&&(Xc=this.Czj(yd.sl),this.ySb&&Xc)){Xc=this.Dve.VLc(this.ySb.toString(),-1,-1,!0);for(yd=0;yd<Xc.length;yd++)this.yxb[Xc[yd].user.clientId]=Xc[yd];0>=Xc.length||(Xc=this.g3k(Xc),this.Mp.sendNotification(Xc,!0))}};this.$Pi=(Xc,yd)=>{this.ib.hb&&!m.AFrameworkApplication.Rk&&this.XCe&&this.ySb&&this.ySb.equals(yd.paragraphId)&&(Xc=null,!yd.czf||yd.presence.user.clientId in
this.yxb?yd.czf||(Xc=this.JIh(yd.presence.user.userName,!1),delete this.yxb[yd.presence.user.clientId]):(Xc=this.JIh(yd.presence.user.userName,!0),this.yxb[yd.presence.user.clientId]=yd.presence),Xc&&this.Mp.sendNotification(Xc,!0))};this.nj=Rc;this.ib=yb;this.Dve=Ea;this.Mp=kc;this.nj.Uae(this)}start(){this._started||(this._started=!0,this.yxb={},this.Dve.hnh(this.$Pi),this.ib.gx(this.Foa),this.Czj(this.ib.hb))}stop(){this._started&&(this._started=!1,this.yxb=null,this.Dve.d6i(this.$Pi),this.ib.lY(this.Foa))}g3k(Ea){if(1===
Ea.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Ea[0].user.userName);const yb=[],kc=Ea.length;for(let Rc=0;Rc<kc;Rc++)yb.push(Ea[Rc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,yb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}JIh(Ea,yb){return String.format(yb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Ea)}dispose(){this.nj.jig(this);this.stop()}Czj(Ea){if(!Ea)return!1;
Ea=Ea.lb;if(!Ea)return!1;Ea=Ea.Qa;if(!Ea)return!1;this.XCe=Gm.SelectionEditor.jf(Ea);Ea=Ea.node.id;if(Ea.equals(this.ySb)||!this.XCe)return!1;this.ySb=Ea;this.yxb={};return!0}}Object(l.a)(Cn,"PresenceAccessibilityManager",null,[9,701]);class bh{constructor(Ea,yb){this._started=!1;this.PJ=null;this.jkd=!1;this.bZc=()=>{this._started&&this.Gcj()};this.nj=Ea;yb&&(this.PJ=yb,this.PJ.kYa(this.bZc));this.nj.Uae(this)}start(){this._started||(this._started=!0,this.PJ?this.Gcj():this.nj.LO(1,this.rHh()))}Gcj(){const Ea=
this.jkd;(this.jkd=!!this.PJ.xx)&&!Ea&&this.nj.LO(1,this.rHh())}rHh(){const Ea={};Ea.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Ea.HQ=!1;Ea.NT=1;Ea.WEB=!0;return Ea}stop(){this._started&&(this._started=this.jkd=!1)}dispose(){this.nj.jig(this);this.PJ&&this.PJ.z5i(this.bZc)}}Object(l.a)(bh,"EditorsTableNotifier",null,[9,701]);var Ij=c(400),Bd=c(18);class Fe extends gl{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Oh,Yg,xi,Dj,Ml,Kn,Kj,Rj,Ul,uh,yk,Bi,yf,Uh,ue,Be,nf,qe,Sj,on){super(Ea,
yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Yg,xi,Dj,Ml,Rj,Ul,uh,yk,Bi,yf,Uh,ue,qe);this.Lk=null;this.rll=he=>{const vh=!!this.Lk.DB.e6b(he);k.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",he,vh)};this.qll=(he,vh)=>{k.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",vh,he)};this.lha=()=>{if(2===Fe.nj.connectionState&&!Oa.SessionStatusManager.instance.kba){const he={};he.qs=m.AFrameworkApplication.rootQuerySignature;Fe.nj.ipb(he)}};Oh.gb(Bd.a.Rpo,
Jb.a.application,Fe.jnk,64);Oh.gb(Bd.a.n2f,Jb.a.application,Fe.n2f,64);Oh.gb(Bd.a.g_f,Jb.a.application,Fe.g_f,96);Oh.gb(db.a.Uge,Jb.a.application,Fe.Qpo,64);this.kI=Kn;this.od=Kj;this.Oxb=Be;this.UKa.efc=nf;this.UKa.efc.Trk(Fe.aQi);Sj.continueWith(()=>{this.Lk=Sj.result});k.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized");(this.a2=on)&&this.a2.execute(he=>{he.nYa(this.lha)})}WDa(Ea){if(!Ea||!Ea.anchor)return null;for(Ea=Ea.anchor.Wp;Ea;Ea=Ea.mA)if(Ea.XEa)return Ea.lr.node;return null}Yuh(Ea){var yb=
null;yb=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");var kc=Ea.Qa.cpBegin,Rc=Ea.Qa.node;yb&&ai.ImageReader.Wu(Rc)&&(Rc=this.WDa(Rc));if(!Rc)return k.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Rc=this.Qze(Rc);const Xc=Ea.Qa.node.ia(Og.a.Lc,0);if(!this.kI)return k.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var yd=this.kI.value.Ugb(Xc);const gf=Fe.PG.Db(yd);if(!gf)return k.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+yd),null;
kc=this.od.hmc(this.od.jRa(gf.characterData,gf.qa),kc);kc.Lta=-1===Ea.Qa.Fb?0:Ea.Qa.Fb;yd=0;yb&&Ea.wjb&&(yd=this.x5l(Ea));return yb=new tf(this.kI.value,Xc,Rc,kc,this.od,()=>Fe.PG,this.Oxb,yd)}x5l(Ea){const yb=ai.ImageReader.NDa(Ea.Qa);return yb?yb.properties.ia(Og.a.sBb,0):Ea.Qa.node.properties.ia(Og.a.sBb,0)}Ugi(Ea){this.Lk&&this.Lk.cma&&this.Lk.cma.DE(this.rll,this.qll,Ea)}dispose(){this.a2&&this.a2.execute(Ea=>{Ea.SLb(this.lha)});super.dispose()}static get lu(){return Da.a.instance.resolve("Common.Utils.IAriaNotifier")}static tD(){return Fe.Htc.task}static get_instance(){return Fe.jqd.task}static f1l(){return Fe.r8g.task}static get wpa(){return null!=
Fe.FCg?Fe.FCg:Fe.FCg=Da.a.instance.resolve("Box4.Presence.IRtcProxyProvider")}static init(){Fe.jqd||(Fe.jqd=new x.a);Fe.dSg&&(k.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Fe.dSg=!1);if(Sa.App.ya){var Ea=Sa.App.ya.jb;Ea?(Ea.sea(Fe.IYc),Fe.txc=Ea.xc,Ea.Lna()?(Fe.hN=Ea.Wc.contentReplicator,Fe.hN?(Fe.PG=Ea.Wc.ud,Fe.PG?Fe.wpa.tD().continueWith(Fe.Bmn):k.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
k.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):k.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):k.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else k.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static Bmn(){Fe.nj=
Fe.wpa.tD().result;if(Fe.nj){var Ea=[Fe.txc.ZZc,Fe.txc.editingView.ZZc],yb=lb.a.instance,kc=Da.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),Rc=new Cn(kc,yb,Fe.lu,Fe.nj),Xc=m.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?Sa.App.xd.DB:null;Xc=new bh(Fe.nj,Xc);var yd=Da.a.instance.We("WordEditor.IParagraphWordIdMapping"),gf=Da.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),vc=Da.a.instance.resolve("Common.IPeopleInfoProvider");
Fe._instance=new Fe(Fe.nj,Ea,Fe.PG,yb,vc,kc,Rc,Xc,Fe.txc,Fe.txc.editingView.jc,Da.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.xa,Fe.hN,qa.ParagraphReader.textLength,qa.ParagraphReader.dma,Da.a.instance.resolve("Box4.Presence.MyPresenceUser"),yd,gf,Sa.App.jk.Kl,new Ij.a,pb.a.instance,mn.a.get_instance(),Ha.a.xp(Da.a.instance.Sa("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
m.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),Da.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),Da.a.instance.resolve("Common.IPresenceStatusProvider"),!Sa.App.Ds&&!Sa.App.Lm,Sa.App.cna(),Da.a.instance.Sa("Common.ISessionExpirationManager"));k.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Fe.jqd.xg(Fe._instance);Fe.Htc.xg(Fe._instance);Fe.r8g.xg(Fe._instance);Ea=Da.a.instance;Ea.ha("WordEditor.Presence.WordPresenceManager",()=>Fe._instance).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();
Ea.resolve("WordEditor.Presence.WordPresenceManager")}else k.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static IYc(Ea){Fe._instance||(k.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Ea=Object(y.a)(13,Ea))&&Ea.Amb(Fe.IYc),Fe.init())}static aQi(){Fe._instance.Y6f()}static jnk(Ea,yb,kc,Rc,Xc){kc=Xc.split(",");if(!kc||3!==kc.length)return 8;Ea=kc[0].trim();yb=kc[1].trim();kc=
Number.parseInvariant(kc[2].trim());Ea=new Sf(new jb(Ea),new Rh(yb,kc,-1));if(!Fe.Htc.task.isCompleted)return 8;yb=Fe.tD().result;yb.lXe(Ea);yb.Hbe();return 32}static n2f(Ea,yb,kc,Rc,Xc){if(!Fe.Htc.task.isCompleted)return 8;Ea=Fe.tD().result;Ea.Q2c(Xc);Ea.Hbe();return 32}static Qpo(Ea,yb,kc,Rc,Xc){if(!Fe.Htc.task.isCompleted)return 8;Ea=Fe.tD().result;if(!Ea)return 8;Ea.Uge(Xc);return 32}static g_f(Ea,yb,kc,Rc,Xc){if(1===kc)return 32;if(!Fe.wpa.tD().isCompleted)return 8;Ea=Fe.wpa.tD().result;if(!Ea)return k.ULS.sendTraceTag(4301136,
302,10,"rtcProxy is null when trying to display RTC connection status"),8;Xc[Al.a.Value]=2===Ea.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Ea.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}Fe._instance=null;Fe.dSg=!0;Fe.jqd=new x.a;Fe.Htc=new x.a;Fe.r8g=new x.a;Fe.PG=null;Fe.txc=null;Fe.hN=null;Fe.nj=null;Object(l.a)(Fe,"WordPresenceManager",gl,[]);class nn{constructor(Ea){this.ra=new Ma.a;this.NY=Ea;this.NY.CWR(()=>this.NY.result.Ppk(()=>{this.ra.raiseEvent("X")}))}Trk(Ea){this.ra.addHandler("X",
Ea)}IVn(Ea){this.ra.removeHandler("X",Ea)}getStatus(){return this.NY.isCompleted&&this.NY.result?this.NY.result.AHc.toString():"0"}}Object(l.a)(nn,"WordPresenceStatusProvider",null,[755]);class no{constructor(Ea,yb,kc,Rc){this.nj=null;this.WRg=this.qHe=!1;this.Cmn=()=>{this.gZ.isCompleted&&this.gZ.result?(this.nj=this.gZ.result,this.nj.pYa(this.X3),k.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):k.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")};
this.X3=(Xc,yd)=>{Xc=yd.rqa;for(const gf in Xc)if(yd=Xc[gf],!this.qHe&&yd.user.PQ&&yd.user.PQ!==this.S1.PQ){k.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.S1.PQ,yd.user.PQ);this.qHe=!0;break}this.qHe&&this.nj.TLb(this.X3);this.WRg||(k.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.WRg=!0)};this.Lk=Ea;this.S1=yb;this.gZ=kc;kc.continueWith(this.Cmn);this.y5j=Rc;this.y5j.wHf=this.S1}}Object(l.a)(no,"WordPresenceUpdateMonitor",
null,[]);var Zd=c(453),nd=c(1525),Hm=c(231),cf=c(1856),Of=c(1857),xm=c(1740);class ze{constructor(Ea,yb,kc,Rc,Xc,yd,gf){this.ra=new Ma.a;this.qYg=this.d_g=this.sFe=this.R1g=!1;this.vUe=this.dwd=0;this.pZb=null;this.UKa=yd;this.UKa.clientId=Ea.clientId;this.yl=Ea;this.K9=yb;this.h$=Rc;this.NXj=Xc;this.Gb=kc;this.w9a=new Hm.a;this.fn=gf;this.K9&&this.K9.continueWith(()=>{this.K9.wo||this.K9.Ai||this.K9.result.$lh(Object(e.a)(this,this.sMi,"onAmIAloneChanged"))})}get connectionState(){return this.yl.connectionState}pYa(Ea){this.ra.addHandler("PU",
Ea)}TLb(Ea){this.ra.removeHandler("PU",Ea)}$sa(Ea){this.ra.addHandler("CSC",Ea)}cgc(Ea){this.ra.removeHandler("CSC",Ea)}KCc(Ea){this.ra.addHandler("PSU",Ea)}Z2c(Ea){this.ra.removeHandler("PSU",Ea)}xyd(Ea){this.ra.addHandler("PSC",Ea)}Dbe(Ea){this.ra.removeHandler("PSC",Ea)}Rcj(){}get clientId(){return this.yl.clientId}t2(Ea){this.ra.addHandler("UN",Ea)}ULb(Ea){this.ra.removeHandler("UN",Ea)}Qpm(){this.pZb=Array(12);for(let Ea=0;12>Ea;Ea++)this.pZb[Ea]=0;this.d_g=this.fn?this.fn.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;m.AFrameworkApplication.uJ(()=>{this.z1m()})}init(){this.yl.$sa(Object(e.a)(this,this.fha,"onConnectionStateChanged"));this.yl.pYa(Object(e.a)(this,this.X3,"onPresenceUpdated"));this.yl.KCc(Object(e.a)(this,this.ZQa,"onPersistentStateUpdated"));this.yl.xyd(Object(e.a)(this,this.Hdc,"onPersistentStateCleared"));this.yl.t2(Object(e.a)(this,this.S_,"onUpdateNotificationReceived"));this.IDh();this.Qpm()}Uae(Ea){this.w9a.contains(Ea,(yb,kc)=>yb===kc)||(this.w9a.add(Ea),2===this.connectionState&&Ea.start())}jig(Ea){for(let yb=
0;yb<this.w9a.length;yb++)if(this.w9a.J(yb)===Ea){this.w9a.QF(yb);break}}connect(){this.sFe||this.yl.connect()}disconnect(){this.yl.disconnect()}get Tce(){return this.yl}SMh(Ea){return Sf.kAb(Ea)}w7f(Ea,yb){return(new Sf(Ea,yb)).zrf()}f7f(Ea){Ea&&Ea.isValid()&&!this.h$()?this.yl.Rcj(this.w7f(this.UKa.YWl(),Ea)):E.Task.F7(null)}lhc(Ea,yb){return this.yl.lhc(Ea,yb)}P5b(Ea){return this.yl.P5b(Ea)}XLc(){return this.yl.XLc()}LO(Ea,yb,kc=!1){return this.yl.LO(Ea,yb,kc)}BCb(){return this.iHh(this.yl.BCb())}ipb(Ea){const yb=
new x.a;xm.a.getInstance().j0i(Ea,yb);return yb.task}get sQa(){return this.yl.sQa}fha(Ea,yb){2===yb.newState&&this.w9a.forEach(kc=>{kc.start();return!0});yb.newState||this.fn.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.sFe||this.w9a.forEach(kc=>{kc.stop();return!0});this.ra.raiseEvent("CSC",yb)}tif(Ea){return Ea.toLowerCase()}X3(Ea,yb){if(!this.h$()){Ea=this.iHh(yb.rqa);yb=this.kHh(yb.wHd);var kc=new dg.a(Ea,yb);yb=new ca.a(0,1,0,()=>{this.ra.raiseEvent("PU",kc)},57);this.Gb.Wb(yb)}}iHh(Ea){const yb=
{};for(const Rc in Ea){var kc=Rc;const Xc=this.SMh(Ea[Rc]);Xc&&Xc.isValid()?yb[this.tif(kc)]=Xc:k.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",kc)}return yb}kHh(Ea){const yb=Array(Ea.length);for(let kc=0;kc<Ea.length;kc++)yb[kc]=this.tif(Ea[kc]);return yb}ZQa(Ea,yb){if(!this.h$()){var kc={};Ea=yb.rqa;for(var Rc in Ea)kc[this.tif(Rc)]=Ea[Rc];Rc=new ca.a(0,1,0,()=>{this.ra.raiseEvent("PSU",new cf.a(yb.type,kc))},80);this.Gb.Wb(Rc)}}Hdc(Ea,yb){if(!this.h$()){Ea=this.kHh(yb.LCd);var kc=new Of.a(Ea);
Ea=new ca.a(0,1,0,()=>{this.ra.raiseEvent("PSC",kc)},81);this.Gb.Wb(Ea)}}S_(Ea,yb){this.d_g?this.$Ri(yb):(Ea=new ca.a(0,1,0,()=>{this.$Ri(yb)},58),this.Gb.Wb(Ea))}$Ri(Ea){var yb=Date.now();this.ra.raiseEvent("UN",Ea);yb=Date.now()-yb;500<=yb&&(this.dwd++,k.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Ea.type,yb),this.pwl(Ea));this.vUe++}pwl(Ea){0>Ea.type||21<=Ea.type?k.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",
Ea.type):this.pZb[Ea.type]++}z1m(){if(!this.qYg){var Ea={};Ea.TC=this.vUe;Ea.HRC=this.dwd;this.pZb&&0<this.dwd&&(Ea.TBC=this.pZb);this.dwd=this.vUe=0;this.pZb=null;k.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Ea);this.qYg=!0}}dispose(){this.w9a=new Hm.a;this.yl.cgc(Object(e.a)(this,this.fha,"onConnectionStateChanged"));this.yl.TLb(Object(e.a)(this,this.X3,"onPresenceUpdated"));this.yl.Z2c(Object(e.a)(this,this.ZQa,"onPersistentStateUpdated"));this.yl.Dbe(Object(e.a)(this,
this.Hdc,"onPersistentStateCleared"));this.yl.ULb(Object(e.a)(this,this.S_,"onUpdateNotificationReceived"));this.K9&&this.K9.continueWith(()=>{this.K9.wo||this.K9.Ai||this.K9.result.HUn(Object(e.a)(this,this.sMi,"onAmIAloneChanged"))});this.yl.disconnect();k.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}sMi(){this.IDh()}IDh(){let Ea=!1;this.K9?this.K9.continueWith(()=>{this.K9.wo||this.K9.Ai||(Ea=!this.K9.result.amIAlone);this.yl.connectionState||!Ea&&!this.NXj()?2!==this.yl.connectionState||
Ea||(this.disconnect(),k.ULS.sendTraceTag(4564937,302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),k.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.R1g&&Ea&&(k.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.R1g=!0)}):(this.connect(),k.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}xIc(){this.sFe=!0;this.disconnect();k.ULS.sendTraceTag(4564938,
302,50,"DisconnectForever")}}Object(l.a)(ze,"RtcProxy",null,[1432,9,881,1433]);class Bf extends ze{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Oh,Yg){super(Ea,yb,kc,Rc,Xc,yd,Yg);this.aea=null;this.kI=gf;this.od=vc;this.aLa=Le;this.mxc=id;this.jRe=Gi;this.Oxb=Oh}get tJ(){return this.aea||(this.aea=this.jRe())}fha(Ea,yb){2===yb.newState&&k.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.OQo();super.fha(Ea,yb)}OQo(){this.tJ&&this.tJ.yU("RtcConnectionStatusLabel")}SMh(Ea){return vf.k9e(Gf(Ea),
this.kI,this.od,this.aLa,this.Oxb)}w7f(Ea,yb){return Object(qi.a)(tf,yb)?(Ea=new vf(this.mxc.T8h(),Ea,yb),Nc(Ea.zrf())):super.w7f(Ea,yb)}}Object(l.a)(Bf,"WordRtcProxy",ze,[]);class ch{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Oh,Yg){this.Qp=new x.a;this.Cch=!0;this.ge=yb;this.Gb=kc;this.h$=Rc;this.UKa=Xc;this.kI=yd;this.Psa=gf;this.aLa=vc;this.mxc=Le;this.jRe=id;this.a2=Gi;this.Oxb=Oh;this.Na=Yg}tD(){this.xGo();return this.Qp.task}pNc(){return Zd.a.then(this.tD(),Ea=>Ea)}xGo(){if(this.Cch)if(this.Cch=
!1,Sa.App.HDf()&&Sa.App.DBf()){var Ea=m.AFrameworkApplication.Ke;if(Ea){Ea=nd.RealtimeChannel.createInstance("{"+m.AFrameworkApplication.userSessionId+"}",m.AFrameworkApplication.userSessionId,m.AFrameworkApplication.C$i,Ea,this.a2,1,this.ge,this.Na.kb("RtcEndpointUrl"),void 0,void 0,null,this.Na.$("FindSessionOnBootIsEnabled")?Da.a.instance.resolve("Common.IFindSessionUtils"):null,this.Na.kb("RtcBootToken"));var yb=this.Na.$("RtcAlwaysOnEnabled"),kc=new Bf(Ea,yb?null:Sa.App.cna(),this.Gb,this.h$,
ch.Fzl,this.UKa,this.kI,this.Psa,this.aLa,this.mxc,this.jRe,this.Oxb,m.AFrameworkApplication.K);Sa.App.Ueo(kc);this.LPn(kc);kc.init();kl.App.r5a=kc;this.a2.execute(Rc=>{Rc.Ncb(()=>{kc.xIc()})});this.Qp.xg(kc)}else k.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else k.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}LPn(Ea){const yb=Da.a.instance;yb.ha("WordEditor.Presence.WordRtcProxy",
()=>Ea).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();yb.resolve("Common.IRealtimeChannelBasic")}static Fzl(){return!1}}Object(l.a)(ch,"WordRtcProxyProvider",null,[720,721]);class bj{constructor(){this.W=null;this.Xl=!1}get name(){return"WordEditor.Presence"}init(){k.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");Sa.App.HEj&&(this.W.resolve("WordEditor.Presence.WordRtcProxyProvider").tD(),Fe.init(),this.W.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));
Sa.App.qGc&&Rg.init();this.W.resolve("Common.App.Presence.AwayManager");this.W.resolve("Common.IPeopleInfoProvider");if(bj.eYg){const Ea=this.W.resolve("WordEditor.IMainViewModeManager");Ea.kyb(this.HTf);bj.$De=1===Ea.tv}}dispose(){if(!this.Xl){this.Xl=!0;Fe.tD().continueWith(()=>{Kf.a.zB(Fe.tD().result)});var Ea=this.W.resolve("Box4.Presence.MyPresenceUser");Ea&&Ea.efc&&Ea.efc.IVn(Fe.aQi)}}yc(Ea){this.W=Ea;this.W.ha("Box4.Presence.MyPresenceUser",()=>new ob).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();
Ea.ha("WordEditor.Presence.IWordPresenceCpFactory",()=>new qj(Ea.resolve("Box4.CpConversionManagerImpl"),Ea.resolve("Box4.IContentControlReader"))).singleInstance();Ea.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new no(new U.a(()=>Sa.App.xd),Vg.a.instance,Ea.resolve("WordEditor.Presence.WordRtcProxyProvider").pNc(),Ea.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Ea.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new ch(m.AFrameworkApplication.buildVersion,Sa.App.ya.xq,
pb.a.instance,()=>m.AFrameworkApplication.Rk,Da.a.instance.resolve("Box4.Presence.IMyPresenceUser"),Da.a.instance.Ma("WordEditor.ParagraphWordIdMapping"),Da.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>m.AFrameworkApplication.ta&&Sa.App.ya.jb&&Sa.App.ya.jb.Wc?Sa.App.ya.jb.Wc.ud:null,$k.instance,()=>Da.a.instance.Ma("WordEditor.IStatusBarUser"),Da.a.instance.Sa("Common.ISessionExpirationManager"),Da.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),
m.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Ea.ha("Box4.Presence.PresenceControlProvider",()=>new fi(bj.v8k(),Ph.a.instance,Da.a.instance.Sa("Common.IZoomManager"),Da.a.instance.resolve("Box4.ICoauthCashTelemetry"),Ha.a.xp(Da.a.instance.Sa("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,Ea.resolve("Common.IPeopleInfoProvider"))).singleInstance();Ea.ha("Common.App.Presence.AwayManager",()=>new ff(Da.a.instance.resolve("Common.IPresenceUser"),
Da.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").pNc(),Fe.f1l(),Da.a.instance.resolve("Common.IPresenceConverter"),pb.a.instance,m.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:m.AFrameworkApplication.K.pc("AwayCoauthorThresholdMs",9E5),Object(e.a)(m.AFrameworkApplication.xa,m.AFrameworkApplication.xa.processAction,"processAction"),Sa.App.ya.notificationBar,m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Ea.ha("WordEditor.Presence.WordPresenceStatusProvider",
()=>new nn(Ha.a.xp(Da.a.instance.Sa("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();Ea.ha("Common.App.Presence.PeopleInfoProvider",()=>new Sb(Ea.resolve("WordEditor.Presence.WordRtcProxyProvider").pNc(),Sa.App.cna().CWR(()=>Sa.App.cna().result.DB),Ea.resolve("Common.App.People.IPeopleColorUtils"),Ea.resolve("Common.IPresenceConverter"),Ha.a.xp(Ea.Sa("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Ea.ha("Box4.Presence.WordPresenceDataManager",
()=>new rn(Sa.App.ya.jb.Wc.ud)).as("Box4.IPresenceDataManager").singleInstance()}HTf(Ea,yb){Sa.App.ya&&Sa.App.ya.QC&&(bj.dpd=null,bj.$De=1===yb.Ucc)}static get cTi(){if(!bj.dpd&&Sa.App.ya&&Sa.App.ya.QC){const Ea=kl.App.Hn.QC;bj.dpd=bj.$De&&bj.eYg?Ea.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Ea.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return bj.dpd}static v8k(){const Ea=m.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),yb=m.AFrameworkApplication.K.$("PresenceIgnoreEventOnExpandedTooltip"),
kc=m.AFrameworkApplication.K.$("PresenceIpWidthAdjustForFlyout"),Rc=new Tc;Rc.add(nc.multipleBrowsersImageClassName,Xe.getImageClassWithCluster(m.AFrameworkApplication.Yaa,"MoreUsersGlyph16"));Rc.add(nc.multipleBrowserImageClusterPath,m.AFrameworkApplication.Ks);Rc.add(nc.peopleImageClassName,Xe.getImageClassWithCluster(m.AFrameworkApplication.Yaa,Ea?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Rc.add(nc.peopleImageClusterPath,m.AFrameworkApplication.Ks);Rc.add(nc.zIndex,1);Rc.add(nc.rtl,
m.AFrameworkApplication.isRtl);Rc.add(nc.viewportBoundsCallback,bj.Iam);Rc.add(nc.ignoreEventOnExpandedTooltip,yb);Rc.add(nc.ipWidthAdjustForFlyout,kc);return Ea?new Mf(Rc):new Fk(Rc)}static Iam(){return bj.cTi?Ud.a.getElementBounds(bj.cTi):null}}bj.$De=!0;bj.eYg=m.AFrameworkApplication.K.$("FlippedFlyoutForPaginationViewIsEnabled");bj.dpd=null;Object(l.a)(bj,"WordPresencePackage",null,[1,2]);var Ag=c(1034),Uf=c(1393),Hl=c(1040),th=c(133);class Ym{constructor(Ea,yb){this.mXe=Ea;this.paragraphId=yb}get opType(){return 2}get operation(){return this.mXe}}
Object(l.a)(Ym,"RttAppliedAddParagraphOp",null,[754]);class Nm{constructor(Ea,yb){this.PXn=Ea;this.paragraphId=yb}get opType(){return 6}get operation(){return this.PXn}}Object(l.a)(Nm,"RttAppliedReplaceSymbolRangeOp",null,[754]);class Dn{constructor(Ea,yb){this.TXn=Ea;this.paragraphId=yb}get opType(){return 1}get operation(){return this.TXn}}Object(l.a)(Dn,"RttAppliedReplaceTextRangeOp",null,[754]);class Sn{constructor(Ea,yb,kc){this.joj=Ea;this.xhe=yb;this.sHc=kc}get opType(){return 4}get operation(){return this.joj}get uik(){return this.joj.N2b()?
this.sHc:this.xhe}}Object(l.a)(Sn,"RttAppliedSplitParagraphOp",null,[754]);class Kl{constructor(){this.s8a=new Kb.a}mFf(Ea){return Ea.toString()}qCc(Ea,yb){Ea=this.mFf(Ea);this.s8a.ob(Ea)||this.s8a.Z(Ea,new N.a);this.s8a.J(Ea).add(yb)}jSf(Ea){switch(Ea.opType){case 1:var yb=Object(y.a)(Dn,Ea);this.qCc(yb.paragraphId,Ea);break;case 6:yb=Object(y.a)(Nm,Ea);this.qCc(yb.paragraphId,Ea);break;case 4:yb=Object(y.a)(Sn,Ea);this.qCc(yb.xhe,Ea);this.qCc(yb.sHc,Ea);break;case 2:yb=Object(y.a)(Ym,Ea),this.qCc(yb.paragraphId,
Ea)}}jin(Ea){return this.Zkb(Ea)}Zkb(Ea){Ea=this.mFf(Ea);if(!this.s8a.ob(Ea))return new N.a;const yb=this.s8a.J(Ea);this.s8a.remove(Ea);for(const kc of yb)kc.operation&&(kc.operation.J6=null);return yb}TYl(Ea){let yb;return({value:yb}=this.s8a.Ec(this.mFf(Ea),yb)).returnValue?yb:new N.a}FDl(Ea){for(const yb of this.s8a.values){if(!yb.count)continue;if(2!==yb.J(0).opType)continue;const kc=yb.J(0);if(kc.mXe.dOf===Ea)return kc}return null}}Object(l.a)(Kl,"RttAppliedOpTracker",null,[780]);var Tm=c(236),
rg;(function(Ea){Ea[Ea.Rql=0]="expired";Ea[Ea.j8o=1]="dried"})(rg||(rg={}));Object(l.b)("RemoveChangeReason",rg);class ri{constructor(){this.Qya=new Tm.a}ikk(Ea){if(!Ea)return k.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const yb=Ea.Lc,kc=Ea.sj;this.Qya.ob(yb)||this.Qya.add(yb,new Tm.a);this.Qya.J(yb).Z(kc,Ea);return this.y$k(yb,kc)?(k.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",yb),this.Qya.J(yb).remove(kc),
!1):!0}Lpf(Ea,yb){if(!this.Qya.ob(Ea))return null;Ea=this.Qya.J(Ea);return Ea.ob(yb)?Ea.J(yb):null}oPd(Ea){const yb=new N.a;for(const kc of this.Qya.keys){const Rc=this.Qya.J(kc);for(const Xc of Rc.keys){const yd=Rc.J(Xc);Ea(yd)&&yb.add(yd)}}return yb}O4i(Ea,yb){let kc=null;({value:kc}=this.Qya.Ec(Ea.Lc,kc)).returnValue?(Ea.activity.pQf(rg[yb]),kc.remove(Ea.sj),kc.count||this.Qya.remove(Ea.Lc)):k.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",
Ea.Lc,yb)}X1f(Ea){this.O4i(Ea,1)}$1f(Ea){this.O4i(Ea,0)}y$k(Ea,yb){if(!this.Qya.ob(Ea))return!1;Ea=this.Qya.J(Ea);if(!Ea.ob(yb))return!1;for(var kc=Ea.J(yb);kc;){kc=kc.y0;if(kc===yb)return!0;if(!Ea.ob(kc))break;kc=Ea.J(kc)}return!1}}Object(l.a)(ri,"RttDataStore",null,[778,779]);var Cf=c(305),ne=c(134),Fd=c(301),zj=c(17);class Xd{constructor(Ea,yb){this.h5d=(kc,Rc)=>{4===this.gq.opType?k.ULS.shipAssertTag(9204866,355,12===Rc.node.type||11===Rc.node.type,"Unexpected graph modification detected during RTT edit"):
k.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")};this.Zkb=()=>{k.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")};this.lOi=()=>{k.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")};this.gq=Ea;if(this.eq=yb)Ea=this.eq.af(12),Ea.ku(this.h5d),Ea.Lv(this.Zkb),Ea.Ro(this.lOi)}dispose(){if(this.eq){const Ea=this.eq.af(12);Ea.DU(this.h5d);Ea.ica(this.Zkb);Ea.EU(this.lOi)}}}Object(l.a)(Xd,
"GraphChangeValidator",null,[9]);class Th{constructor(Ea,yb,kc,Rc){this.id=Ea;this.cpBegin=yb;this.cpEnd=kc;this.INk=Rc}AUo(Ea){var yb=this.id===Ea.id;yb&&(yb=this.INk.replace("\u00a0"," "),Ea=Ea.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),yb=yb===Ea);return yb}}Object(l.a)(Th,"RttOpValidator",null,[787]);class Pf{constructor(Ea,yb){this.J6=this.t7a=this.activity=null;this.opType=Ea;this.metadata=yb}usf(){return""}serialize(){return null}}Object(l.a)(Pf,"RttOp",
null,[719]);class rj extends Pf{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le){super(Le,vc);this.Lc=Ea;this.sj=yb;this.YQ=kc;this.R3=Rc;this.y0=Xc;this.Hob=yd;this.lH=gf}cJh(){return this.YQ.isEqual(this.R3,!0)?new If.a(0,this.Lc,this.sj,this.YQ,void 0,void 0,void 0,this.lH):new If.a(1,this.Lc,this.sj,this.YQ,this.Lc,this.sj,this.R3,this.lH)}static yvj(Ea){let yb,kc;var Rc=Ea.HS;if(1===Rc.xae&&(Rc.hRa!==Rc.gGa||Rc.C6a!==Rc.bkc))return k.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),
kc=yb=null,Ea=Rc=-1,{returnValue:!1,YQ:kc,R3:yb,Lc:Ea,sj:Rc};if(Rc.lH)return kc=yb=null,Ea=Rc=-1,{returnValue:!1,YQ:kc,R3:yb,Lc:Ea,sj:Rc};yb=kc=Rc.YQ;1===Rc.xae&&(yb=Rc.R3);Ea=Rc.hRa;Rc=Rc.C6a;return{returnValue:!0,YQ:kc,R3:yb,Lc:Ea,sj:Rc}}}Object(l.a)(rj,"RttReplaceRangeOp",Pf,[]);var En=c(1391),lg=c(413),al=c(595);class Dh extends al.a{constructor(){super();this.RttStatusRecords=this.FileId=null}Cl(){return 110}static maa(Ea,yb){const kc=new Dh;kc.FileId=Ea;kc.RttStatusRecords=yb;return kc}}Object(l.a)(Dh,
"RttStatusRequest",al.a,[]);class Fi{}Object(l.a)(Fi,"RttStatusOp",null,[]);class Ri{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(l.a)(Ri,"WireRttStatusOpRecord",null,[]);class Ll extends lg.a{constructor(){super();const {App:Ea}=c(167);this.AXb=new N.a;this.DOe=new N.a;this.$j=new En.a(m.AFrameworkApplication.K.pc("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=
1;Ea.z0.register(this)}dLj(){const Ea=Date.now();for(const yb of this.AXb)yb.QJb&&1===yb.QJb&&(yb.QJb=2,yb.timeToRender=Ea-yb.metadata.Vfg)}Une(Ea){const yb=new Fi;yb.metadata=Ea.operation.metadata;yb.opType=Ea.opType;yb.QJb=1;this.AXb.add(yb)}get woa(){return"RttStatusReplicator"}m3(){return this.ae&&2===this.ae.status?!0:1===this.enabled&&this.$j.qX()?this.sC():!1}sC(){for(const Ea of this.AXb)if(Ea.QJb&&2===Ea.QJb)return!0;return!1}VRa(){if(1===this._state){this._state=3;const yb=this.AXb.toArray().filter(kc=>
2===kc.QJb);var Ea=this.G2k(yb);Ea=Dh.maa(m.AFrameworkApplication.rootQuerySignature,Ea);yb.forEach(kc=>this.AXb.remove(kc));yb.forEach(kc=>this.DOe.add(kc));this.ae.Jr=Ea;this.ae.FH="RttStatusRequest";this.ae.status=1}else 3===this._state&&this.ae&&2===this.ae.status&&(this.$j.N0(),2!==this.ae.statusCode&&this.AXb.fA(0,this.DOe),this.DOe.clear(),this._state=1)}G2k(Ea){const yb=[];Ea.forEach(kc=>{const Rc=new Ri;Rc.clientId=kc.metadata.clientId;Rc.clientType=kc.metadata.clientType;Rc.packetId=kc.metadata.packetId;
Rc.packetVersion=kc.metadata.packetVersion;Rc.strictlySequentialId=kc.metadata.strictlySequentialId;Rc.contentType=kc.opType;Rc.contentState=kc.QJb;Rc.timeToRender=kc.timeToRender;yb.push(Rc)});return yb}oic(){return!0}DE(){}forceOutbound(){}}Object(l.a)(Ll,"RttStatusReplicator",lg.a,[]);class Pe{constructor(Ea,yb,kc,Rc,Xc,yd){this.packetId=Ea;this.clientId=yb;this.clientType=kc;this.Vfg=Rc;this.packetVersion=Xc;this.strictlySequentialId=yd}static create(Ea){let yb=null;null!=Ea.strictlySequentialId&&
(yb=Ea.strictlySequentialId);return new Pe(Ea.packetId,Ea.clientId,Ea.client,Date.now(),Ea.version,yb)}}Object(l.a)(Pe,"RttOpMetadata",null,[]);class ib extends Pf{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le){super(4,Le);this.y0=0;this.Lc=Ea;this.sj=yb;this.offset=kc;this.lH=Rc;this.Xlg=Xc;this.Cfg=yd;this.une=gf;this.Dfg=vc;this.Xlg===this.Lc?this.y0=this.Cfg:this.une===this.Lc?this.y0=this.Dfg:(k.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.y0=0)}N2b(){return this.Lc===
this.une}get gBo(){return this.y0}get WXo(){return this.N2b()?this.Xlg:this.une}get dsj(){return this.N2b()?this.Cfg:this.Dfg}serialize(){const Ea=new If.a(3,this.Lc,this.sj,this.offset,null,null,null,this.lH),yb=new Uc(this.Xlg,this.Cfg,this.une,this.Dfg);return new Ec(this.metadata.packetId,this.metadata.clientId,1,4,Ea,null,void 0,void 0,void 0,void 0,yb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ea){const yb=Ea.HS,kc=Ea.hOb;return new ib(yb.hRa,yb.C6a,yb.YQ,yb.lH,kc.OUf,kc.Bfg,
kc.PUf,kc.Efg,Pe.create(Ea))}static Y3l(Ea,yb,kc){if(1!==Ea.type)return null;const Rc=kc.jRa(Ea.S3.characterData,Ea.S3.qa);return new ib(Ea.S3.Lc,Ea.S3.sj,kc.hmc(Rc,Ea.Wnj),Ea.lH,Ea.Sxb.Lc,Ea.Sxb.sj,Ea.MDc.Lc,Ea.MDc.sj,yb)}}Object(l.a)(ib,"RttSplitParagraphOp",Pf,[704,719]);class Ib{constructor(Ea,yb,kc,Rc){this.hen=()=>{this.gwb.dLj()};this.jja=Ea;this.Jwc=yb;this.Nja=kc;this.$wb=Rc;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",
!1)&&(this.gwb=new Ll,Cf.GraphTransactionManager.instance.Zlh(this.hen))}fyk(Ea,yb,kc,Rc=null){if(yb.isDirty)return Rc&&Rc.properties.Z(Ib.vUi,"1"),!1;const Xc=new Xd(Ea,yb.Wi);try{if(1===Ea.opType||6===Ea.opType){const vc=Object(y.a)(rj,Ea),Le=this.xZk(vc,yb);var yd=Le.node.characterData;const id=10<=Le.cpBegin?Le.cpBegin-10:0;let Gi=Le.cpEnd+10<=yd.length?Le.cpEnd+10:yd.length;const Oh=yd.substr(id,Le.cpBegin-id),Yg=yd.substr(Le.cpEnd,Gi-Le.cpEnd);Gi=Gi+vc.Hob.length-(Le.cpEnd-Le.cpBegin);var gf=
new Th(Le.node.id,id,Gi,Oh+vc.Hob+Yg);const xi=6===vc.opType;yd="";xi&&(yd=vc.font);if(!this.AXn(Le,vc.Hob,xi,yd,Rc))return!1;let Dj;Dj=1===Ea.opType?new Dn(vc,yb.id):new Nm(vc,yb.id);yb.dma=Ea.y0;vc.t7a=gf;Ea.J6=Dj;kc.jSf(Dj);null!=this.gwb&&this.gwb.Une(Dj)}else return 4===Ea.opType?this.eyk(Ea,yb,kc):!1}finally{Xc&&Xc.dispose()}return!0}eyk(Ea,yb,kc){const Rc=Object(y.a)(ib,Ea);var Xc=this.$wb.jRa(yb.characterData,yb.qa);Xc=this.$wb.gAb(Xc,Rc.offset);if(!this.Rwi(Ga.a.createTextRange(yb,0,qa.ParagraphReader.textLength(yb))))return!1;
var yd=kh.GraphIterator.$a(yb);yd.Ab(10);if(this.Z$b(yd))return!1;let gf;yd=this.Nja.Qc(3);try{yd.Eb(yb);const vc=yb.uY();try{const Le=kh.GraphIterator.$a(yb);Le.Ab(10);Le.fd(11);let id=Le.currentNode;Rc.N2b()&&(Le.KAf?id=null:(Le.QI(),id=Le.currentNode));Le.wc();const Gi=this.Jwc.pAb();Le.rH(Gi,id,89);Le.Fi(Gi);gf=yb.clone();const Oh=gf.uY();try{gf.setValue(Og.a.Lc,Rc.WXo);gf.setValue(Og.a.sj,Rc.dsj);gf.isDirty=!1;Le.Qf(gf,2);Le.Fi(gf);this.p0k(yb,gf);const Yg=Rc.N2b()?gf:yb,xi=Rc.N2b()?yb:gf;Yg.JN=
!0;xi.JN=!0;this.jja.F3f(this.BZa(Yg,Xc,qa.ParagraphReader.textLength(Yg)),"",!1,"");this.jja.F3f(this.BZa(xi,0,Xc),"",!1,"");yb.dma=Rc.gBo;gf.dma=Rc.dsj}finally{Oh&&Oh.dispose()}}finally{vc&&vc.dispose()}yd.qSa()}finally{yd&&yd.dispose()}yb=new Sn(Rc,yb.id,gf.id);Ea.J6=yb;kc.jSf(yb);null!=this.gwb&&this.gwb.Une(yb);return!0}Z$b(Ea){const yb=new kh.GraphIterator;yb.$c(Ea);yb.fd(11);return ne.ListItemReader.Kh(yb)?(k.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}tvl(Ea,
yb,kc){var Rc=yb.Ugb(Ea.Lc);if(Rc.equals(md.a.nil))return null;Rc=kc.Db(Rc);if(!Rc||!qa.ParagraphReader.Yb(Rc)||!Rc.isConnected)return null;const Xc=kh.GraphIterator.$a(Rc);if(!Xc.Ab(23))return null;if(Ea.Wlg){Ea=yb.Ugb(Ea.Wlg);if(Ea.equals(md.a.nil))return null;kc=kc.Db(Ea);if(!kc||!qa.ParagraphReader.Yb(kc)||!kc.isConnected)return null;kc=kh.GraphIterator.$a(kc);if(!kc.Ab(23))return null;kc.fd(11);kc.QI();kc.Sd();if(kc.currentNode!==Rc)return null}return this.Z$b(Xc)?null:Xc}rGo(Ea,yb,kc,Rc){const Xc=
yb.currentNode,yd=this.Nja.Qc(3);try{yd.Eb(Xc);yb.fd(11);const gf=yb.currentNode;yb.wc();const vc=this.Jwc.pAb();yb.rH(vc,gf,89);yb.Fi(vc);const Le=Fd.a.instance.createInstance(393230),id=Le.uY();try{Le.setValue(zj.a.yo,""),Le.YEa=!0,Rc.NLb(Le),Rc=[0],Le.setValue(Og.a.$p,Rc),Le.setValue(Og.a.Ps,Rc),Le.YEa=!1,Le.setValue(Og.a.Lc,Ea.dOf),Le.setValue(Og.a.sj,Ea.cOf),Le.isDirty=!1,yb.Qf(Le,2),Le.JN=!0,Le.dma=Ea.cOf}finally{id&&id.dispose()}yd.qSa();Ea.J6=new Ym(Ea,Le.id);kc.jSf(Ea.J6);null!=this.gwb&&
this.gwb.Une(Ea.J6)}finally{yd&&yd.dispose()}return!0}BZa(Ea,yb,kc){return yb===kc?Ga.a.Tc(Ea,yb):Ga.a.createTextRange(Ea,yb,kc)}AXn(Ea,yb,kc,Rc,Xc=null){const yd=Ea.node;if(Ea.cpBegin!==Ea.cpEnd&&!this.Rwi(Ea))return Xc&&Xc.properties.Z(Ib.vxj,"1"),!1;Xc=this.Nja.Qc(3);try{Xc.Eb(yd);const gf=yd.uY();try{yd.JN=!0,this.jja.F3f(Ea,yb,kc,Rc)}finally{gf&&gf.dispose()}Xc.qSa()}finally{Xc&&Xc.dispose()}return!0}p0k(Ea,yb){yb.YEa=!0;yb.Fpa(Ea.characterData);yb.dma=Ea.dma;yb.qa.clear();for(var kc=0;kc<Ea.qa.length;kc++){const Rc=
Ea.qa.J(kc).wla(yb);yb.qa.add(Rc)}yb.Pm();if(yb.Ae.length)for(Ea=0;Ea<yb.qa.length;Ea++){if((kc=yb.qa.J(Ea).formatting)&&-1!==kc.ze)for(;yb.Ae.length<=kc.ze;)yb.Ae.BX(yb.Ae.length-1,256)}else k.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");yb.YEa=!1}OEf(Ea){Ea=kh.GraphIterator.$a(Ea);Ea.Ab(23);Ea.wc();return{returnValue:89===Ea.role,iterator:Ea}}H2f(Ea){const yb=new kh.GraphIterator;yb.$c(Ea);yb.wc();const kc=this.Nja.Qc(3);try{kc.Eb(yb.currentNode),
Ea.Dg()}finally{kc&&kc.dispose()}}$Rn(Ea){if(Ea.anchor)if(({iterator:yb}=this.OEf(Ea)).returnValue)this.H2f(yb);else{var yb=Ea.Mc.Gm;var kc=this.Nja.Qc(3);try{kc.Eb(Ea),Ea.load(yb.Db(Ea.id)),Ea.anchor.YT(4)}finally{kc&&kc.dispose()}}}b5f(Ea,yb,kc){for(let yd=yb.count-1;0<=yd;yd--){var Rc=yb.J(yd);switch(Rc.opType){case 4:Rc=Object(y.a)(Sn,Rc);if(!Ea.id.equals(Rc.xhe)){k.ULS.shipAssertTag(9204885,355,Ea.id.equals(Rc.sHc));continue}Rc=kc.Db(Rc.sHc);if(!Rc)break;if(!Rc||!qa.ParagraphReader.Yb(Rc)){k.ULS.shipAssertTag(9204886,
355,!1);break}if(!Rc.isConnected)continue;var Xc=({iterator:Rc}=this.OEf(Rc)).returnValue;k.ULS.shipAssertTag(9204887,355,Xc);Xc&&this.H2f(Rc);break;case 2:(Rc=Object(y.a)(Ym,Rc),Ea.id.equals(Rc.paragraphId))?Ea.isConnected&&(Xc=({iterator:Rc}=this.OEf(Ea)).returnValue,k.ULS.shipAssertTag(16820002,355,Xc),Xc&&this.H2f(Rc)):k.ULS.shipAssertTag(16820001,355,!1)}}}xZk(Ea,yb){const kc=this.$wb.jRa(yb.characterData,yb.qa),Rc=this.$wb.gAb(kc,Ea.YQ);Ea=this.$wb.gAb(kc,Ea.R3);return Rc===Ea?Ga.a.Tc(yb,Rc):
Ga.a.createTextRange(yb,Rc,Ea)}Rwi(Ea){const yb=Ea.node.qa,kc=Ea.cpBegin;Ea=Ea.cpEnd;for(let Rc=0;Rc<yb.length;Rc++){const Xc=yb.J(Rc);if(Xc.cp>=Ea)break;if(Xc.cp>=kc){if(Xc.uf)return k.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(Xc.blob)return k.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(Xc.pe||Xc.ojb||Xc.h$b)return k.ULS.sendTraceTag(8242649,355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}
Ib.vUi="ParagraphAlreadyDirty";Ib.vxj="UnsafeWetChange";Object(l.a)(Ib,"RttEditor",null,[753]);var fc=c(15),Cc=c(1438),Jc=c(246);class pd{constructor(){this.scd=new N.a}add(Ea){this.scd.add(Ea);return!0}oPd(Ea){const yb=new N.a;for(const kc of this.scd)Ea(kc)&&yb.add(kc);return yb}X1f(Ea){Ea.activity.pQf("dried");this.scd.remove(Ea)}$1f(Ea){Ea.activity.pQf("expired");this.scd.remove(Ea)}}Object(l.a)(pd,"RttAddParagraphDataStore",null,[]);class ge extends Pf{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc){super(2,
vc);this.Lc=Ea;this.sj=yb;this.y0=kc;this.Wlg=Rc;this.dOf=Xc;this.cOf=yd;this.lH=gf}serialize(){const Ea=new If.a(2,this.Lc,this.sj,null,this.Wlg,null,null,this.lH),yb=new ac(this.y0,this.dOf,this.cOf);return new Ec(this.metadata.packetId,this.metadata.clientId,1,3,Ea,null,void 0,void 0,yb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ea){const yb=Ea.HS,kc=Ea.e_b;let Rc=null;null!=Ea.HS.gGa&&(Rc=Ea.HS.gGa);return new ge(yb.hRa,yb.C6a,kc.Ffg,Rc,kc.RUf,kc.y0,yb.lH,Pe.create(Ea))}static U3l(Ea,
yb){return 3!==Ea.type?null:new ge(Ea.Aoa.Lc,Ea.Aoa.sj,Ea.H$m.sj,Ea.PQa?Ea.PQa.Lc:null,Ea.Iwa.Lc,Ea.Iwa.sj,Ea.lH,yb)}}Object(l.a)(ge,"RttAddParagraphOp",Pf,[]);class pe{constructor(Ea){this.fV=Ea}x1i(){this.fV&&this.fV.properties.Z(pe.GUh,"1")}IJn(Ea){this.fV&&(this.fV.properties.ob(pe.wLf)||this.fV.properties.Z(pe.wLf,(Ea-this.fV.startTime).toString()))}pQf(Ea){this.fV&&(this.fV.properties.Z(pe.h6i,Ea),this.fV.end())}hLn(Ea){this.fV&&this.fV.properties.Z(pe.vTi,Ea.toString())}gLn(Ea){this.fV&&this.fV.properties.Z(pe.NSi,
Ea)}static bxf(Ea){Ea.r4(Bd.a.wMb,pe.GUh,Cc.a.oqj);Ea.r4(Bd.a.wMb,pe.isl,Cc.a.oqj);Ea.r4(Bd.a.wMb,pe.wLf,Cc.a.WBk);Ea.r4(Bd.a.wMb,pe.h6i,Cc.a.Rta);Ea.r4(Bd.a.wMb,pe.vTi,Cc.a.Rta);Ea.r4(Bd.a.wMb,pe.NSi,Cc.a.Rta)}static create(Ea){if(!Ea)return null;Ea=Ea.vp(Bd.a.wMb,pe.SWo);return new pe(Ea)}}pe.GUh="FailedToFindInitialParaID";pe.isl="FailedToFindInitialTextID";pe.wLf="MsecUntilApplied";pe.h6i="RemovedBecause";pe.vTi="PacketVersions";pe.NSi="OperationType";pe.SWo=48E4;Object(l.a)(pe,"RttOpActivity",
null,[]);var ke;(function(Ea){Ea[Ea.unknown=0]="unknown";Ea[Ea.Udp=1]="replaceTextRangeOp";Ea[Ea.K5o=2]="addParagraphOp";Ea[Ea.K7o=3]="deleteParagraphOp";Ea[Ea.Sfp=4]="splitParagraphOp";Ea[Ea.ubp=5]="mergeParagraphOp";Ea[Ea.Tdp=6]="replaceSymbolRangeOp"})(ke||(ke={}));Object(l.b)("RttOpType",ke);var Qf=c(139);class Hg extends rj{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi){super(Rc,Xc,yd,gf,vc,Le,id,Gi,6);this.font=Ea;this.legacy=yb}usf(){return"OffsetStart: "+this.YQ+"OffsetEnd: "+this.R3}serialize(){const Ea=
this.cJh();return new Ec(this.metadata.packetId,this.metadata.clientId,1,7,Ea,null,this.y0,this.Hob,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ea){let yb,kc,Rc,Xc;if(!({YQ:yb,R3:kc,Lc:Rc,sj:Xc}=rj.yvj(Ea)).returnValue)return null;let yd,gf;if(1===Ea.text.length)yd=!1,gf=Qf.AParagraphNode.jC;else if(2===Ea.text.length)if(Zb.a.xti(Ea.text,0)&&Zb.a.Yy(Ea.text,1))yd=!0,gf=Ea.text;else return k.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",
Ea.ot),null;else return k.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Ea.ot),null;const vc=Ea.h8c,Le=Pe.create(Ea);return new Hg(vc.geg,vc.heg,yd,Rc,Xc,yb,kc,Ea.QOb,gf,Ea.HS.lH,Le)}}Object(l.a)(Hg,"RttReplaceSymbolRangeOp",rj,[704,719]);class gc extends rj{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc){super(Ea,yb,kc,Rc,Xc,yd,gf,vc,1)}usf(){return"OffsetStart: "+this.YQ+"OffsetEnd: "+this.R3+"TextAddedLength: "+this.Hob.length}serialize(){const Ea=
this.cJh();return new Ec(this.metadata.packetId,this.metadata.clientId,1,2,Ea,null,this.y0,this.Hob,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ea){let yb,kc,Rc,Xc;if(!({YQ:yb,R3:kc,Lc:Rc,sj:Xc}=rj.yvj(Ea)).returnValue)return null;let yd="";Ea.text&&(yd=Ea.text);const gf=Pe.create(Ea);return new gc(Rc,Xc,yb,kc,Ea.QOb,yd,Ea.HS.lH,gf)}static W2l(Ea,yb,kc){if(Ea.type)return null;const Rc=kc.jRa(Ea.S3.characterData,Ea.S3.qa);return new gc(Ea.S3.Lc,Ea.S3.sj,kc.hmc(Rc,
Ea.cpBegin),kc.hmc(Rc,Ea.cpEnd),Ea.Iwa.sj,Ea.C8,Ea.lH,yb)}}Object(l.a)(gc,"RttReplaceTextRangeOp",rj,[704,719]);class nh{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc,Le,id,Gi,Oh,Yg,xi,Dj,Ml,Kn,Kj,Rj){this.yl=null;this.vEe=this.Ohh=!1;this.sgd=!0;this.Q4g=0;this.qbh=this.xPe=this.sbh=this.pbh=this.rbh=!1;this.USf=()=>{k.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.yl=this.gZ.result;k.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.yl.t2(this.S_)};this.S_=
(Ul,uh)=>{if(3===uh.type||10===uh.type)if(10===uh.type)this.Q4g="boolean"===typeof uh.dL?uh.dL?1:0:uh.dL;else if(this.NVb.value&&!this.NVb.value.kTd)k.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(uh.dL){if(this.vLn(),(Ul=this.rdl(uh.dL))&&1!==Ul.metadata.clientType){this.tLn();if(!(!this.Mo||this.Mo.pba||fc.a.qPa||fc.a.oba||(m.AFrameworkApplication.ye("1i00j689;ba0dg262"),fc.a.qPa||fc.a.oba)))return;if(2!==this.Q4g)switch(this.sgd&&(this.zXb.F1i(),
this.sgd=!1),this.Ohh||this.Spm(),Ul.opType){case 1:case 6:case 4:if(!({wg:Ul}=this.jkk(Ul)).returnValue)break;this.dfh?this.Xaj(Ul):this.Cwj(Ul);break;case 2:this.pnc.add(Ul),this.omi(Ul),this.dfh?this.Xaj(md.a.nil):this.Bwj(Ul)}}}else k.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")};this.Qql=()=>{const Ul=this.Nh.value;if(Ul){var uh=this.$C()-nh.lSn,yk=this.trb.oPd(yf=>yf.metadata.Vfg<uh);0<yk.count&&this.JJn();var Bi=new Jc.a;for(const yf of yk)if(this.trb.$1f(yf),yf.J6)switch(yf.J6.opType){case 1:Bi.add(yf.J6.paragraphId.toString());
break;case 6:Bi.add(yf.J6.paragraphId.toString());break;case 4:Bi.add(yf.J6.xhe.toString()),Bi.add(yf.J6.sHc.toString())}yk=this.pnc.oPd(yf=>yf.metadata.Vfg<uh);for(const yf of yk)this.pnc.$1f(yf),yf.J6&&Bi.add(yf.J6.paragraphId.toString());for(const yf of Bi)(Bi=Ul.Db(md.a.Gf(yf)))?Bi.JN?(this.fwb.$Rn(Bi),Bi.JN||this.wvc.value.v5i(Bi)):k.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):k.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.Nh.fvf&&
k.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")};this.fwb=Ea;this.trb=yb;this.wvc=kc;this.NVb=Rc;this.kI=Xc;this.gZ=yd;this.Nh=gf;this.Gb=vc;this.$C=Le;this.$wb=id;this.nd=Gi;this.cMe=Yg;this.Ic=xi;this.dfh=Dj;this.zXb=Ml;this.tqb=Kn;this.DVe=Kj;this.Axc=new K.a(H.a.Xh());this.pnc=new pd;Oh.execute(nh.bxf);this.Mo=Rj}Spm(){const Ea=new ca.a(3,2,nh.nUn,this.Qql);this.Gb.Wb(Ea);this.Ohh=!0}init(){return this.gZ?this.gZ.continueWith(this.USf):E.Task.F7(!1)}rdl(Ea){Ea=
Gf(Ea);if(!Ea)return null;switch(Ea.ot){case 2:return gc.create(Ea);case 7:return Hg.create(Ea);case 4:return ib.create(Ea);case 3:return ge.create(Ea);default:return k.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Ea.ot),null}}jkk(Ea){let yb=md.a.nil;if(!this.trb.ikk(Ea))return{returnValue:!1,wg:yb};this.omi(Ea);if(!this.kI)return{returnValue:!1,wg:yb};const kc=this.kI.Ugb(Ea.Lc);if(kc.equals(md.a.nil)||!this.Nh.value.Db(kc))return Ea.activity.x1i(),{returnValue:!1,
wg:yb};this.H1i();return{returnValue:!0,wg:kc}}Xaj(Ea){Ea.equals(md.a.nil)||this.Axc.add(Ea.toString());this.vEe||(Ea=new ca.a(0,1,200,()=>{this.fIo();this.vEe=!1},71),this.Gb.Wb(Ea),this.vEe=!0)}J4n(Ea){Ea=new ca.a(0,1,0,Ea,71);this.Gb.Wb(Ea)}omi(Ea){Ea.activity=pe.create(this.nd);Ea.activity.hLn(Ea.metadata.packetVersion);Ea.activity.gLn(ke[Ea.opType])}fIo(){var Ea=this.pnc.oPd(kc=>!kc.J6);for(const kc of Ea)this.Bwj(kc);if(this.Axc.count){Ea=null;for(var yb of this.Axc){yb=md.a.Gf(yb);Ea=this.Nh.value.Db(yb);
break}yb=this.Ic.Qc(3);try{yb.Eb(Ea);for(const kc of this.Axc)this.Cwj(md.a.Gf(kc))}finally{yb&&yb.dispose()}this.Axc.clear()}}Cwj(Ea){Ea=this.Nh.value.Db(Ea);let yb;const kc=this.Ic.Qc(3);try{kc.Eb(Ea);yb=this.nd.vp(Bd.a.pqh);const Rc=this.uqh(Ea,yb);yb.end();Rc&&this.hnk(Rc)}finally{kc&&kc.dispose(),this.zXb.u0f(1),this.sgd=!0}}Bwj(Ea){var yb=this.fwb.tvl(Ea,this.kI,this.Nh.value);yb&&(this.H1i(),this.fwb.rGo(Ea,yb,this.tqb,Da.a.instance.resolve("Box4.IParagraphEditor"))&&(yb=this.Nh.value.Db(Ea.J6.paragraphId),
this.Oqh(yb,Ea),this.zXb.u0f(1),this.sgd=!0))}hnk(Ea){this.cMe.continueWith(()=>{if(1===Ea.opType){var yb=this.b1l(Ea);yb&&(this.cMe.result.lXe(yb),this.cMe.result.Hbe(!0))}})}b1l(Ea){const yb=Ea.serialize();if(2!==yb.ot||yb.HS.gGa&&yb.HS.hRa!==yb.HS.gGa)return null;const kc=Ea.YQ.clone();0<Ea.Hob.length&&(kc.OAh(),kc.cp+=Ea.Hob.length);yb.ot=0;yb.text=null;yb.HS.xae=0;yb.HS.YQ=kc;yb.HS.C6a=yb.QOb;yb.HS.gGa=null;yb.HS.bkc=null;yb.HS.R3=null;yb.QOb=null;return vf.k9e(yb,this.kI,this.$wb,()=>this.Nh.value,
this.DVe.instance)}Oqh(Ea,yb){return this.wvc.value?this.wvc.value.Xik(Ea,yb.metadata.clientId).returnValue?!0:(k.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(k.ULS.shipAssertTag(7866378,355,!!this.wvc.value,"Unable to apply wet changes as LockManager unavailable"),!1)}tqh(Ea,yb){this.uqh(Ea,yb)}uqh(Ea,yb){if(!Ea)return null;if(!Ea.anchor)return yb&&yb.properties.Z(nh.GKi,"1"),null;if(!Ea.hasProperty(Og.a.Lc))return k.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),
null;if(!Ea.hasProperty(Og.a.sj))return k.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Ea.hasProperty(Og.a.hOh)&&Ea.getValue(Og.a.hOh))return k.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const kc=Ea.getValue(Og.a.Lc);var Rc=Ea.dma;yb&&(yb.properties.Z(nh.Gan,Rc.toString()),yb.properties.Z(nh.Ian,kc.toString()));Rc=this.trb.Lpf(kc,Rc);if(!Rc)return yb&&yb.properties.Z(nh.uKi,"1"),null;if(!this.Oqh(Ea,Rc))return yb&&yb.properties.Z(nh.dGh,
"1"),null;let Xc=0,yd=null;for(;Rc;){if(!this.fwb.fyk(Rc,Ea,this.tqb,yb)){yb&&yb.properties.Z(nh.VDj,"1");break}Xc++;Rc.activity.IJn(this.$C());yd=Rc;Rc=Ea.dma;Rc=this.trb.Lpf(kc,Rc)}0<Xc&&this.b1i();yb&&yb.properties.add(nh.WDj,Xc.toString());return yd}lbe(Ea){if(Ea.hasProperty(Og.a.Lc)&&Ea.hasProperty(Og.a.sj)){var yb=Ea.getValue(Og.a.Lc),kc=Ea.ia(Og.a.sj,0),Rc=this.nd.vp(Bd.a.A3i),Xc=this.tqb.jin(Ea.id);0<Xc.count&&(this.fwb.b5f(Ea,Xc,this.Nh.value),this.ISn(Ea,Xc,kc));var yd=this.tqb.FDl(yb);
if(yd&&!Ea.id.equals(yd.paragraphId)){const gf=this.Nh.value;this.J4n(()=>{const vc=this.tqb.Zkb(yd.paragraphId),Le=gf.Db(yd.paragraphId);k.ULS.shipAssertTag(16820032,355,!!Le,"Could not find added graph node");Le&&(this.fwb.b5f(Le,vc,gf),this.pnc.X1f(yd.mXe))})}this.trb.Lpf(yb,kc)||this.wvc.value.v5i(Ea);this.tqh(Ea,Rc);Rc.end()}}ISn(Ea,yb,kc){let Rc=!1;for(let yd=yb.count-1;0<=yd;yd--){var Xc=yb.J(yd);switch(Xc.opType){case 1:case 6:case 4:Xc=Object(y.a)(704,Xc.operation);break;default:continue}Xc.y0===
kc&&(Rc=!0,Xc.t7a&&!Xc.t7a.AUo(Ea)&&k.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",Xc.opType,Xc.usf(),Ea.id,Xc.t7a.id,Xc.t7a.cpBegin,Xc.t7a.cpEnd));Rc&&this.trb.X1f(Xc)}Rc&&this.b1i()}oZc(Ea){const yb=this.tqb.Zkb(Ea.id);0<yb.count&&(2===yb.J(0).opType&&yb.removeAt(0),this.fwb.b5f(Ea,yb,this.Nh.value))}Vfe(Ea){var yb=this.tqb.TYl(Ea.id);for(const kc of yb)if(4===kc.opType&&
(yb=Object(y.a)(Sn,kc),Ea.id.equals(yb.uik)))return!0;return!1}vLn(){this.rbh||(k.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.rbh=!0)}tLn(){this.pbh||(k.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.pbh=!0)}H1i(){this.sbh||(k.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.sbh=!0)}b1i(){this.xPe||(k.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.xPe=!0)}JJn(){this.xPe||this.qbh||(k.ULS.sendTraceTag(8185608,
355,15,"Failed to apply any wet changes so far"),this.qbh=!0)}static bxf(Ea){const yb=[Bd.a.pqh,Bd.a.A3i];for(const kc of yb)Ea.r4(kc,nh.WDj,Cc.a.Rta),Ea.r4(kc,nh.uKi,Cc.a.Rta),Ea.r4(kc,nh.GKi,Cc.a.Rta),Ea.r4(kc,nh.dGh,Cc.a.Rta),Ea.r4(kc,nh.VDj,Cc.a.Rta),Ea.r4(kc,Ib.vUi,Cc.a.Rta),Ea.r4(kc,Ib.vxj,Cc.a.Rta);pe.bxf(Ea)}}nh.nUn=6E4;nh.lSn=18E4;nh.WDj="WetChangeCount";nh.uKi="NoChangesToApply";nh.GKi="NodeNotConnected";nh.dGh="CouldNotGetLock";nh.VDj="WetChangeBlocked";nh.Ian="NodeWordId";nh.Gan="NodeTextId";
Object(l.a)(nh,"RttManager",null,[705]);class Yd{constructor(Ea,yb){this.E$i=0;this.Oi=Ea;this.H2n=yb}F1i(){this.E$i=this.Oi()}u0f(Ea){const yb=this.Oi()-this.E$i;0<=yb&&this.H2n.track(Math.round(yb),0===Ea?"CTB":"RTP")}}Object(l.a)(Yd,"RttPerfCounter",null,[703]);var Nk=c(1937);class Jj{constructor(){this.ezc=new Nk.a}Pnk(Ea,yb){this.ezc.back()&&yb&&this.ezc.back().Sdb(Ea)||this.ezc.enqueue(Ea)}wXl(){return this.ezc.isEmpty?null:this.ezc.dequeue()}}Object(l.a)(Jj,"RttSendDataStore",null,[702]);class gj extends Pf{constructor(Ea,
yb,kc,Rc){super(3,Rc);this.Lc=Ea;this.sj=yb;this.lH=kc}get y0(){return 0}serialize(){const Ea=new If.a(4,this.Lc,this.sj,null,null,null,null,this.lH);return new Ec(this.metadata.packetId,this.metadata.clientId,1,5,Ea,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ea){const yb=Ea.HS;return new gj(yb.hRa,yb.C6a,yb.lH,Pe.create(Ea))}static V3l(Ea,yb){return 4!==Ea.type?null:new gj(Ea.C3b.Lc,Ea.C3b.sj,Ea.lH,yb)}}Object(l.a)(gj,"RttDeleteParagraphOp",
Pf,[704,719]);class eh extends Pf{constructor(Ea,yb,kc,Rc,Xc,yd,gf,vc){super(5,vc);this.Vlg=Ea;this.csj=yb;this.VXo=kc;this.hBo=Rc;this.lH=Xc;this.KEj=yd;this.ckc=gf}get Lc(){return this.Vlg}get sj(){return this.csj}get y0(){return this.Vlg===this.KEj?this.ckc:0}serialize(){const Ea=new If.a(5,this.Vlg,this.csj,null,this.VXo,this.hBo,null,this.lH),yb=new hc(this.KEj,this.ckc);return new Ec(this.metadata.packetId,this.metadata.clientId,1,6,Ea,null,void 0,void 0,void 0,yb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ea){const yb=
Ea.HS,kc=Ea.xXc;return new eh(yb.hRa,yb.C6a,yb.gGa,yb.bkc,yb.lH,kc.QUf,kc.ckc,Pe.create(Ea))}static W3l(Ea,yb){return 2!==Ea.type?null:new eh(Ea.Aoa.Lc,Ea.Aoa.sj,Ea.PQa.Lc,Ea.PQa.sj,Ea.lH,Ea.y2d.Lc,Ea.y2d.sj,yb)}}Object(l.a)(eh,"RttMergeParagraphOp",Pf,[704,719]);class Eh{constructor(Ea,yb,kc,Rc,Xc,yd){this.Kzc=this.nj=null;this.Eda=!1;this.tTe=this.Afh=0;this.cud=this.Ngh=!1;this.BOe=0;this.USf=()=>{k.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.nj=this.gZ.result;
this.nj.Uae(this)};this.LPi=(gf,vc)=>{if(this.nj&&2===this.nj.connectionState&&(gf=vc.NE,gf.length))if(vc.Q6)100>this.tTe&&(this.tTe++,k.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",vc.DDk,this.Afh,this.tTe));else{for(vc=0;vc<gf.length;vc++)if(!this.zMm(gf[vc]))return;for(vc=0;vc<gf.length;vc++){const Le=gf[vc];this.rah.Pnk(Le,!Le.type&&!vc)}this.Kzc||this.pPi(this.Kzc,this.nj)}};this.gZ=Ea;this.rah=yb;this.hab=kc;this.Gt=Rc;this.Psa=Xc;this.zXb=
yd}get qn(){return this.hab.value}init(){return this.gZ?this.gZ.continueWith(this.USf):E.Task.F7(!1)}start(){this.Eda||(this.Gt.Wc?(this.Gt.Wc.NE.Nrk(this.LPi),this.Eda=!0):k.ULS.sendTraceTag(522740420,355,10,"No activePage, RttSendManager not started"))}stop(){this.Eda&&(this.Eda=!1,this.Gt.Wc.NE.EVn(this.LPi))}zMm(Ea){return Ea&&-1!==Ea.lH?Ea.type&&3!==Ea.type&&1!==Ea.type?!1:!0:!1}x0m(){this.cud||(this.Ngh||(k.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Ngh=!0),!this.cud&&
5>=this.BOe&&this.BOe++)}M0m(){!this.cud&&5>=this.BOe&&(k.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.cud=!0)}pPi(Ea,yb){this.x0m();Ea&&(Ea.Ai||Ea.wo)&&k.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Ea.exception);this.zXb.F1i();(Ea=this.X3l(this.rah.wXl()))?(this.Afh++,this.Kzc=yb.LO(3,Nc(Ea.serialize())),this.M0m(),this.zXb.u0f(0),this.Kzc.continueWith(kc=>{this.pPi(kc,yb)})):this.Kzc=null}X3l(Ea){if(!Ea)return null;if(!this.qn)return k.ULS.sendTraceTag(8245957,
355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const yb=new Pe($k.instance.T8h(),this.qn.kj,1,0,0,fg.instance.MXl());let kc=null;switch(Ea.type){case 0:kc=gc.W2l(Ea,yb,this.Psa);break;case 4:kc=gj.V3l(Ea,yb);break;case 3:kc=ge.U3l(Ea,yb);break;case 2:kc=eh.W3l(Ea,yb);break;case 1:kc=ib.Y3l(Ea,yb,this.Psa)}return kc}}Object(l.a)(Eh,"RttSendManager",null,[701]);class sg{constructor(){this.W=null;this.uVl=()=>Sa.App.xd&&Sa.App.xd.Vq?Sa.App.xd.Vq:(k.ULS.sendTraceTag(7866377,
304,15,"Unable to get the lock manager"),null)}get name(){return"WordEditor.RealTimeTyping"}yc(Ea){const yb=Ha.a.xp(Ea.Sa("Box4.IOutlineElementEditor")),kc=Ha.a.xp(Ea.Sa("Box4.IFeatureHelper")),Rc=Ha.a.xp(Ea.Sa("Common.IActivityAggregationInfo")),Xc=Ha.a.xp(Ea.Sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator")),yd=Ha.a.xp(Ea.Sa("Box4.CompositionStateManager"));this.W=Ea;const gf=new Ij.a;E.Task.WAA.call(null,yb,kc,Rc,Xc,yd).continueWith(()=>{Ea.ha("WordEditor.RealTimeTyping.IRttEditor",
()=>new Ib(Ea.resolve("Box4.ICharacterPropertiesEditor"),Ea.resolve("Box4.IOutlineElementEditor"),gf,Ea.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Ea.register(Yd,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().Qd(()=>new Yd(Ud.a.Ue,Ag.a.GE(17,1,new Uf.a(new Hl.a(.25)))));Ea.ha("WordEditor.RealTimeTyping.RttManager",()=>new nh(Ea.resolve("WordEditor.RealTimeTyping.IRttEditor"),new ri(th.a.instance),new U.a(this.uVl),new U.a(()=>
Sa.App.A0),Ea.resolve("WordEditor.ParagraphWordIdMapping"),Ea.resolve("Box4.Presence.IRtcProxyProvider").tD(),new U.a(()=>Sa.App.ya.jb&&Sa.App.ya.jb.Wc?Sa.App.ya.jb.Wc.ud:(k.ULS.sendTraceTag(522740419,304,10,"No activePage or workspace."),null)),pb.a.instance,()=>Date.now(),Ea.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),th.a.instance,Ea.Sa("Common.IActivityAggregationInfo"),Fe.tD(),gf,m.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),Ea.resolve("WordEditor.IRttPerfCounter"),
new Kl,Ea.Sa("WordEditor.Presence.IWordPresenceCpFactory"),Ea.resolve("Box4.CompositionStateManager"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();Ea.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new Eh(Ea.resolve("Box4.Presence.IRtcProxyProvider").tD(),new Jj,new U.a(()=>Sa.App.xd),Sa.App.ya.jb,Ea.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ea.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.cxf()})}cxf(){this.W.resolve("WordEditor.RealTimeTyping.RttManager").init();
this.W.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){Ba.a.instance.Gc(new sg)}}Object(l.a)(sg,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");
oa.main();Type.registerNamespace("Common.App.CollabControls");jb.prototype.toString=Ca.a.prototype.toString;ob.prototype.toString=Ca.a.prototype.toString;Ba.a.instance.Gc(new bj);sg.main();Type.registerNamespace("RealtimePresenceUI");Ba.a.instance.Gc(new vg);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");fa.main()}}]);

//# sourceMappingURL=https://res-dev.cdn.officeppe.net/1js/build/19334779/wdjs/WordEditorDSVersionHistoryNotRemoved.collab.js.map